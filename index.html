<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® - Ù„Ù„Ø£Ø­Ø°ÙŠØ©</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: { 
        extend: { 
          colors: { 
            brand: { 
              light: '#C5D8A4', // Ø²ÙŠØªÙŠ ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ Ù„Ù„Ù†ØµÙˆØµ
              DEFAULT: '#8C9E5E', // Ø²ÙŠØªÙŠ Ù…ØªÙˆØ³Ø· Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
              glow: '#708238', // Ø²ÙŠØªÙŠ Ù…ØªÙˆÙ‡Ø¬
              dark: '#1a1f16'   // Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© Ø¬Ø¯Ø§Ù‹ Ù…Ø§Ø¦Ù„Ø© Ù„Ù„Ø²ÙŠØªÙŠ
            } 
          },
          boxShadow: {
            'glass': '0 8px 32px 0 rgba(0, 0, 0, 0.37)',
            'glow': '0 0 15px rgba(140, 158, 94, 0.3)'
          }
        } 
      } 
    }
  </script>
  
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #0f0f0f; color: #e2e8f0; }
    
    /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ø¹ Ø§Ù„Ù„ÙˆØ¬Ùˆ */
    .brand-bg {
      background-color: #050505;
      background-image: 
        linear-gradient(to bottom, rgba(5, 5, 5, 0.85), rgba(5, 5, 5, 0.95)),
        url('Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png');
      background-size: cover; 
      background-position: center; 
      background-attachment: fixed; 
      background-repeat: no-repeat;
    }

    /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ Ø§Ù„Ø´ÙØ§Ù (Glassmorphism) */
    .glass-panel {
      background: rgba(30, 35, 30, 0.4); /* Ø´ÙØ§ÙÙŠØ© Ù…Ø§Ø¦Ù„Ø© Ù„Ù„Ø²ÙŠØªÙŠ */
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(140, 158, 94, 0.15); /* Ø­Ø¯ÙˆØ¯ Ø²ÙŠØªÙŠØ© Ø®ÙÙŠÙØ© */
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }

    /* ÙƒØ±ÙˆØª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© */
    .product-glass {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(5px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.3s ease;
    }
    .product-glass:hover {
      background: rgba(140, 158, 94, 0.1); /* ØªÙˆÙ‡Ø¬ Ø²ÙŠØªÙŠ Ø¹Ù†Ø¯ Ø§Ù„Ù„Ù…Ø³ */
      border-color: #8C9E5E;
      transform: translateY(-5px);
      box-shadow: 0 0 20px rgba(140, 158, 94, 0.2);
    }

    /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© */
    .btn-glass {
      background: rgba(140, 158, 94, 0.2);
      backdrop-filter: blur(4px);
      border: 1px solid rgba(140, 158, 94, 0.3);
      color: #C5D8A4;
      transition: all 0.3s;
    }
    .btn-glass:hover {
      background: rgba(140, 158, 94, 0.4);
      box-shadow: 0 0 15px rgba(140, 158, 94, 0.4);
      color: white;
    }

    /* Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
    .input-glass {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(140, 158, 94, 0.2);
      color: #C5D8A4;
      backdrop-filter: blur(5px);
    }
    .input-glass:focus {
      border-color: #8C9E5E;
      box-shadow: 0 0 10px rgba(140, 158, 94, 0.2);
      outline: none;
    }
    
    /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª SVG */
    .icon-sport { fill: #8C9E5E; transition: 0.3s; }
    .product-glass:hover .icon-sport { fill: #C5D8A4; filter: drop-shadow(0 0 5px #8C9E5E); }

    .modal-overlay { background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); }
  </style>
 </head>
 <body class="h-full brand-bg min-h-screen overflow-auto selection:bg-brand text-brand-light">

   <header class="glass-panel p-4 sticky top-0 z-50 border-b-0 rounded-b-2xl mx-2 mt-2">
     <div class="max-w-6xl mx-auto flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-white/5 rounded-xl flex items-center justify-center border border-white/10 overflow-hidden shadow-glow">
            <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" alt="Logo" class="w-full h-full object-contain hover:scale-110 transition" onerror="this.style.display='none'; this.parentElement.innerHTML='âœ¨'">
        </div>
        <div>
            <h1 class="text-xl font-bold leading-none text-white drop-shadow-md">Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®</h1>
            <span class="text-xs text-brand font-bold tracking-widest uppercase">Luxury Kicks</span>
        </div>
      </div>
      <button onclick="toggleAdmin()" class="px-4 py-2 rounded-xl btn-glass text-xs font-bold">ğŸ” Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
     </div>
   </header>

   <div id="home-view">
     <section class="h-[70vh] flex flex-col items-center justify-center text-center px-4">
       <div class="relative mb-6 group">
         <div class="absolute inset-0 bg-brand/20 blur-3xl rounded-full group-hover:bg-brand/30 transition duration-700"></div>
         <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" class="h-32 relative z-10 drop-shadow-2xl hover:scale-105 transition duration-500" onerror="this.style.display='none'">
       </div>
       
       <h2 class="text-4xl md:text-5xl font-black mb-2 text-white tracking-tight">Ø®Ø·ÙˆØ§ØªÙƒ.. <span class="text-brand">ÙØ®Ø§Ù…Ø©</span></h2>
       <p class="text-brand-light/70 mb-8 text-sm md:text-base">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© ÙˆØ§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ©</p>
       
       <button onclick="document.getElementById('cats').scrollIntoView({behavior: 'smooth'})" class="btn-glass px-10 py-4 rounded-full font-bold text-lg shadow-glow border-brand/50">
         ØªØµÙØ­ Ø§Ù„ÙƒÙˆÙ„ÙŠÙƒØ´Ù† â†“
       </button>
     </section>

     <section id="cats" class="max-w-6xl mx-auto px-4 py-12 grid grid-cols-1 md:grid-cols-3 gap-4">
       
       <div onclick="showCategory('Ø±Ø¬Ø§Ù„ÙŠ')" class="product-glass p-8 rounded-2xl text-center cursor-pointer group relative overflow-hidden">
           <div class="absolute top-0 right-0 w-20 h-20 bg-brand/10 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-brand/20"></div>
           <svg class="w-20 h-20 mx-auto mb-4 icon-sport" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21.5,14c0.8-0.8,0.5-2.2-0.6-2.5l-3-0.9c-0.7-0.2-1.5,0.1-1.9,0.7L13.8,14H9V9l2.2-2.2C11.6,6.4,12,5.9,12,5.3 V3c0-0.6-0.4-1-1-1H5C3.3,2,2,3.3,2,5v6c0,2.8,2.2,5,5,5h11C19.9,16,21.5,14,21.5,14z M5,14c-1.7,0-3-1.3-3-3H1v3 c0,2.2,1.8,4,4,4h13l-1.6-1.6C16.1,16.2,16.2,16,16.4,15.8L5,14z"/></svg>
           <h3 class="text-2xl font-bold text-white group-hover:text-brand transition">Ø±Ø¬Ø§Ù„ÙŠ</h3>
           <p class="text-xs text-brand-light/50 mt-1">SPORT & CLASSIC</p>
       </div>

       <div onclick="showCategory('Ø­Ø±ÙŠÙ…ÙŠ')" class="product-glass p-8 rounded-2xl text-center cursor-pointer group relative overflow-hidden">
           <div class="absolute top-0 right-0 w-20 h-20 bg-purple-500/10 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-purple-500/20"></div>
           <svg class="w-20 h-20 mx-auto mb-4 icon-sport" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.6,12.5l-4-6.5C16.2,5.4,15.4,5,14.6,5H6C3.8,5,2,6.8,2,9v4c0,2.8,2.2,5,5,5h11c1.8,0,3.4-1.3,3.9-3.1 C22.1,13.9,21.6,13,20.6,12.5z M6,16c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S7.1,16,6,16z"/></svg>
           <h3 class="text-2xl font-bold text-white group-hover:text-brand transition">Ø­Ø±ÙŠÙ…ÙŠ</h3>
           <p class="text-xs text-brand-light/50 mt-1">TRENDY & CHIC</p>
       </div>

       <div onclick="showCategory('Ø£Ø·ÙØ§Ù„ÙŠ')" class="product-glass p-8 rounded-2xl text-center cursor-pointer group relative overflow-hidden">
           <div class="absolute top-0 right-0 w-20 h-20 bg-yellow-500/10 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-yellow-500/20"></div>
           <svg class="w-20 h-20 mx-auto mb-4 icon-sport" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19,13c0.6-0.6,0.6-1.5,0-2.1l-2.3-2.3c-0.4-0.4-1-0.4-1.4,0l-1.3,1.3V6c0-1.1-0.9-2-2-2H6C3.8,4,2,5.8,2,8v4 c0,2.8,2.2,5,5,5h9c1.5,0,2.9-0.8,3.6-2.1L19,13z M6,15c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S7.1,15,6,15z"/></svg>
           <h3 class="text-2xl font-bold text-white group-hover:text-brand transition">Ø£Ø·ÙØ§Ù„ÙŠ</h3>
           <p class="text-xs text-brand-light/50 mt-1">LITTLE HEROES</p>
       </div>
     </section>
   </div>

   <div id="products-view" class="hidden max-w-6xl mx-auto px-4 py-4 min-h-screen">
     <div class="glass-panel p-3 rounded-xl sticky top-24 z-40 flex justify-between items-center mb-6">
       <h3 id="cat-title" class="text-xl font-bold text-brand pl-4 border-l-2 border-brand"></h3>
       <button onclick="goHome()" class="px-3 py-1 text-sm text-brand-light hover:text-white transition">âœ• Ø±Ø¬ÙˆØ¹</button>
     </div>
     
     <div id="loading-msg" class="text-center py-20 text-brand animate-pulse hidden">Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª...</div>
     <div id="grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
     <div id="empty-msg" class="hidden text-center py-20 text-gray-500">
         <div class="text-6xl mb-4 opacity-20 grayscale">ğŸ‘Ÿ</div>
         <p class="text-brand-light/50">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
     </div>
   </div>

   <div id="modal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
     <div class="glass-panel w-full max-w-md rounded-2xl overflow-hidden shadow-glass max-h-[95vh] overflow-y-auto relative flex flex-col border border-white/10">
       <button onclick="closeModal()" class="absolute top-3 left-3 bg-black/40 hover:bg-brand/80 w-8 h-8 rounded-full z-20 text-white transition backdrop-blur-md">âœ•</button>
       
       <div class="h-80 flex items-center justify-center relative shrink-0 bg-gradient-to-b from-transparent to-black/50">
         <img id="main-img" class="max-h-full max-w-full object-contain drop-shadow-2xl">
         <div id="thumbs" class="absolute bottom-4 flex gap-2 justify-center w-full px-2"></div>
       </div>

       <div class="p-6 bg-black/40 backdrop-blur-xl">
         <h2 id="m-name" class="text-xl font-bold text-center mb-1 text-white"></h2>
         <p id="m-price" class="text-3xl font-black text-brand text-center mb-6 tracking-wide"></p>
         
         <div class="mb-6 text-center">
             <p class="text-[10px] text-brand-light/60 mb-2 uppercase tracking-[0.2em]">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³</p>
             <div id="m-sizes" class="flex flex-wrap justify-center gap-2"></div>
         </div>

         <div class="space-y-3 pt-6 border-t border-white/5">
           <input id="c-name" placeholder="Ø§Ù„Ø§Ø³Ù…" class="input-glass w-full p-3 rounded-xl text-sm">
           <input id="c-phone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="input-glass w-full p-3 rounded-xl text-sm">
           <input id="c-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" class="input-glass w-full p-3 rounded-xl text-sm">
           <button onclick="sendOrder()" class="btn-glass w-full py-4 rounded-xl font-bold mt-2 text-lg border-brand/50 bg-brand/10 hover:bg-brand/30 text-white shadow-glow">
             ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ğŸ›’
           </button>
         </div>
       </div>
     </div>
   </div>

   <div id="admin-panel" class="hidden fixed inset-0 z-50 bg-black/95 backdrop-blur-xl overflow-y-auto">
     <div class="p-4 max-w-2xl mx-auto">
       <header class="flex justify-between items-center mb-8 border-b border-white/10 pb-4 sticky top-0 bg-black/50 backdrop-blur-md z-10 pt-4 rounded-b-xl">
         <h2 class="text-2xl font-bold text-brand flex items-center gap-2">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
         <button onclick="toggleAdmin()" class="text-gray-400 hover:text-white transition">Ø¥ØºÙ„Ø§Ù‚</button>
       </header>

       <div class="glass-panel p-4 rounded-xl mb-8">
           <div class="flex gap-3">
               <button onclick="exportData()" class="flex-1 btn-glass py-2 rounded-lg text-xs font-bold">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø©</button>
               <button onclick="document.getElementById('import-file').click()" class="flex-1 btn-glass py-2 rounded-lg text-xs font-bold">ğŸ“¤ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù†Ø³Ø®Ø©</button>
               <input type="file" id="import-file" accept=".json" class="hidden" onchange="importData(this)">
           </div>
       </div>

       <div class="glass-panel p-6 rounded-xl mb-8">
         <h3 class="font-bold mb-4 text-brand-light text-lg">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„</h3>
         <div class="space-y-4">
           
           <div class="border-2 border-dashed border-brand/20 bg-black/20 p-6 text-center rounded-xl cursor-pointer hover:border-brand/50 transition group" onclick="document.getElementById('file-in').click()">
             <input type="file" id="file-in" multiple accept="image/*" class="hidden" onchange="handleFiles(this)">
             <div id="upload-placeholder" class="group-hover:scale-105 transition-transform">
                 <span class="text-3xl block mb-2 opacity-50">ğŸ“¸</span>
                 <span class="text-sm text-brand-light font-bold">Ø§Ø¶ØºØ· Ù„Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±</span>
             </div>
             <div id="preview" class="grid grid-cols-4 gap-2 mt-2 hidden"></div>
           </div>
           <p id="file-msg" class="text-xs text-brand mt-1 text-center hidden"></p>

           <input id="new-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„" class="input-glass w-full p-3 rounded-xl">
           
           <div class="flex gap-3">
             <input id="new-price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="input-glass flex-1 p-3 rounded-xl">
             <select id="new-cat" class="input-glass flex-1 p-3 rounded-xl bg-black">
               <option value="Ø±Ø¬Ø§Ù„ÙŠ">Ø±Ø¬Ø§Ù„ÙŠ</option>
               <option value="Ø­Ø±ÙŠÙ…ÙŠ">Ø­Ø±ÙŠÙ…ÙŠ</option>
               <option value="Ø£Ø·ÙØ§Ù„ÙŠ">Ø£Ø·ÙØ§Ù„ÙŠ</option>
             </select>
           </div>
           
           <div id="size-options" class="flex flex-wrap gap-2 p-3 bg-black/20 rounded-xl border border-white/5"></div>
           
           <button onclick="addProduct()" id="add-btn" class="btn-glass w-full py-3 rounded-xl font-bold bg-brand/20 text-white hover:bg-brand/40">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</button>
         </div>
       </div>

       <h3 class="font-bold mb-4 text-white flex items-center gap-2">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª <span id="count-badge" class="text-xs bg-brand text-white px-2 rounded-full">0</span></h3>
       <div id="admin-list" class="space-y-3 pb-10"></div>
     </div>
   </div>

   <script>
    // === IndexedDB (ØªØ®Ø²ÙŠÙ† Ø¶Ø®Ù…) ===
    const dbName = "AhmedShoesDB_Pro";
    const storeName = "products";
    let db;

    function openDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(dbName, 1);
            request.onupgradeneeded = (e) => {
                db = e.target.result;
                if (!db.objectStoreNames.contains(storeName)) db.createObjectStore(storeName, { keyPath: "id" });
            };
            request.onsuccess = (e) => { db = e.target.result; resolve(db); };
            request.onerror = () => reject("DB Error");
        });
    }

    function saveProductToDB(product) {
        return new Promise((resolve) => {
            const tx = db.transaction([storeName], "readwrite");
            tx.objectStore(storeName).put(product);
            tx.oncomplete = () => resolve(true);
        });
    }

    function getAllProducts() {
        return new Promise((resolve) => {
            if(!db) return resolve([]);
            const tx = db.transaction([storeName], "readonly");
            tx.objectStore(storeName).getAll().onsuccess = (e) => resolve(e.target.result || []);
        });
    }

    function deleteProductFromDB(id) {
        return new Promise((resolve) => {
            const tx = db.transaction([storeName], "readwrite");
            tx.objectStore(storeName).delete(id);
            tx.oncomplete = () => resolve(true);
        });
    }

    // === Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª ===
    let products = [];
    let currentProd = null, currentSize = null, newImages = [], newSizes = [];
    const whatsapp = "01000000000"; 

    // === Ø§Ù„ØªØ´ØºÙŠÙ„ ===
    async function init() {
        await openDB();
        products = await getAllProducts();
        updateSizeOpts();
    }
    init();

    // === Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± ===
    function handleFiles(input) {
      const files = [...input.files].slice(0, 4);
      const preview = document.getElementById('preview');
      const placeholder = document.getElementById('upload-placeholder');
      const msg = document.getElementById('file-msg');
      
      placeholder.classList.add('hidden');
      preview.classList.remove('hidden');
      msg.classList.remove('hidden');
      msg.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";
      
      newImages = []; 
      let processedCount = 0;

      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.src = e.target.result;
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const maxWidth = 800; 
            let w = img.width, h = img.height;
            if (w > maxWidth) { h *= maxWidth / w; w = maxWidth; }
            canvas.width = w; canvas.height = h;
            ctx.drawImage(img, 0, 0, w, h);
            newImages.push(canvas.toDataURL('image/jpeg', 0.7));
            processedCount++;
            
            if(processedCount === files.length) {
                renderPreview();
                msg.innerText = "âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø­ÙØ¸";
            }
          }
        };
        reader.readAsDataURL(file);
      });
    }

    function renderPreview() {
        const preview = document.getElementById('preview');
        preview.innerHTML = '';
        newImages.forEach(img => {
            preview.innerHTML += `<div class="aspect-square rounded-lg bg-cover bg-center border border-brand/50 shadow-glow" style="background-image: url('${img}')"></div>`;
        });
    }

    // === Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ===
    async function addProduct() {
      const btn = document.getElementById('add-btn');
      const name = document.getElementById('new-name').value;
      const price = document.getElementById('new-price').value;
      
      if(!name || !price || !newImages.length || !newSizes.length) return alert('âš ï¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©');
      
      btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
      btn.disabled = true;

      const newItem = {
        id: Date.now(),
        name, price,
        category: document.getElementById('new-cat').value,
        images: newImages,
        sizes: newSizes
      };

      await saveProductToDB(newItem);
      products = await getAllProducts();
      
      alert('ØªÙ… Ø§Ù„Ø­ÙØ¸');
      // Reset
      document.getElementById('new-name').value = '';
      document.getElementById('new-price').value = '';
      document.getElementById('upload-placeholder').classList.remove('hidden');
      document.getElementById('preview').classList.add('hidden');
      document.getElementById('file-msg').classList.add('hidden');
      newImages = []; newSizes = []; updateSizeOpts();
      renderAdminList();
      
      btn.innerText = "Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„";
      btn.disabled = false;
    }

    async function deleteProduct(id) {
      if(confirm('Ø­Ø°ÙØŸ')) {
        await deleteProductFromDB(id);
        products = await getAllProducts();
        renderAdminList();
      }
    }

    function renderAdminList() {
      const list = document.getElementById('admin-list');
      document.getElementById('count-badge').innerText = products.length;
      list.innerHTML = products.map(p => `
        <div class="glass-panel p-3 rounded-xl flex justify-between items-center mb-2">
          <div class="flex gap-4 items-center">
            <img src="${p.images[0]}" class="w-12 h-12 rounded-lg object-cover border border-white/10">
            <div>
                <div class="font-bold text-white">${p.name}</div>
                <div class="text-xs text-brand font-bold">${p.price} Ø¬.Ù…</div>
            </div>
          </div>
          <button onclick="deleteProduct(${p.id})" class="text-red-400 hover:text-red-300">âœ•</button>
        </div>
      `).join('');
    }

    // === Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ===
    async function exportData() {
        if(!products.length) return alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª');
        const blob = new Blob([JSON.stringify(products)], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `backup_${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }

    function importData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = async (e) => {
            try {
                const imported = JSON.parse(e.target.result);
                if (confirm(`Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ${imported.length} Ù…Ù†ØªØ¬ØŸ`)) {
                    for (const p of imported) await saveProductToDB(p);
                    products = await getAllProducts();
                    renderAdminList();
                    alert('ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹');
                }
            } catch (err) { alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ù„Ù'); }
        };
        reader.readAsText(file);
    }

    // === ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ===
    function updateSizeOpts() {
      const cat = document.getElementById('new-cat').value;
      let sizes = cat === 'Ø±Ø¬Ø§Ù„ÙŠ' ? [40,41,42,43,44,45] : (cat === 'Ø­Ø±ÙŠÙ…ÙŠ' ? [37,38,39,40,41] : [25,26,27,28,29,30,31,32,33,34,35]);
      newSizes = [];
      document.getElementById('size-options').innerHTML = sizes.map(s => 
        `<button onclick="toggleNewSize(${s}, this)" class="w-8 h-8 rounded-lg bg-white/5 text-xs text-brand-light font-bold hover:bg-white/10 transition border border-transparent">${s}</button>`
      ).join('');
    }

    function toggleNewSize(s, btn) {
      if(newSizes.includes(s)) {
        newSizes = newSizes.filter(x => x !== s);
        btn.classList.remove('border-brand', 'text-brand', 'bg-brand/10');
      } else {
        newSizes.push(s);
        btn.classList.add('border-brand', 'text-brand', 'bg-brand/10');
      }
    }

    document.getElementById('new-cat').addEventListener('change', updateSizeOpts);

    async function showCategory(cat) {
      document.getElementById('home-view').classList.add('hidden');
      document.getElementById('products-view').classList.remove('hidden');
      document.getElementById('cat-title').innerText = cat;
      document.getElementById('grid').innerHTML = '';
      
      products = await getAllProducts();
      const items = products.filter(p => p.category === cat);
      
      if(!items.length) {
        document.getElementById('empty-msg').classList.remove('hidden');
        return;
      }
      document.getElementById('empty-msg').classList.add('hidden');
      
      document.getElementById('grid').innerHTML = items.map(p => `
        <div onclick="openModal(${p.id})" class="product-glass rounded-xl overflow-hidden cursor-pointer group relative">
          <div class="h-48 relative overflow-hidden">
            <img src="${p.images[0]}" class="w-full h-full object-cover group-hover:scale-110 transition duration-700">
            <div class="absolute bottom-0 inset-x-0 h-1/2 bg-gradient-to-t from-black/80 to-transparent"></div>
            <div class="absolute bottom-2 right-2 text-white font-bold text-lg drop-shadow-md">${p.price}<span class="text-xs text-brand ml-1">Ø¬.Ù…</span></div>
          </div>
          <div class="p-3 text-center">
             <h4 class="font-bold text-sm text-brand-light truncate">${p.name}</h4>
          </div>
        </div>
      `).join('');
    }

    function goHome() {
      document.getElementById('products-view').classList.add('hidden');
      document.getElementById('home-view').classList.remove('hidden');
    }

    async function toggleAdmin() {
      const p = document.getElementById('admin-panel');
      if(p.classList.contains('hidden')) {
        const pass = prompt('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:');
        if(pass === 'admin123') {
           p.classList.remove('hidden');
           products = await getAllProducts();
           renderAdminList();
        } else alert('Ø®Ø·Ø£');
      } else p.classList.add('hidden');
    }

    // === Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ===
    function openModal(id) {
      currentProd = products.find(p => p.id === id);
      const modal = document.getElementById('modal');
      modal.classList.remove('hidden');
      
      document.getElementById('m-name').innerText = currentProd.name;
      document.getElementById('m-price').innerText = currentProd.price + ' Ø¬.Ù…';
      
      const main = document.getElementById('main-img');
      main.src = currentProd.images[0];
      
      document.getElementById('thumbs').innerHTML = currentProd.images.map(src => `
        <div onclick="document.getElementById('main-img').src='${src}'" 
             class="w-12 h-12 rounded-lg border border-white/20 cursor-pointer overflow-hidden hover:border-brand transition">
             <img src="${src}" class="w-full h-full object-cover">
        </div>
      `).join('');

      document.getElementById('m-sizes').innerHTML = currentProd.sizes.map(s => `
        <button onclick="selectSize(${s}, this)" class="w-8 h-8 rounded bg-white/5 text-xs font-bold text-brand-light hover:bg-brand/20 border border-transparent transition">${s}</button>
      `).join('');
    }

    function selectSize(s, btn) {
      currentSize = s;
      document.querySelectorAll('#m-sizes button').forEach(b => b.classList.remove('border-brand', 'text-white', 'bg-brand/20'));
      btn.classList.add('border-brand', 'text-white', 'bg-brand/20');
    }

    function closeModal() { document.getElementById('modal').classList.add('hidden'); }

    function sendOrder() {
      const name = document.getElementById('c-name').value;
      const addr = document.getElementById('c-address').value;
      const phone = document.getElementById('c-phone').value;
      
      if(!currentSize || !name || !addr) return alert('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
      
      const msg = `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯: \nğŸ‘Ÿ ${currentProd.name}\nğŸ“ ${currentSize}\nğŸ’° ${currentProd.price}\nğŸ‘¤ ${name}\nğŸ“ ${phone}\nğŸ“ ${addr}`;
      window.open(`https://wa.me/${whatsapp}?text=${encodeURIComponent(msg)}`, '_blank');
      closeModal();
    }
   </script>
 </body>
</html>
