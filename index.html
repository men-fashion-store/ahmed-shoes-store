<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® - Ù„Ù„Ø£Ø­Ø°ÙŠØ©</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: { 
        extend: { 
          colors: { 
            brand: { 
              light: '#dce6c8', 
              DEFAULT: '#708238', // Ø§Ù„Ø²ÙŠØªÙŠ (Olive)
              dark: '#3f4a20',
              glass: 'rgba(112, 130, 56, 0.15)' 
            } 
          },
          boxShadow: {
            '3d': '0 20px 50px rgba(0,0,0,0.2), 0 5px 15px rgba(0,0,0,0.1)',
          }
        } 
      } 
    }
  </script>
  
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f5f5f5; color: #1a1a1a; }
    
    /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ Ù…Ø¹ Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø§Ù„Ø´ÙØ§Ù */
    .brand-bg {
      background-color: #ffffff;
      background-image: 
        linear-gradient(rgba(255, 255, 255, 0.93), rgba(255, 255, 255, 0.97)),
        url('Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png');
      background-size: 400px;
      background-position: center; 
      background-attachment: fixed; 
      background-repeat: repeat;
    }

    /* === Ø³Ø­Ø± Ø§Ù„Ø²Ø¬Ø§Ø¬ Ø§Ù„Ù€ 3D === */
    .glass-3d-card {
      position: relative;
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border-top: 1px solid rgba(255, 255, 255, 0.9);
      border-left: 1px solid rgba(255, 255, 255, 0.9);
      border-bottom: 1px solid rgba(112, 130, 56, 0.2);
      border-right: 1px solid rgba(112, 130, 56, 0.2);
      border-radius: 30px;
      box-shadow: 
        10px 10px 20px rgba(0, 0, 0, 0.05),
        -5px -5px 15px rgba(255, 255, 255, 0.8),
        inset 0 0 20px rgba(255, 255, 255, 0.5);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .glass-3d-card:hover {
      transform: translateY(-10px);
      box-shadow: 
        20px 20px 40px rgba(112, 130, 56, 0.15),
        -10px -10px 20px rgba(255, 255, 255, 0.9);
      border-color: #708238;
    }

    /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© */
    .btn-glass {
      background: linear-gradient(135deg, #708238 0%, #3f4a20 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(112, 130, 56, 0.4);
      transition: 0.3s;
    }
    .btn-glass:hover {
      box-shadow: 0 8px 25px rgba(112, 130, 56, 0.6);
      transform: translateY(-2px);
    }

    /* Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
    .input-glass {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid #d1d5db;
      box-shadow: inset 2px 2px 5px rgba(0,0,0,0.05);
    }
    .input-glass:focus {
      border-color: #708238;
      background: #fff;
      outline: none;
    }
    
    .modal-overlay { background: rgba(255,255,255,0.85); backdrop-filter: blur(8px); }
  </style>
 </head>
 <body class="h-full brand-bg min-h-screen overflow-auto selection:bg-brand selection:text-white">

   <header class="bg-white/70 backdrop-blur-md p-3 sticky top-0 z-50 border-b border-white shadow-sm">
     <div class="max-w-6xl mx-auto flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-white rounded-xl flex items-center justify-center border border-gray-100 shadow-inner overflow-hidden">
            <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" alt="Logo" class="w-full h-full object-contain p-1">
        </div>
        <div>
            <h1 class="text-xl font-black leading-none text-brand-dark">Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®</h1>
            <span class="text-xs text-brand font-bold tracking-[0.2em] uppercase">Shoes Store</span>
        </div>
      </div>
      <button onclick="toggleAdmin()" class="px-4 py-2 rounded-xl bg-white text-brand border border-brand/20 text-xs font-bold hover:bg-brand hover:text-white transition shadow-sm">ğŸ” Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
     </div>
   </header>

   <div id="home-view">
     <section class="min-h-[50vh] flex flex-col items-center justify-center text-center px-4 pt-4">
       
       <div class="relative w-36 h-36 mb-4 group cursor-pointer">
           <div class="absolute inset-0 bg-brand/30 rounded-full blur-2xl group-hover:bg-brand/50 transition duration-500"></div>
           <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" class="relative z-10 w-full h-full object-contain drop-shadow-2xl transform group-hover:rotate-6 transition duration-500">
       </div>

       <h2 class="text-4xl md:text-5xl font-black mb-2 text-brand-dark">Ø®Ø·ÙˆØ§ØªÙƒ.. <span class="text-brand">ÙØ®Ø§Ù…Ø©</span></h2>
       <p class="text-gray-500 mb-6 font-bold text-sm">Ø£Ø±Ù‚Ù‰ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© ÙˆØ§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ©</p>
       
       <button onclick="document.getElementById('cats').scrollIntoView({behavior: 'smooth'})" class="btn-glass px-8 py-3 rounded-full font-bold text-lg animate-bounce">
         ØªØµÙØ­ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… â†“
       </button>
     </section>

     <section id="cats" class="max-w-6xl mx-auto px-4 py-10 pb-20">
       <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
       
         <div onclick="showCategory('Ø±Ø¬Ø§Ù„ÙŠ')" class="glass-3d-card p-8 flex flex-col items-center cursor-pointer group">
             <div class="w-32 h-32 relative z-10 mb-4 transition-transform duration-500 group-hover:scale-110 group-hover:-translate-y-2">
                 <img src="men.png" class="w-full h-full object-contain drop-shadow-2xl" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3043/3043888.png'">
             </div>
             <h3 class="text-3xl font-black text-brand-dark mb-1 relative z-10">Ø±Ø¬Ø§Ù„ÙŠ</h3>
             <div class="h-1 w-12 bg-brand rounded-full mb-2 relative z-10"></div>
             <p class="text-gray-500 text-sm font-bold relative z-10">RAGOL SPORT</p>
         </div>

         <div onclick="showCategory('Ø­Ø±ÙŠÙ…ÙŠ')" class="glass-3d-card p-8 flex flex-col items-center cursor-pointer group">
             <div class="w-32 h-32 relative z-10 mb-4 transition-transform duration-500 group-hover:scale-110 group-hover:-translate-y-2">
                 <img src="women.png" class="w-full h-full object-contain drop-shadow-2xl" onerror="this.src='https://cdn-icons-png.flaticon.com/512/9463/9463177.png'">
             </div>
             <h3 class="text-3xl font-black text-brand-dark mb-1 relative z-10">Ø­Ø±ÙŠÙ…ÙŠ</h3>
             <div class="h-1 w-12 bg-purple-500 rounded-full mb-2 relative z-10"></div>
             <p class="text-gray-500 text-sm font-bold relative z-10">SITTAT CHIC</p>
         </div>

         <div onclick="showCategory('Ø£Ø·ÙØ§Ù„ÙŠ')" class="glass-3d-card p-8 flex flex-col items-center cursor-pointer group">
             <div class="w-32 h-32 relative z-10 mb-4 transition-transform duration-500 group-hover:scale-110 group-hover:-translate-y-2">
                 <img src="kids.png" class="w-full h-full object-contain drop-shadow-2xl" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3082/3082060.png'">
             </div>
             <h3 class="text-3xl font-black text-brand-dark mb-1 relative z-10">Ø£Ø·ÙØ§Ù„ÙŠ</h3>
             <div class="h-1 w-12 bg-yellow-500 rounded-full mb-2 relative z-10"></div>
             <p class="text-gray-500 text-sm font-bold relative z-10">ATFAL FUN</p>
         </div>

       </div>
     </section>
   </div>

   <div id="products-view" class="hidden max-w-6xl mx-auto px-4 py-6 min-h-screen">
     <div class="bg-white/80 backdrop-blur-md px-4 py-3 rounded-2xl sticky top-24 z-40 flex justify-between items-center mb-8 shadow-sm border border-white">
       <div class="flex items-center gap-2">
           <div class="w-2 h-8 bg-brand rounded-full"></div>
           <h3 id="cat-title" class="text-2xl font-bold text-brand-dark"></h3>
       </div>
       <button onclick="goHome()" class="px-4 py-2 bg-gray-100 rounded-xl text-sm font-bold text-gray-600 hover:text-brand hover:bg-white shadow-sm transition">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ğŸ </button>
     </div>
     
     <div id="loading-msg" class="text-center py-20 text-brand hidden font-bold">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
     <div id="grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
     <div id="empty-msg" class="hidden text-center py-20">
         <div class="text-6xl mb-4 opacity-30 grayscale">ğŸ‘Ÿ</div>
         <p class="text-gray-400 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
     </div>
   </div>

   <div id="modal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
     <div class="bg-white w-full max-w-md rounded-[2rem] overflow-hidden shadow-2xl max-h-[95vh] overflow-y-auto relative flex flex-col border-4 border-white">
       <button onclick="closeModal()" class="absolute top-4 left-4 bg-white/90 hover:bg-red-500 hover:text-white w-10 h-10 rounded-full z-20 text-gray-800 shadow-lg transition font-bold text-xl flex items-center justify-center">âœ•</button>
       
       <div class="bg-gray-50 h-72 flex items-center justify-center relative shrink-0">
         <img id="main-img" class="max-h-full max-w-full object-contain drop-shadow-xl mix-blend-multiply">
         <div id="thumbs" class="absolute bottom-4 flex gap-2 justify-center w-full px-2"></div>
       </div>

       <div class="p-6">
         <h2 id="m-name" class="text-2xl font-bold text-center mb-1 text-gray-800"></h2>
         <p id="m-price" class="text-3xl font-black text-brand text-center mb-6"></p>
         
         <div class="mb-6 text-center">
             <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-widest">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³</p>
             <div id="m-sizes" class="flex flex-wrap justify-center gap-2"></div>
         </div>

         <div class="mb-6 p-4 bg-green-50 rounded-2xl border border-green-100 flex items-center gap-3">
             <div class="w-10 h-10 rounded-full bg-green-500 text-white flex items-center justify-center text-xl shadow-lg shadow-green-200">ğŸ’¸</div>
             <div>
                 <p class="text-xs text-gray-500 font-bold mb-1">Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</p>
                 <p class="text-lg font-black text-gray-800 tracking-widest font-mono">01020468021</p>
             </div>
         </div>

         <div class="space-y-3 pt-4 border-t border-gray-100">
           <input id="c-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠ" class="input-glass w-full p-4 rounded-xl text-sm font-bold text-gray-700">
           <input id="c-phone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="input-glass w-full p-4 rounded-xl text-sm font-bold text-gray-700">
           <input id="c-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„" class="input-glass w-full p-4 rounded-xl text-sm font-bold text-gray-700">
           <button onclick="sendOrder()" class="btn-glass w-full py-4 rounded-xl font-bold mt-2 text-lg shadow-lg">
             ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ğŸ›’
           </button>
         </div>
       </div>
     </div>
   </div>

   <div id="admin-panel" class="hidden fixed inset-0 z-50 bg-[#1a1a1a] overflow-y-auto text-white">
     <div class="p-4 max-w-2xl mx-auto">
       <header class="flex justify-between items-center mb-8 border-b border-gray-800 pb-4 sticky top-0 bg-[#1a1a1a] z-10 pt-4">
         <h2 class="text-2xl font-bold text-brand flex items-center gap-2">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
         <button onclick="toggleAdmin()" class="text-gray-400 hover:text-white transition">Ø¥ØºÙ„Ø§Ù‚</button>
       </header>

       <div class="bg-gray-900 p-4 rounded-xl mb-8 border border-gray-800">
           <div class="flex gap-3">
               <button onclick="exportData()" class="flex-1 bg-blue-600/20 text-blue-400 border border-blue-600/30 py-2 rounded-lg text-xs font-bold hover:bg-blue-600 hover:text-white transition">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø©</button>
               <button onclick="document.getElementById('import-file').click()" class="flex-1 bg-green-600/20 text-green-400 border border-green-600/30 py-2 rounded-lg text-xs font-bold hover:bg-green-600 hover:text-white transition">ğŸ“¤ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù†Ø³Ø®Ø©</button>
               <input type="file" id="import-file" accept=".json" class="hidden" onchange="importData(this)">
           </div>
       </div>

       <div class="bg-gray-900 p-6 rounded-xl mb-8 border border-gray-800">
         <h3 class="font-bold mb-4 text-brand-light">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„</h3>
         <div class="space-y-4">
           <div class="border-2 border-dashed border-gray-700 bg-gray-800/50 p-6 text-center rounded-xl cursor-pointer hover:border-brand transition group" onclick="document.getElementById('file-in').click()">
             <input type="file" id="file-in" multiple accept="image/*" class="hidden" onchange="handleFiles(this)">
             <div id="upload-placeholder" class="group-hover:scale-105 transition-transform">
                 <span class="text-3xl block mb-2 opacity-50">ğŸ“¸</span>
                 <span class="text-sm text-gray-400 font-bold">Ø§Ø¶ØºØ· Ù„Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±</span>
             </div>
             <div id="preview" class="grid grid-cols-4 gap-2 mt-2 hidden"></div>
           </div>
           <p id="file-msg" class="text-xs text-brand mt-1 text-center hidden"></p>
           <input id="new-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„" class="w-full bg-gray-800 border border-gray-700 p-3 rounded-xl text-white focus:border-brand outline-none">
           <div class="flex gap-3">
             <input id="new-price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="flex-1 bg-gray-800 border border-gray-700 p-3 rounded-xl text-white focus:border-brand outline-none">
             <select id="new-cat" class="flex-1 bg-gray-800 border border-gray-700 p-3 rounded-xl text-white focus:border-brand outline-none">
               <option value="Ø±Ø¬Ø§Ù„ÙŠ">Ø±Ø¬Ø§Ù„ÙŠ</option><option value="Ø­Ø±ÙŠÙ…ÙŠ">Ø­Ø±ÙŠÙ…ÙŠ</option><option value="Ø£Ø·ÙØ§Ù„ÙŠ">Ø£Ø·ÙØ§Ù„ÙŠ</option>
             </select>
           </div>
           <div id="size-options" class="flex flex-wrap gap-2 p-3 bg-gray-800 rounded-xl"></div>
           <button onclick="addProduct()" id="add-btn" class="w-full py-3 rounded-xl font-bold bg-brand text-white hover:bg-brand-light hover:text-brand-dark transition">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</button>
         </div>
       </div>
       <h3 class="font-bold mb-4 flex items-center gap-2">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª <span id="count-badge" class="text-xs bg-gray-700 text-white px-2 rounded-full">0</span></h3>
       <div id="admin-list" class="space-y-3 pb-10"></div>
     </div>
   </div>

   <script>
    // === Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ† ===
    const dbName = "AhmedShoesDB_White_Final";
    const storeName = "products";
    let db;
    // Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø­Ø¯Ø«
    const whatsapp = "201020468021"; 

    function openDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(dbName, 1);
            request.onupgradeneeded = (e) => {
                db = e.target.result;
                if (!db.objectStoreNames.contains(storeName)) db.createObjectStore(storeName, { keyPath: "id" });
            };
            request.onsuccess = (e) => { db = e.target.result; resolve(db); };
            request.onerror = () => reject("DB Error");
        });
    }

    function saveProductToDB(product) {
        return new Promise((resolve) => {
            const tx = db.transaction([storeName], "readwrite");
            tx.objectStore(storeName).put(product);
            tx.oncomplete = () => resolve(true);
        });
    }

    function getAllProducts() {
        return new Promise((resolve) => {
            if(!db) return resolve([]);
            const tx = db.transaction([storeName], "readonly");
            tx.objectStore(storeName).getAll().onsuccess = (e) => resolve(e.target.result || []);
        });
    }

    function deleteProductFromDB(id) {
        return new Promise((resolve) => {
            const tx = db.transaction([storeName], "readwrite");
            tx.objectStore(storeName).delete(id);
            tx.oncomplete = () => resolve(true);
        });
    }

    let products = [];
    let currentProd = null, currentSize = null, newImages = [], newSizes = [];

    async function init() {
        await openDB();
        products = await getAllProducts();
        updateSizeOpts();
    }
    init();

    // === Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± ===
    function handleFiles(input) {
      const files = [...input.files].slice(0, 4);
      const preview = document.getElementById('preview');
      const placeholder = document.getElementById('upload-placeholder');
      const msg = document.getElementById('file-msg');
      placeholder.classList.add('hidden');
      preview.classList.remove('hidden');
      msg.classList.remove('hidden');
      msg.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";
      newImages = []; 
      let processedCount = 0;
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.src = e.target.result;
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const maxWidth = 800; 
            let w = img.width, h = img.height;
            if (w > maxWidth) { h *= maxWidth / w; w = maxWidth; }
            canvas.width = w; canvas.height = h;
            ctx.drawImage(img, 0, 0, w, h);
            newImages.push(canvas.toDataURL('image/jpeg', 0.7));
            processedCount++;
            if(processedCount === files.length) {
                renderPreview();
                msg.innerText = "âœ… Ø¬Ø§Ù‡Ø²";
            }
          }
        };
        reader.readAsDataURL(file);
      });
    }

    function renderPreview() {
        const preview = document.getElementById('preview');
        preview.innerHTML = '';
        newImages.forEach(img => {
            preview.innerHTML += `<div class="aspect-square rounded-lg bg-cover bg-center border border-brand/50" style="background-image: url('${img}')"></div>`;
        });
    }

    // === Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ===
    async function addProduct() {
      const btn = document.getElementById('add-btn');
      const name = document.getElementById('new-name').value;
      const price = document.getElementById('new-price').value;
      if(!name || !price || !newImages.length || !newSizes.length) return alert('Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©');
      btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
      btn.disabled = true;
      const newItem = {
        id: Date.now(),
        name, price,
        category: document.getElementById('new-cat').value,
        images: newImages,
        sizes: newSizes
      };
      await saveProductToDB(newItem);
      products = await getAllProducts();
      alert('ØªÙ… Ø§Ù„Ø­ÙØ¸');
      document.getElementById('new-name').value = '';
      document.getElementById('new-price').value = '';
      document.getElementById('upload-placeholder').classList.remove('hidden');
      document.getElementById('preview').classList.add('hidden');
      document.getElementById('file-msg').classList.add('hidden');
      newImages = []; newSizes = []; updateSizeOpts();
      renderAdminList();
      btn.innerText = "Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„";
      btn.disabled = false;
    }

    async function deleteProduct(id) {
      if(confirm('Ø­Ø°ÙØŸ')) {
        await deleteProductFromDB(id);
        products = await getAllProducts();
        renderAdminList();
      }
    }

    function renderAdminList() {
      const list = document.getElementById('admin-list');
      document.getElementById('count-badge').innerText = products.length;
      list.innerHTML = products.map(p => `
        <div class="bg-gray-800 p-3 rounded-xl flex justify-between items-center mb-2 border border-gray-700">
          <div class="flex gap-4 items-center">
            <img src="${p.images[0]}" class="w-12 h-12 rounded-lg object-cover border border-gray-600">
            <div>
                <div class="font-bold text-white">${p.name}</div>
                <div class="text-xs text-brand font-bold">${p.price} Ø¬.Ù…</div>
            </div>
          </div>
          <button onclick="deleteProduct(${p.id})" class="text-red-400 hover:text-red-300">âœ•</button>
        </div>
      `).join('');
    }

    async function exportData() {
        if(!products.length) return alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª');
        const blob = new Blob([JSON.stringify(products)], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `backup_${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }

    function importData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = async (e) => {
            try {
                const imported = JSON.parse(e.target.result);
                if (confirm(`Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ${imported.length} Ù…Ù†ØªØ¬ØŸ`)) {
                    for (const p of imported) await saveProductToDB(p);
                    products = await getAllProducts();
                    renderAdminList();
                    alert('ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹');
                }
            } catch (err) { alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ù„Ù'); }
        };
        reader.readAsText(file);
    }

    // === UI ===
    function updateSizeOpts() {
      const cat = document.getElementById('new-cat').value;
      let sizes = cat === 'Ø±Ø¬Ø§Ù„ÙŠ' ? [40,41,42,43,44,45] : (cat === 'Ø­Ø±ÙŠÙ…ÙŠ' ? [37,38,39,40,41] : [25,26,27,28,29,30,31,32,33,34,35]);
      newSizes = [];
      document.getElementById('size-options').innerHTML = sizes.map(s => 
        `<button onclick="toggleNewSize(${s}, this)" class="w-8 h-8 rounded-lg bg-gray-700 text-xs font-bold text-gray-300 hover:bg-gray-600 transition border border-transparent">${s}</button>`
      ).join('');
    }

    function toggleNewSize(s, btn) {
      if(newSizes.includes(s)) {
        newSizes = newSizes.filter(x => x !== s);
        btn.classList.remove('border-brand', 'text-white', 'bg-brand/20');
      } else {
        newSizes.push(s);
        btn.classList.add('border-brand', 'text-white', 'bg-brand/20');
      }
    }

    document.getElementById('new-cat').addEventListener('change', updateSizeOpts);

    async function showCategory(cat) {
      document.getElementById('home-view').classList.add('hidden');
      document.getElementById('products-view').classList.remove('hidden');
      document.getElementById('cat-title').innerText = cat;
      document.getElementById('grid').innerHTML = '';
      products = await getAllProducts();
      const items = products.filter(p => p.category === cat);
      if(!items.length) {
        document.getElementById('empty-msg').classList.remove('hidden');
        return;
      }
      document.getElementById('empty-msg').classList.add('hidden');
      document.getElementById('grid').innerHTML = items.map(p => `
        <div onclick="openModal(${p.id})" class="bg-white rounded-2xl overflow-hidden cursor-pointer group relative shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100">
          <div class="h-48 relative overflow-hidden bg-gray-50">
            <img src="${p.images[0]}" class="w-full h-full object-cover group-hover:scale-105 transition duration-700 mix-blend-multiply">
            <div class="absolute top-2 left-2 bg-white/90 backdrop-blur-sm text-brand-dark px-2 py-1 text-xs font-bold rounded-lg shadow-sm">Ø¬Ø¯ÙŠØ¯</div>
          </div>
          <div class="p-4">
             <div class="flex justify-between items-start mb-1">
                 <h4 class="font-bold text-gray-800 text-sm truncate flex-1">${p.name}</h4>
                 <span class="text-brand font-black text-sm">${p.price}</span>
             </div>
             <p class="text-xs text-gray-400">${p.sizes.length} Ù…Ù‚Ø§Ø³Ø§Øª</p>
          </div>
        </div>
      `).join('');
    }

    function goHome() {
      document.getElementById('products-view').classList.add('hidden');
      document.getElementById('home-view').classList.remove('hidden');
    }

    async function toggleAdmin() {
      const p = document.getElementById('admin-panel');
      if(p.classList.contains('hidden')) {
        const pass = prompt('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:');
        if(pass === 'admin123') {
           p.classList.remove('hidden');
           products = await getAllProducts();
           renderAdminList();
        } else alert('Ø®Ø·Ø£');
      } else p.classList.add('hidden');
    }

    // === Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ===
    function openModal(id) {
      currentProd = products.find(p => p.id === id);
      const modal = document.getElementById('modal');
      modal.classList.remove('hidden');
      document.getElementById('m-name').innerText = currentProd.name;
      document.getElementById('m-price').innerText = currentProd.price + ' Ø¬.Ù…';
      const main = document.getElementById('main-img');
      main.src = currentProd.images[0];
      document.getElementById('thumbs').innerHTML = currentProd.images.map(src => `
        <div onclick="document.getElementById('main-img').src='${src}'" 
             class="w-12 h-12 rounded-lg border border-gray-200 cursor-pointer overflow-hidden hover:border-brand transition">
             <img src="${src}" class="w-full h-full object-cover">
        </div>
      `).join('');
      document.getElementById('m-sizes').innerHTML = currentProd.sizes.map(s => `
        <button onclick="selectSize(${s}, this)" class="w-8 h-8 rounded-lg bg-gray-100 text-xs font-bold text-gray-600 hover:bg-gray-200 border border-transparent transition">${s}</button>
      `).join('');
    }

    function selectSize(s, btn) {
      currentSize = s;
      document.querySelectorAll('#m-sizes button').forEach(b => b.classList.remove('border-brand', 'bg-brand/10', 'text-brand'));
      btn.classList.add('border-brand', 'bg-brand/10', 'text-brand');
    }

    function closeModal() { document.getElementById('modal').classList.add('hidden'); }

    function sendOrder() {
      const name = document.getElementById('c-name').value;
      const addr = document.getElementById('c-address').value;
      const phone = document.getElementById('c-phone').value;
      if(!currentSize || !name || !addr) return alert('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
      const msg = `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯: \nğŸ‘Ÿ ${currentProd.name}\nğŸ“ ${currentSize}\nğŸ’° ${currentProd.price}\nğŸ‘¤ ${name}\nğŸ“ ${phone}\nğŸ“ ${addr}`;
      window.open(`https://wa.me/${whatsapp}?text=${encodeURIComponent(msg)}`, '_blank');
      closeModal();
    }
   </script>
 </body>
</html>
