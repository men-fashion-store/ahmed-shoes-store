<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® - Ù„Ù„Ø£Ø­Ø°ÙŠØ©</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: { 
        extend: { 
          colors: { 
            brand: { 
              light: '#f1f8e9', // Ø®Ù„ÙÙŠØ§Øª ÙØ§ØªØ­Ø© Ø¬Ø¯Ø§Ù‹
              DEFAULT: '#556b2f', // Ø²ÙŠØªÙŠ (Olive Green)
              dark: '#33401c',   // Ø²ÙŠØªÙŠ ØºØ§Ù…Ù‚ Ù„Ù„Ù†ØµÙˆØµ
              accent: '#8C9E5E'  // Ø²ÙŠØªÙŠ Ù…ØªÙˆØ³Ø·
            } 
          },
          boxShadow: {
            'glass-light': '0 8px 32px 0 rgba(31, 38, 135, 0.1)',
            'glass-hover': '0 8px 32px 0 rgba(85, 107, 47, 0.25)'
          }
        } 
      } 
    }
  </script>
  
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f9fafb; color: #1a1a1a; }
    
    /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ Ù…Ø¹ Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø§Ù„Ø´ÙØ§Ù (Watermark) */
    .brand-bg {
      background-color: #ffffff;
      background-image: 
        linear-gradient(rgba(255, 255, 255, 0.92), rgba(255, 255, 255, 0.96)),
        url('Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png');
      background-size: 500px; /* Ø­Ø¬Ù… Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© */
      background-position: center; 
      background-attachment: fixed; 
      background-repeat: repeat; /* ØªÙƒØ±Ø§Ø± Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙƒØ®Ù„ÙÙŠØ© */
    }

    /* Ø§Ù„Ø²Ø¬Ø§Ø¬ Ø§Ù„Ø´ÙØ§Ù (Light Glass) */
    .glass-panel {
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.8);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
    }

    /* ÙƒØ±ÙˆØª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© */
    .cat-glass {
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.9);
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .cat-glass:hover {
      background: rgba(255, 255, 255, 0.8);
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(85, 107, 47, 0.15);
      border-color: #556b2f;
    }

    /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    .btn-brand {
      background: linear-gradient(135deg, #556b2f 0%, #33401c 100%);
      color: white;
      transition: all 0.3s;
    }
    .btn-brand:hover {
      background: linear-gradient(135deg, #6b8c3a 0%, #556b2f 100%);
      box-shadow: 0 5px 15px rgba(85, 107, 47, 0.4);
    }

    /* Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
    .input-glass {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid #e5e7eb;
      color: #333;
    }
    .input-glass:focus {
      border-color: #556b2f;
      background: #fff;
      outline: none;
      box-shadow: 0 0 0 3px rgba(85, 107, 47, 0.1);
    }
    
    .modal-overlay { background: rgba(255,255,255,0.8); backdrop-filter: blur(8px); }
  </style>
 </head>
 <body class="h-full brand-bg min-h-screen overflow-auto selection:bg-brand-accent selection:text-white">

   <header class="glass-panel p-3 sticky top-0 z-50 border-b border-gray-100 shadow-sm">
     <div class="max-w-6xl mx-auto flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-white rounded-xl flex items-center justify-center border border-gray-100 shadow-sm overflow-hidden">
            <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" alt="Logo" class="w-full h-full object-contain p-1" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2589/2589903.png'">
        </div>
        <div>
            <h1 class="text-xl font-bold leading-none text-brand-dark">Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®</h1>
            <span class="text-xs text-brand font-bold tracking-widest uppercase">Shoes Store</span>
        </div>
      </div>
      <button onclick="toggleAdmin()" class="px-4 py-2 rounded-xl bg-white text-brand-dark border border-gray-200 text-xs font-bold hover:bg-brand hover:text-white transition shadow-sm">ğŸ” Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
     </div>
   </header>

   <div id="home-view">
     <section class="min-h-[60vh] flex flex-col items-center justify-center text-center px-4 pt-10">
       
       <div class="relative w-40 h-40 mb-6 group cursor-pointer">
           <div class="absolute inset-0 bg-brand/10 rounded-full blur-2xl group-hover:bg-brand/20 transition duration-500"></div>
           <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" class="relative z-10 w-full h-full object-contain drop-shadow-xl transform group-hover:scale-110 transition duration-500" onerror="this.style.display='none'">
       </div>

       <h2 class="text-4xl md:text-6xl font-black mb-3 text-brand-dark tracking-tight">Ø§ÙƒØªØ´Ù <span class="text-brand">Ø£Ù†Ø§Ù‚ØªÙƒ</span></h2>
       <p class="text-gray-500 mb-8 font-medium">Ø£Ø±Ù‚Ù‰ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© ÙˆØ§Ù„ÙƒÙ„Ø§Ø³ÙŠÙƒÙŠØ© Ø¨ÙŠÙ† ÙŠØ¯ÙŠÙƒ</p>
       
       <button onclick="document.getElementById('cats').scrollIntoView({behavior: 'smooth'})" class="btn-brand px-10 py-4 rounded-full font-bold text-lg shadow-lg animate-bounce">
         ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù† â†“
       </button>
     </section>

     <section id="cats" class="max-w-6xl mx-auto px-4 py-16">
       <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
       
         <div onclick="showCategory('Ø±Ø¬Ø§Ù„ÙŠ')" class="cat-glass p-6 rounded-3xl text-center cursor-pointer group relative overflow-hidden">
             <div class="w-32 h-32 mx-auto mb-4 relative z-10">
                 <img src="men.png" class="w-full h-full object-contain drop-shadow-lg group-hover:scale-110 transition duration-500" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3043/3043888.png'">
             </div>
             <h3 class="text-2xl font-black text-brand-dark mb-1">RAGOL SPORT</h3>
             <p class="text-gray-500 text-sm font-bold">Ø£Ø­Ø¯Ø« Ø§Ù„ÙƒÙˆØªØ´ÙŠØ§Øª Ø§Ù„Ø±Ø¬Ø§Ù„ÙŠ</p>
         </div>

         <div onclick="showCategory('Ø­Ø±ÙŠÙ…ÙŠ')" class="cat-glass p-6 rounded-3xl text-center cursor-pointer group relative overflow-hidden">
             <div class="w-32 h-32 mx-auto mb-4 relative z-10">
                 <img src="women.png" class="w-full h-full object-contain drop-shadow-lg group-hover:scale-110 transition duration-500" onerror="this.src='https://cdn-icons-png.flaticon.com/512/9463/9463177.png'">
             </div>
             <h3 class="text-2xl font-black text-brand-dark mb-1">SITTAT CHIC</h3>
             <p class="text-gray-500 text-sm font-bold">Ø£Ù†Ø§Ù‚Ø© ÙˆØ±Ø§Ø­Ø© Ù„Ø®Ø·ÙˆØ§ØªÙƒ</p>
         </div>

         <div onclick="showCategory('Ø£Ø·ÙØ§Ù„ÙŠ')" class="cat-glass p-6 rounded-3xl text-center cursor-pointer group relative overflow-hidden">
             <div class="w-32 h-32 mx-auto mb-4 relative z-10">
                 <img src="kids.png" class="w-full h-full object-contain drop-shadow-lg group-hover:scale-110 transition duration-500" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3082/3082060.png'">
             </div>
             <h3 class="text-2xl font-black text-brand-dark mb-1">ATFAL FUN</h3>
             <p class="text-gray-500 text-sm font-bold">Ù„Ø£Ø¨Ø·Ø§Ù„Ù†Ø§ Ø§Ù„ØµØºØ§Ø±</p>
         </div>

       </div>
     </section>
   </div>

   <div id="products-view" class="hidden max-w-6xl mx-auto px-4 py-6 min-h-screen">
     <div class="glass-panel px-4 py-3 rounded-2xl sticky top-24 z-40 flex justify-between items-center mb-8 shadow-glass-light">
       <div class="flex items-center gap-2">
           <div class="w-2 h-8 bg-brand rounded-full"></div>
           <h3 id="cat-title" class="text-2xl font-bold text-brand-dark"></h3>
       </div>
       <button onclick="goHome()" class="px-4 py-2 bg-white rounded-xl text-sm font-bold text-gray-600 hover:text-brand hover:shadow-md transition">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ğŸ </button>
     </div>
     
     <div id="loading-msg" class="text-center py-20 text-brand hidden">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
     <div id="grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
     <div id="empty-msg" class="hidden text-center py-20">
         <div class="text-6xl mb-4 opacity-30 grayscale">ğŸ‘Ÿ</div>
         <p class="text-gray-400 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
     </div>
   </div>

   <div id="modal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
     <div class="bg-white w-full max-w-md rounded-3xl overflow-hidden shadow-2xl max-h-[95vh] overflow-y-auto relative flex flex-col">
       <button onclick="closeModal()" class="absolute top-4 left-4 bg-white/80 hover:bg-white w-10 h-10 rounded-full z-20 text-gray-800 shadow-md transition font-bold text-xl">âœ•</button>
       
       <div class="bg-gray-50 h-80 flex items-center justify-center relative shrink-0">
         <img id="main-img" class="max-h-full max-w-full object-contain drop-shadow-xl">
         <div id="thumbs" class="absolute bottom-4 flex gap-2 justify-center w-full px-2"></div>
       </div>

       <div class="p-6">
         <h2 id="m-name" class="text-2xl font-bold text-center mb-1 text-gray-800"></h2>
         <p id="m-price" class="text-3xl font-black text-brand text-center mb-6"></p>
         
         <div class="mb-6 text-center">
             <p class="text-xs text-gray-400 mb-2 font-bold uppercase">Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</p>
             <div id="m-sizes" class="flex flex-wrap justify-center gap-2"></div>
         </div>

         <div class="space-y-3 pt-6 border-t border-gray-100">
           <input id="c-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠ" class="input-glass w-full p-4 rounded-xl text-sm font-medium">
           <input id="c-phone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="input-glass w-full p-4 rounded-xl text-sm font-medium">
           <input id="c-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„" class="input-glass w-full p-4 rounded-xl text-sm font-medium">
           <button onclick="sendOrder()" class="btn-brand w-full py-4 rounded-xl font-bold mt-2 text-lg shadow-lg">
             ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ğŸ›’
           </button>
         </div>
       </div>
     </div>
   </div>

   <div id="admin-panel" class="hidden fixed inset-0 z-50 bg-[#1a1a1a] overflow-y-auto text-white">
     <div class="p-4 max-w-2xl mx-auto">
       <header class="flex justify-between items-center mb-8 border-b border-gray-800 pb-4 sticky top-0 bg-[#1a1a1a] z-10 pt-4">
         <h2 class="text-2xl font-bold text-brand flex items-center gap-2">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
         <button onclick="toggleAdmin()" class="text-gray-400 hover:text-white transition">Ø¥ØºÙ„Ø§Ù‚</button>
       </header>

       <div class="bg-gray-900 p-4 rounded-xl mb-8 border border-gray-800">
           <div class="flex gap-3">
               <button onclick="exportData()" class="flex-1 bg-blue-600/20 text-blue-400 border border-blue-600/30 py-2 rounded-lg text-xs font-bold hover:bg-blue-600 hover:text-white transition">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø©</button>
               <button onclick="document.getElementById('import-file').click()" class="flex-1 bg-green-600/20 text-green-400 border border-green-600/30 py-2 rounded-lg text-xs font-bold hover:bg-green-600 hover:text-white transition">ğŸ“¤ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù†Ø³Ø®Ø©</button>
               <input type="file" id="import-file" accept=".json" class="hidden" onchange="importData(this)">
           </div>
       </div>

       <div class="bg-gray-900 p-6 rounded-xl mb-8 border border-gray-800">
         <h3 class="font-bold mb-4 text-brand-light">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„</h3>
         <div class="space-y-4">
           
           <div class="border-2 border-dashed border-gray-700 bg-gray-800/50 p-6 text-center rounded-xl cursor-pointer hover:border-brand transition group" onclick="document.getElementById('file-in').click()">
             <input type="file" id="file-in" multiple accept="image/*" class="hidden" onchange="handleFiles(this)">
             <div id="upload-placeholder" class="group-hover:scale-105 transition-transform">
                 <span class="text-3xl block mb-2 opacity-50">ğŸ“¸</span>
                 <span class="text-sm text-gray-400 font-bold">Ø§Ø¶ØºØ· Ù„Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±</span>
             </div>
             <div id="preview" class="grid grid-cols-4 gap-2 mt-2 hidden"></div>
           </div>
           <p id="file-msg" class="text-xs text-brand mt-1 text-center hidden"></p>

           <input id="new-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„" class="w-full bg-gray-800 border border-gray-700 p-3 rounded-xl text-white focus:border-brand outline-none">
           
           <div class="flex gap-3">
             <input id="new-price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="flex-1 bg-gray-800 border border-gray-700 p-3 rounded-xl text-white focus:border-brand outline-none">
             <select id="new-cat" class="flex-1 bg-gray-800 border border-gray-700 p-3 rounded-xl text-white focus:border-brand outline-none">
               <option value="Ø±Ø¬Ø§Ù„ÙŠ">Ø±Ø¬Ø§Ù„ÙŠ</option>
               <option value="Ø­Ø±ÙŠÙ…ÙŠ">Ø­Ø±ÙŠÙ…ÙŠ</option>
               <option value="Ø£Ø·ÙØ§Ù„ÙŠ">Ø£Ø·ÙØ§Ù„ÙŠ</option>
             </select>
           </div>
           
           <div id="size-options" class="flex flex-wrap gap-2 p-3 bg-gray-800 rounded-xl"></div>
           
           <button onclick="addProduct()" id="add-btn" class="w-full py-3 rounded-xl font-bold bg-brand text-white hover:bg-brand-accent transition">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</button>
         </div>
       </div>

       <h3 class="font-bold mb-4 flex items-center gap-2">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª <span id="count-badge" class="text-xs bg-gray-700 text-white px-2 rounded-full">0</span></h3>
       <div id="admin-list" class="space-y-3 pb-10"></div>
     </div>
   </div>

   <script>
    // === IndexedDB ===
    const dbName = "AhmedShoesDB_White";
    const storeName = "products";
    let db;

    function openDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(dbName, 1);
            request.onupgradeneeded = (e) => {
                db = e.target.result;
                if (!db.objectStoreNames.contains(storeName)) db.createObjectStore(storeName, { keyPath: "id" });
            };
            request.onsuccess = (e) => { db = e.target.result; resolve(db); };
            request.onerror = () => reject("DB Error");
        });
    }

    function saveProductToDB(product) {
        return new Promise((resolve) => {
            const tx = db.transaction([storeName], "readwrite");
            tx.objectStore(storeName).put(product);
            tx.oncomplete = () => resolve(true);
        });
    }

    function getAllProducts() {
        return new Promise((resolve) => {
            if(!db) return resolve([]);
            const tx = db.transaction([storeName], "readonly");
            tx.objectStore(storeName).getAll().onsuccess = (e) => resolve(e.target.result || []);
        });
    }

    function deleteProductFromDB(id) {
        return new Promise((resolve) => {
            const tx = db.transaction([storeName], "readwrite");
            tx.objectStore(storeName).delete(id);
            tx.oncomplete = () => resolve(true);
        });
    }

    // === Logic ===
    let products = [];
    let currentProd = null, currentSize = null, newImages = [], newSizes = [];
    const whatsapp = "01000000000"; 

    async function init() {
        await openDB();
        products = await getAllProducts();
        updateSizeOpts();
    }
    init();

    // === Images ===
    function handleFiles(input) {
      const files = [...input.files].slice(0, 4);
      const preview = document.getElementById('preview');
      const placeholder = document.getElementById('upload-placeholder');
      const msg = document.getElementById('file-msg');
      
      placeholder.classList.add('hidden');
      preview.classList.remove('hidden');
      msg.classList.remove('hidden');
      msg.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...";
      
      newImages = []; 
      let processedCount = 0;

      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.src = e.target.result;
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const maxWidth = 800; 
            let w = img.width, h = img.height;
            if (w > maxWidth) { h *= maxWidth / w; w = maxWidth; }
            canvas.width = w; canvas.height = h;
            ctx.drawImage(img, 0, 0, w, h);
            newImages.push(canvas.toDataURL('image/jpeg', 0.7));
            processedCount++;
            if(processedCount === files.length) {
                renderPreview();
                msg.innerText = "âœ… Ø¬Ø§Ù‡Ø²";
            }
          }
        };
        reader.readAsDataURL(file);
      });
    }

    function renderPreview() {
        const preview = document.getElementById('preview');
        preview.innerHTML = '';
        newImages.forEach(img => {
            preview.innerHTML += `<div class="aspect-square rounded-lg bg-cover bg-center border border-brand/50" style="background-image: url('${img}')"></div>`;
        });
    }

    // === Admin ===
    async function addProduct() {
      const btn = document.getElementById('add-btn');
      const name = document.getElementById('new-name').value;
      const price = document.getElementById('new-price').value;
      
      if(!name || !price || !newImages.length || !newSizes.length) return alert('Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©');
      
      btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
      btn.disabled = true;

      const newItem = {
        id: Date.now(),
        name, price,
        category: document.getElementById('new-cat').value,
        images: newImages,
        sizes: newSizes
      };

      await saveProductToDB(newItem);
      products = await getAllProducts();
      
      alert('ØªÙ… Ø§Ù„Ø­ÙØ¸');
      document.getElementById('new-name').value = '';
      document.getElementById('new-price').value = '';
      document.getElementById('upload-placeholder').classList.remove('hidden');
      document.getElementById('preview').classList.add('hidden');
      document.getElementById('file-msg').classList.add('hidden');
      newImages = []; newSizes = []; updateSizeOpts();
      renderAdminList();
      
      btn.innerText = "Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„";
      btn.disabled = false;
    }

    async function deleteProduct(id) {
      if(confirm('Ø­Ø°ÙØŸ')) {
        await deleteProductFromDB(id);
        products = await getAllProducts();
        renderAdminList();
      }
    }

    function renderAdminList() {
      const list = document.getElementById('admin-list');
      document.getElementById('count-badge').innerText = products.length;
      list.innerHTML = products.map(p => `
        <div class="bg-gray-800 p-3 rounded-xl flex justify-between items-center mb-2 border border-gray-700">
          <div class="flex gap-4 items-center">
            <img src="${p.images[0]}" class="w-12 h-12 rounded-lg object-cover border border-gray-600">
            <div>
                <div class="font-bold text-white">${p.name}</div>
                <div class="text-xs text-brand font-bold">${p.price} Ø¬.Ù…</div>
            </div>
          </div>
          <button onclick="deleteProduct(${p.id})" class="text-red-400 hover:text-red-300">âœ•</button>
        </div>
      `).join('');
    }

    // === Backup ===
    async function exportData() {
        if(!products.length) return alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª');
        const blob = new Blob([JSON.stringify(products)], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = `backup_${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }

    function importData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = async (e) => {
            try {
                const imported = JSON.parse(e.target.result);
                if (confirm(`Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ${imported.length} Ù…Ù†ØªØ¬ØŸ`)) {
                    for (const p of imported) await saveProductToDB(p);
                    products = await getAllProducts();
                    renderAdminList();
                    alert('ØªÙ… Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹');
                }
            } catch (err) { alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ù„Ù'); }
        };
        reader.readAsText(file);
    }

    // === UI ===
    function updateSizeOpts() {
      const cat = document.getElementById('new-cat').value;
      let sizes = cat === 'Ø±Ø¬Ø§Ù„ÙŠ' ? [40,41,42,43,44,45] : (cat === 'Ø­Ø±ÙŠÙ…ÙŠ' ? [37,38,39,40,41] : [25,26,27,28,29,30,31,32,33,34,35]);
      newSizes = [];
      document.getElementById('size-options').innerHTML = sizes.map(s => 
        `<button onclick="toggleNewSize(${s}, this)" class="w-8 h-8 rounded-lg bg-gray-700 text-xs font-bold text-gray-300 hover:bg-gray-600 transition border border-transparent">${s}</button>`
      ).join('');
    }

    function toggleNewSize(s, btn) {
      if(newSizes.includes(s)) {
        newSizes = newSizes.filter(x => x !== s);
        btn.classList.remove('border-brand', 'text-white', 'bg-brand/20');
      } else {
        newSizes.push(s);
        btn.classList.add('border-brand', 'text-white', 'bg-brand/20');
      }
    }

    document.getElementById('new-cat').addEventListener('change', updateSizeOpts);

    async function showCategory(cat) {
      document.getElementById('home-view').classList.add('hidden');
      document.getElementById('products-view').classList.remove('hidden');
      document.getElementById('cat-title').innerText = cat;
      document.getElementById('grid').innerHTML = '';
      
      products = await getAllProducts();
      const items = products.filter(p => p.category === cat);
      
      if(!items.length) {
        document.getElementById('empty-msg').classList.remove('hidden');
        return;
      }
      document.getElementById('empty-msg').classList.add('hidden');
      
      document.getElementById('grid').innerHTML = items.map(p => `
        <div onclick="openModal(${p.id})" class="bg-white rounded-2xl overflow-hidden cursor-pointer group relative shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100">
          <div class="h-48 relative overflow-hidden bg-gray-50">
            <img src="${p.images[0]}" class="w-full h-full object-cover group-hover:scale-105 transition duration-700">
            <div class="absolute top-2 left-2 bg-white/90 backdrop-blur-sm text-brand-dark px-2 py-1 text-xs font-bold rounded-lg shadow-sm">Ø¬Ø¯ÙŠØ¯</div>
          </div>
          <div class="p-4">
             <div class="flex justify-between items-start mb-1">
                 <h4 class="font-bold text-gray-800 text-sm truncate flex-1">${p.name}</h4>
                 <span class="text-brand font-black text-sm">${p.price}</span>
             </div>
             <p class="text-xs text-gray-400">${p.sizes.length} Ù…Ù‚Ø§Ø³Ø§Øª</p>
          </div>
        </div>
      `).join('');
    }

    function goHome() {
      document.getElementById('products-view').classList.add('hidden');
      document.getElementById('home-view').classList.remove('hidden');
    }

    async function toggleAdmin() {
      const p = document.getElementById('admin-panel');
      if(p.classList.contains('hidden')) {
        const pass = prompt('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:');
        if(pass === 'admin123') {
           p.classList.remove('hidden');
           products = await getAllProducts();
           renderAdminList();
        } else alert('Ø®Ø·Ø£');
      } else p.classList.add('hidden');
    }

    // === Modal ===
    function openModal(id) {
      currentProd = products.find(p => p.id === id);
      const modal = document.getElementById('modal');
      modal.classList.remove('hidden');
      
      document.getElementById('m-name').innerText = currentProd.name;
      document.getElementById('m-price').innerText = currentProd.price + ' Ø¬.Ù…';
      
      const main = document.getElementById('main-img');
      main.src = currentProd.images[0];
      
      document.getElementById('thumbs').innerHTML = currentProd.images.map(src => `
        <div onclick="document.getElementById('main-img').src='${src}'" 
             class="w-12 h-12 rounded-lg border border-gray-200 cursor-pointer overflow-hidden hover:border-brand transition">
             <img src="${src}" class="w-full h-full object-cover">
        </div>
      `).join('');

      document.getElementById('m-sizes').innerHTML = currentProd.sizes.map(s => `
        <button onclick="selectSize(${s}, this)" class="w-8 h-8 rounded-lg bg-gray-100 text-xs font-bold text-gray-600 hover:bg-gray-200 border border-transparent transition">${s}</button>
      `).join('');
    }

    function selectSize(s, btn) {
      currentSize = s;
      document.querySelectorAll('#m-sizes button').forEach(b => b.classList.remove('border-brand', 'bg-brand/10', 'text-brand'));
      btn.classList.add('border-brand', 'bg-brand/10', 'text-brand');
    }

    function closeModal() { document.getElementById('modal').classList.add('hidden'); }

    function sendOrder() {
      const name = document.getElementById('c-name').value;
      const addr = document.getElementById('c-address').value;
      const phone = document.getElementById('c-phone').value;
      
      if(!currentSize || !name || !addr) return alert('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
      
      const msg = `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯: \nğŸ‘Ÿ ${currentProd.name}\nğŸ“ ${currentSize}\nğŸ’° ${currentProd.price}\nğŸ‘¤ ${name}\nğŸ“ ${phone}\nğŸ“ ${addr}`;
      window.open(`https://wa.me/${whatsapp}?text=${encodeURIComponent(msg)}`, '_blank');
      closeModal();
    }
   </script>
 </body>
</html>
