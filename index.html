<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® - Ù„Ù„Ø£Ø­Ø°ÙŠØ©</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  
  <script>
    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† (Ø²ÙŠØªÙŠ ÙˆØ£Ø¨ÙŠØ¶ ÙØ®Ù…)
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              light: '#A4B494', // Ø²ÙŠØªÙŠ ÙØ§ØªØ­
              DEFAULT: '#708238', // Ø²ÙŠØªÙŠ ØºÙ†ÙŠ (Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ)
              dark: '#4B5726',   // Ø²ÙŠØªÙŠ ØºØ§Ù…Ù‚
              accent: '#EBEFE8'  // Ø£Ø¨ÙŠØ¶ Ø¯Ø®Ø§Ù†ÙŠ
            }
          }
        }
      }
    }
  </script>
  
  <style>
    /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¹Ø§Ù…Ø© */
    body { 
      font-family: 'Cairo', sans-serif; 
      background-color: #121212; 
      color: #ffffff; 
    }
    
    /* Ø§Ù„Ø®Ù„ÙÙŠØ© Ù…Ø¹ Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙƒØ¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ© */
    .brand-bg {
      background-image: 
        linear-gradient(rgba(18, 18, 18, 0.94), rgba(18, 18, 18, 0.97)),
        url('Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
    }

    /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ */
    .glass-effect { 
      background: rgba(30, 30, 30, 0.8); 
      backdrop-filter: blur(15px); 
      border-bottom: 1px solid rgba(112, 130, 56, 0.2); 
    }

    /* ÙƒØ±ÙˆØª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
    .product-card { 
      background: linear-gradient(145deg, #1e1e1e 0%, #151515 100%); 
      border: 1px solid #333; 
      transition: all 0.3s ease; 
    }
    .product-card:hover { 
      border-color: #708238; 
      transform: translateY(-5px); 
      box-shadow: 0 10px 30px rgba(112, 130, 56, 0.15); 
    }

    /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
    .btn-primary { 
      background: linear-gradient(135deg, #708238 0%, #4B5726 100%); 
      border: 1px solid #708238; 
      transition: all 0.3s; 
    }
    .btn-primary:hover { 
      background: linear-gradient(135deg, #8C9E5E 0%, #708238 100%); 
      box-shadow: 0 0 20px rgba(112, 130, 56, 0.6); 
    }

    /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª */
    .size-btn { border: 1px solid #333; transition: all 0.2s; }
    .size-btn.selected { background: #708238; color: #fff; border-color: #8C9E5E; transform: scale(1.1); box-shadow: 0 0 10px rgba(112, 130, 56, 0.4); }
    .size-btn.unavailable { background: #151515; color: #444; text-decoration: line-through; cursor: not-allowed; }
    
    /* Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…ØµØºØ±Ø© ÙÙŠ Ø§Ù„Ù…Ø¹Ø±Ø¶ */
    .thumbnail.active { border: 2px solid #708238; opacity: 1; transform: scale(1.05); }
    .thumbnail { opacity: 0.6; transition: all 0.2s; border: 2px solid transparent; }
    
    /* Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
    .input-field { background: #2d2d2d; border: 1px solid #444; color: white; transition: 0.3s; }
    .input-field:focus { border-color: #708238; box-shadow: 0 0 0 2px rgba(112, 130, 56, 0.2); }
    
    /* Ø­Ø±ÙƒØ§Øª ÙˆØªØ£Ø«ÙŠØ±Ø§Øª */
    .modal-overlay { background: rgba(0, 0, 0, 0.95); backdrop-filter: blur(5px); }
    .animate-fade-in { animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  </style>
 </head>
 <body class="h-full brand-bg min-h-screen overflow-auto">
  <div id="app" class="min-h-full w-full">
   
   <div id="home-page" class="min-h-full w-full">
    
    <header class="glass-effect p-3 sticky top-0 z-50">
     <div class="max-w-6xl mx-auto flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-white/5 rounded-lg p-1 flex items-center justify-center border border-white/10">
            <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" alt="Logo" class="w-full h-full object-contain">
        </div>
        <div>
            <h1 class="text-xl md:text-2xl font-bold text-white leading-none">Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®</h1>
            <span class="text-xs text-brand-light font-bold tracking-widest">SHOES STORE</span>
        </div>
      </div>
      <button onclick="showAdminLogin()" class="px-4 py-2 rounded-lg text-sm bg-white/5 hover:bg-white/10 border border-white/10 transition-colors">ğŸ” Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
     </div>
    </header>

    <section class="relative h-64 md:h-80 flex items-center justify-center overflow-hidden">
     <div class="text-center px-4 relative z-10">
      <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" class="h-28 mx-auto mb-4 opacity-90 drop-shadow-2xl animate-fade-in" alt="Big Logo">
      <h2 class="text-3xl font-black mb-4 animate-fade-in">Ø®Ø·ÙˆØ§ØªÙƒ.. Ø¹Ù†ÙˆØ§Ù† Ø£Ù†Ø§Ù‚ØªÙƒ</h2>
      <button onclick="document.getElementById('categories-section').scrollIntoView({behavior: 'smooth'})" class="btn-primary text-white px-8 py-3 rounded-full font-bold shadow-lg">
        ØªØµÙØ­ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª â†“
      </button>
     </div>
    </section>

    <section id="categories-section" class="max-w-6xl mx-auto px-4 py-8">
     <div class="grid grid-cols-3 gap-4">
       <button onclick="selectCategory('Ø±Ø¬Ø§Ù„ÙŠ')" class="product-card p-6 rounded-2xl text-center group">
         <div class="text-5xl mb-3 group-hover:scale-110 transition-transform text-brand">ğŸ‘</div>
         <h4 class="font-bold text-white group-hover:text-brand transition-colors">Ø±Ø¬Ø§Ù„ÙŠ</h4>
       </button>
       <button onclick="selectCategory('Ø­Ø±ÙŠÙ…ÙŠ')" class="product-card p-6 rounded-2xl text-center group">
         <div class="text-5xl mb-3 group-hover:scale-110 transition-transform text-brand">ğŸ‘ </div>
         <h4 class="font-bold text-white group-hover:text-brand transition-colors">Ø­Ø±ÙŠÙ…ÙŠ</h4>
       </button>
       <button onclick="selectCategory('Ø£Ø·ÙØ§Ù„ÙŠ')" class="product-card p-6 rounded-2xl text-center group">
         <div class="text-5xl mb-3 group-hover:scale-110 transition-transform text-brand">ğŸ‘Ÿ</div>
         <h4 class="font-bold text-white group-hover:text-brand transition-colors">Ø£Ø·ÙØ§Ù„ÙŠ</h4>
       </button>
     </div>
    </section>

    <section id="products-section" class="max-w-6xl mx-auto px-4 py-4 hidden min-h-screen">
     <div class="flex justify-between items-center mb-6 sticky top-20 z-40 py-3 bg-[#121212]/95 backdrop-blur-md border-b border-gray-800">
      <h3 id="category-title" class="text-xl font-bold text-brand-light border-r-4 border-brand pr-3">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
      <button onclick="goHome()" class="text-gray-400 hover:text-white text-sm flex items-center gap-1 transition-colors">âœ• Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø³Ù…</button>
     </div>
     
     <div id="products-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-6"></div>
     
     <div id="no-products" class="text-center py-20 text-gray-500 hidden">
      <div class="text-6xl mb-4 opacity-30">ğŸ“¦</div>
      <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ù…Ø¶Ø§ÙØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­Ø§Ù„ÙŠØ§Ù‹</p>
     </div>
    </section>
   </div>

   <div id="product-modal" class="fixed inset-0 z-[60] hidden modal-overlay flex items-center justify-center p-4">
    <div class="bg-[#1e1e1e] text-white rounded-2xl max-w-md w-full max-h-[95%] overflow-y-auto border border-gray-700 shadow-2xl animate-fade-in relative flex flex-col">
     
     <button onclick="closeProductModal()" class="absolute top-4 left-4 z-20 bg-black/60 hover:bg-black/80 w-9 h-9 rounded-full text-white flex items-center justify-center transition-colors">âœ•</button>

     <div class="relative bg-black w-full shrink-0">
       <div id="main-image-container" class="h-80 w-full flex items-center justify-center overflow-hidden bg-[#151515]">
         </div>
       <div id="thumbnails-container" class="absolute bottom-4 left-0 right-0 flex justify-center gap-2 px-4 z-10">
         </div>
       <div class="absolute bottom-0 left-0 right-0 h-20 bg-gradient-to-t from-black/80 to-transparent pointer-events-none"></div>
     </div>
     
     <div class="p-6 flex-1">
      <h3 id="modal-product-name" class="text-xl font-bold mb-2 text-center text-gray-100"></h3>
      
      <div class="text-center mb-6">
        <span id="modal-product-price" class="text-3xl font-black text-brand inline-block border-b-2 border-brand pb-1"></span>
      </div>
      
      <div class="mb-8 text-center">
       <p class="text-xs text-gray-400 mb-3 font-bold uppercase tracking-wider">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨</p>
       <div id="modal-sizes" class="flex flex-wrap gap-2 justify-center"></div>
      </div>
      
      <div class="space-y-3 pt-6 border-t border-gray-700">
        <p class="text-sm font-bold text-brand-light mb-2 flex items-center gap-2">ğŸ“ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù†:</p>
        <input type="text" id="customer-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠ" class="w-full px-4 py-3 rounded-xl input-field outline-none text-sm">
        <input type="tel" id="customer-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ÙˆØ§ØªØ³Ø§Ø¨)" class="w-full px-4 py-3 rounded-xl input-field outline-none text-sm">
        <input type="text" id="customer-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„ (Ø§Ù„Ù…Ù†Ø·Ù‚Ø© - Ø§Ù„Ø´Ø§Ø±Ø¹)" class="w-full px-4 py-3 rounded-xl input-field outline-none text-sm">
        
        <button onclick="submitOrder()" class="w-full btn-primary text-white py-4 rounded-xl font-bold mt-4 shadow-lg flex items-center justify-center gap-2 text-lg">
          <span>ğŸ›’</span> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†
        </button>
      </div>
     </div>
    </div>
   </div>

   <div id="admin-login-modal" class="fixed inset-0 z-[60] hidden modal-overlay flex items-center justify-center p-4">
    <div class="bg-[#1e1e1e] border border-gray-700 text-white rounded-2xl max-w-sm w-full p-8 text-center shadow-2xl">
     <div class="w-16 h-16 bg-brand/20 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">ğŸ”</div>
     <h3 class="text-xl font-bold mb-6">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
     <input type="password" id="admin-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full px-4 py-3 rounded-xl input-field outline-none mb-4 text-center tracking-widest">
     <div class="flex gap-2">
       <button onclick="checkAdminPassword()" class="flex-1 btn-primary py-2 rounded-xl font-bold">Ø¯Ø®ÙˆÙ„</button>
       <button onclick="closeAdminLogin()" class="flex-1 bg-gray-700 hover:bg-gray-600 py-2 rounded-xl font-bold transition-colors">Ø¥Ù„ØºØ§Ø¡</button>
     </div>
    </div>
   </div>

   <div id="admin-page" class="hidden min-h-screen bg-[#121212]">
    <header class="p-4 border-b border-gray-800 flex justify-between items-center bg-[#1e1e1e] sticky top-0 z-50">
      <h1 class="font-bold flex items-center gap-2 text-white"><span class="bg-brand px-2 py-1 rounded text-xs font-bold text-white">ADMIN</span> Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</h1>
      <button onclick="exitAdmin()" class="text-sm text-gray-400 hover:text-white transition-colors">Ø®Ø±ÙˆØ¬ ğŸšª</button>
    </header>
    
    <div class="max-w-4xl mx-auto p-4">
      <div class="flex gap-2 mb-6 bg-[#1e1e1e] p-1 rounded-xl border border-gray-800">
        <button onclick="showAdminTab('products')" id="btn-tab-products" class="flex-1 py-2 rounded-lg text-sm font-bold transition-all bg-brand text-white">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
        <button onclick="showAdminTab('orders')" id="btn-tab-orders" class="flex-1 py-2 rounded-lg text-sm font-bold transition-all text-gray-400 hover:bg-gray-800">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        <button onclick="showAdminTab('add')" id="btn-tab-add" class="flex-1 py-2 rounded-lg text-sm font-bold transition-all text-gray-400 hover:bg-gray-800">Ø¥Ø¶Ø§ÙØ© +</button>
      </div>

      <div id="admin-products" class="space-y-3 animate-fade-in"></div>
      
      <div id="admin-orders" class="hidden space-y-3 animate-fade-in"></div>
      
      <div id="admin-add" class="hidden bg-[#1e1e1e] p-6 rounded-xl border border-gray-700 animate-fade-in shadow-xl">
        <h3 class="font-bold mb-6 text-brand-light text-lg border-b border-gray-800 pb-2">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h3>
        <div class="space-y-5">
          
          <div>
            <label class="block text-sm text-white font-bold mb-2">ØµÙˆØ± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø­ØªÙ‰ 4 ØµÙˆØ±)</label>
            <div class="border-2 border-dashed border-gray-600 rounded-xl p-6 text-center cursor-pointer hover:border-brand transition-colors relative bg-black/20 group">
                <input type="file" id="product-files" multiple accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" onchange="previewFiles()">
                
                <div id="upload-placeholder" class="group-hover:scale-105 transition-transform">
                    <div class="text-4xl mb-2">ğŸ“·</div>
                    <span class="text-sm text-gray-400 font-bold">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø£Ùˆ Ø§Ù„Ø§Ø³ØªÙˆØ¯ÙŠÙˆ</span>
                    <p class="text-xs text-gray-500 mt-1">JGP, PNG</p>
                </div>
                
                <div id="preview-container" class="hidden grid grid-cols-4 gap-2 mt-0 relative z-20"></div>
            </div>
          </div>

          <div>
             <label class="block text-xs text-gray-400 mb-1">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</label>
             <input id="new-product-name" placeholder="Ù…Ø«Ø§Ù„: Ø­Ø°Ø§Ø¡ ÙƒÙ„Ø§Ø³ÙŠÙƒ Ø£Ø³ÙˆØ¯" class="w-full p-3 input-field rounded-xl outline-none">
          </div>
          
          <div class="flex gap-4">
            <div class="flex-1">
                <label class="block text-xs text-gray-400 mb-1">Ø§Ù„Ø³Ø¹Ø± (Ø¬.Ù…)</label>
                <input id="new-product-price" type="number" placeholder="00" class="w-full p-3 input-field rounded-xl outline-none font-bold text-brand">
            </div>
            <div class="flex-1">
                <label class="block text-xs text-gray-400 mb-1">Ø§Ù„Ù‚Ø³Ù…</label>
                <select id="new-product-category" class="w-full p-3 input-field rounded-xl outline-none appearance-none">
                  <option value="Ø±Ø¬Ø§Ù„ÙŠ">Ø±Ø¬Ø§Ù„ÙŠ</option>
                  <option value="Ø­Ø±ÙŠÙ…ÙŠ">Ø­Ø±ÙŠÙ…ÙŠ</option>
                  <option value="Ø£Ø·ÙØ§Ù„ÙŠ">Ø£Ø·ÙØ§Ù„ÙŠ</option>
                </select>
            </div>
          </div>
          
          <div>
            <label class="block text-xs text-gray-400 mb-2">Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø© (Ø§Ø¶ØºØ· Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±):</label>
            <div id="size-selector" class="flex flex-wrap gap-2 p-3 bg-black/20 rounded-xl border border-gray-700"></div>
          </div>
          
          <button onclick="addNewProduct()" id="save-btn" class="w-full btn-primary py-4 rounded-xl font-bold mt-4 text-lg shadow-lg hover:shadow-brand/40">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ âœ…</button>
        </div>
      </div>
    </div>
   </div>

   <div id="success-toast" class="fixed top-6 left-1/2 transform -translate-x-1/2 bg-brand px-6 py-3 rounded-full shadow-2xl translate-y-[-200%] transition-transform z-[80] flex items-center gap-3 border border-brand-light min-w-[200px] justify-center">
    <span class="text-xl">âœ…</span><span id="toast-message" class="font-bold text-white">ØªÙ… Ø¨Ù†Ø¬Ø§Ø­</span>
   </div>
   
   <div id="confirm-delete-modal" class="fixed inset-0 z-[70] hidden modal-overlay flex items-center justify-center p-4">
    <div class="bg-[#1e1e1e] border border-gray-700 rounded-xl p-6 text-center max-w-xs w-full shadow-2xl">
     <div class="text-4xl mb-3">âš ï¸</div>
     <h3 class="font-bold mb-4 text-white">Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ±ØŸ</h3>
     <div class="flex gap-2">
       <button onclick="confirmDelete()" class="flex-1 bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg text-sm font-bold transition-colors">Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù</button>
       <button onclick="cancelDelete()" class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-2 rounded-lg text-sm font-bold transition-colors">ØªØ±Ø§Ø¬Ø¹</button>
     </div>
    </div>
   </div>

  </div>

  <script>
    const defaultConfig = { store_name: 'Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®', whatsapp_number: '01000000000' };
    let products = [], orders = [], currentCategory = '', selectedSizes = [], deleteCallback = null, uploadedImages = [];

    // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const dataHandler = {
      onDataChanged(data) {
        products = data.filter(i => i.type === 'product');
        orders = data.filter(i => i.is_order === true);
        if (currentCategory) renderProducts(currentCategory);
        renderAdminProducts(); renderAdminOrders();
      }
    };

    async function initApp() {
      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ SDK Ø§Ù„ÙˆÙ‡Ù…ÙŠ Ù„Ù„ØªØ®Ø²ÙŠÙ† (Ø¥Ù† ÙˆØ¬Ø¯)
      if (window.dataSdk) await window.dataSdk.init(dataHandler);
      updateSizeSelector();
    }

    // --- Ù…Ù†Ø·Ù‚ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± ÙˆØ¶ØºØ·Ù‡Ø§ ---
    function previewFiles() {
        const input = document.getElementById('product-files');
        const container = document.getElementById('preview-container');
        const placeholder = document.getElementById('upload-placeholder');
        
        container.innerHTML = '';
        uploadedImages = [];
        
        if (input.files && input.files.length > 0) {
            placeholder.classList.add('hidden');
            container.classList.remove('hidden');
            
            // Ù†Ø£Ø®Ø° Ø£ÙˆÙ„ 4 ØµÙˆØ± ÙÙ‚Ø·
            const files = Array.from(input.files).slice(0, 4);
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    // Ø¶ØºØ· Ø§Ù„ØµÙˆØ±Ø© Ù„ØªÙ‚Ù„ÙŠÙ„ Ø­Ø¬Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† (Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹)
                    resizeImage(e.target.result, 600, (compressedDataUrl) => {
                        uploadedImages.push(compressedDataUrl);
                        container.innerHTML += `
                          <div class="aspect-square rounded-lg bg-cover bg-center border border-gray-600 shadow-sm relative group" style="background-image: url('${compressedDataUrl}')">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors rounded-lg"></div>
                          </div>
                        `;
                    });
                };
                reader.readAsDataURL(file);
            });
        } else {
            placeholder.classList.remove('hidden');
            container.classList.add('hidden');
        }
    }

    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¶ØºØ· Ø§Ù„ØµÙˆØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Canvas
    function resizeImage(base64Str, maxWidth, callback) {
        const img = new Image();
        img.src = base64Str;
        img.onload = () => {
            const canvas = document.createElement('canvas');
            const scale = maxWidth / img.width;
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙˆØ±Ø© Ø£ØµØºØ± Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ØŒ Ù„Ø§ Ù†ÙƒØ¨Ø±Ù‡Ø§
            const finalScale = scale < 1 ? scale : 1;
            
            canvas.width = img.width * finalScale;
            canvas.height = img.height * finalScale;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ JPEG Ø¨Ø¬ÙˆØ¯Ø© 70%
            callback(canvas.toDataURL('image/jpeg', 0.7)); 
        };
    }

    // --- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ---
    function selectCategory(cat) {
      currentCategory = cat;
      document.getElementById('products-section').classList.remove('hidden');
      document.getElementById('category-title').textContent = cat;
      renderProducts(cat);
      document.getElementById('products-section').scrollIntoView({behavior:'smooth'});
    }
    
    function goHome() {
      document.getElementById('products-section').classList.add('hidden');
      window.scrollTo({top:0, behavior:'smooth'});
    }

    function renderProducts(cat) {
      const grid = document.getElementById('products-grid');
      const items = products.filter(p => p.category === cat);
      grid.innerHTML = items.length ? items.map(p => {
          // Ø¬Ù„Ø¨ Ø£ÙˆÙ„ ØµÙˆØ±Ø© Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©
          let displayImage = '<div class="text-4xl text-gray-600">ğŸ‘Ÿ</div>';
          let imagesArr = [];
          
          if(p.images) {
             try { imagesArr = JSON.parse(p.images); } catch(e){}
             if(imagesArr.length > 0) displayImage = `<img src="${imagesArr[0]}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">`;
          } else if(p.image) { 
              displayImage = `<img src="${p.image}" class="w-full h-full object-cover">`;
          }

          return `
            <div class="product-card rounded-xl overflow-hidden cursor-pointer group" onclick="openProductModal('${p.__backendId}')">
              <div class="h-44 bg-[#1a1a1a] flex items-center justify-center overflow-hidden relative">
                ${displayImage}
                <div class="absolute top-2 left-2 bg-black/60 backdrop-blur-sm text-white text-[10px] px-2 py-1 rounded-md border border-white/10">Ø¬Ø¯ÙŠØ¯</div>
                <div class="absolute bottom-0 right-0 bg-brand text-white text-sm px-3 py-1 rounded-tl-xl font-bold shadow-lg">${p.price} Ø¬.Ù…</div>
              </div>
              <div class="p-3 text-center">
                <h4 class="font-bold text-sm truncate text-gray-200 group-hover:text-brand transition-colors">${p.name}</h4>
              </div>
            </div>
          `;
      }).join('') : '';
      document.getElementById('no-products').classList.toggle('hidden', items.length > 0);
    }

    // --- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ (Modal) ---
    let selProd = null, selSize = null;
    
    function openProductModal(id) {
      selProd = products.find(p => p.__backendId === id);
      if(!selProd) return;
      selSize = null;
      
      document.getElementById('modal-product-name').textContent = selProd.name;
      document.getElementById('modal-product-price').textContent = selProd.price + ' Ø¬Ù†ÙŠÙ‡';
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø¹Ø±Ø¶
      const mainContainer = document.getElementById('main-image-container');
      const thumbsContainer = document.getElementById('thumbnails-container');
      
      let imagesArr = [];
      if(selProd.images) {
          try { imagesArr = JSON.parse(selProd.images); } catch(e){}
      } else if (selProd.image) {
          imagesArr = [selProd.image];
      }

      if(imagesArr.length > 0) {
          // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
          updateMainImage(imagesArr[0]);
          // Ø¹Ø±Ø¶ Ø§Ù„Ù…ØµØºØ±Ø§Øª
          thumbsContainer.innerHTML = imagesArr.map((img, idx) => `
            <div onclick="updateMainImage('${img}', this)" 
                 class="thumbnail w-14 h-14 rounded-lg bg-cover bg-center cursor-pointer bg-gray-800 shadow-md ${idx===0?'active':''}" 
                 style="background-image: url('${img}')">
            </div>
          `).join('');
      } else {
          mainContainer.innerHTML = '<span class="text-6xl">ğŸ‘Ÿ</span>';
          thumbsContainer.innerHTML = '';
      }

      // Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª
      const sizes = selProd.sizes ? selProd.sizes.split(',') : [];
      const allSizes = getSizesForCategory(selProd.category);
      document.getElementById('modal-sizes').innerHTML = allSizes.map(s => {
        const avail = sizes.includes(s.toString());
        return `
            <button onclick="${avail?`selectSize('${s}', this)`:''}" 
                    class="w-10 h-10 rounded-lg font-bold text-sm flex items-center justify-center size-btn shadow-sm ${avail?'available bg-[#2a2a2a] text-white hover:bg-[#333]':'unavailable'}">
                ${s}
            </button>`;
      }).join('');
      
      // ØªÙ†Ø¸ÙŠÙ Ø§Ù„ÙÙˆØ±Ù…
      document.getElementById('customer-name').value = '';
      document.getElementById('customer-phone').value = '';
      document.getElementById('customer-address').value = '';
      
      document.getElementById('product-modal').classList.remove('hidden');
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    window.updateMainImage = function(src, el) {
        document.getElementById('main-image-container').innerHTML = `<img src="${src}" class="max-h-full max-w-full object-contain animate-fade-in shadow-2xl">`;
        if(el) {
            document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        } else {
             // Ù„Ùˆ Ù…ÙÙŠØ´ Ø¹Ù†ØµØ± (Ø£ÙˆÙ„ Ù…Ø±Ø©)ØŒ Ù†Ù†Ø´Ø· Ø§Ù„Ø£ÙˆÙ„ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù„Ùˆ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
        }
    }

    function selectSize(s, btn) {
      selSize = s;
      document.querySelectorAll('#modal-sizes button').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
    }
    
    function closeProductModal() { document.getElementById('product-modal').classList.add('hidden'); }

    async function submitOrder() {
      const name = document.getElementById('customer-name').value.trim();
      const phone = document.getElementById('customer-phone').value.trim();
      const addr = document.getElementById('customer-address').value.trim();
      
      if(!selProd || !selSize) return showToast('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³');
      if(!name || !phone || !addr) return showToast('âš ï¸ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙƒØ§Ù…Ù„Ø©');
      
      if(window.dataSdk) {
        await window.dataSdk.create({
          type: 'order', is_order: true,
          name: selProd.name, price: selProd.price, category: selProd.category,
          selected_size: selSize, customer_name: name, customer_phone: phone, customer_address: addr,
          order_date: new Date().toISOString()
        });
        
        showToast('âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­');
        closeProductModal();
        
        // Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨
        const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ÙŠØ¯ ØªØ£ÙƒÙŠØ¯ Ø·Ù„Ø¨:\n\nğŸ‘Ÿ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: ${selProd.name}\nğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³: ${selSize}\nğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${selProd.price}\n\nğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}\nğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${addr}`;
        window.open(`https://wa.me/${defaultConfig.whatsapp_number}?text=${encodeURIComponent(msg)}`, '_blank');
      }
    }

    // --- Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ---
    function showAdminLogin() { document.getElementById('admin-login-modal').classList.remove('hidden'); }
    function closeAdminLogin() { document.getElementById('admin-login-modal').classList.add('hidden'); }
    
    function checkAdminPassword() {
      if(document.getElementById('admin-password').value === 'admin123') {
        closeAdminLogin(); document.getElementById('admin-page').classList.remove('hidden'); showAdminTab('products');
      } else {
          alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø·Ø£');
      }
    }
    function exitAdmin() { document.getElementById('admin-page').classList.add('hidden'); }
    
    function showAdminTab(tab) {
      // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
      ['products','orders','add'].forEach(t => {
          document.getElementById('admin-'+t).classList.add('hidden');
          const btn = document.getElementById('btn-tab-'+t);
          if(btn) {
             btn.classList.remove('bg-brand', 'text-white');
             btn.classList.add('text-gray-400');
          }
      });
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
      document.getElementById('admin-'+tab).classList.remove('hidden');
      const activeBtn = document.getElementById('btn-tab-'+tab);
      if(activeBtn) {
          activeBtn.classList.remove('text-gray-400');
          activeBtn.classList.add('bg-brand', 'text-white');
      }

      if(tab==='add') {
          updateSizeSelector();
          // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø­Ù‚Ù„ Ø§Ù„Ø±ÙØ¹
          uploadedImages = [];
          document.getElementById('preview-container').innerHTML = '';
          document.getElementById('upload-placeholder').classList.remove('hidden');
          document.getElementById('product-files').value = '';
      }
    }

    function renderAdminProducts() {
      const container = document.getElementById('admin-products');
      if(products.length === 0) {
          container.innerHTML = '<p class="text-center text-gray-500 py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª.. Ø£Ø¶Ù ÙˆØ§Ø­Ø¯ Ø¬Ø¯ÙŠØ¯!</p>';
          return;
      }
      
      container.innerHTML = products.map(p => {
          let thumb = '<div class="text-2xl">ğŸ‘Ÿ</div>';
          if(p.images) {
              try {
                  const imgs = JSON.parse(p.images);
                  if(imgs.length) thumb = `<img src="${imgs[0]}" class="w-full h-full object-cover">`;
              } catch(e){}
          } else if (p.image) {
              thumb = `<img src="${p.image}" class="w-full h-full object-cover">`;
          }
          
          return `
            <div class="bg-[#1e1e1e] p-4 rounded-xl flex justify-between items-center border border-gray-700 shadow-sm">
              <div class="flex items-center gap-4">
                 <div class="w-16 h-16 bg-gray-800 rounded-lg overflow-hidden border border-gray-600">${thumb}</div>
                 <div>
                    <div class="font-bold text-white text-base">${p.name}</div>
                    <div class="text-sm font-bold text-brand">${p.price} Ø¬.Ù…</div>
                    <div class="text-xs text-gray-500 mt-1">${p.category}</div>
                 </div>
              </div>
              <button onclick="confirmDel('product','${p.__backendId}')" class="w-10 h-10 rounded-full bg-red-500/10 text-red-500 hover:bg-red-500 hover:text-white transition-all flex items-center justify-center">ğŸ—‘ï¸</button>
            </div>
          `;
      }).join('');
    }
    
    function renderAdminOrders() {
      const container = document.getElementById('admin-orders');
      if(orders.length === 0) {
          container.innerHTML = '<p class="text-center text-gray-500 py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>';
          return;
      }

      container.innerHTML = orders.map(o => `
        <div class="bg-[#1e1e1e] p-4 rounded-xl border-r-4 border-brand mb-3 shadow-md">
          <div class="flex justify-between items-start mb-2">
            <div>
               <span class="font-bold text-white text-lg">${o.name}</span>
               <span class="bg-brand/20 text-brand px-2 py-0.5 rounded text-xs mr-2 font-bold">Ù…Ù‚Ø§Ø³ ${o.selected_size}</span>
            </div>
            <button onclick="confirmDel('order','${o.__backendId}')" class="text-red-400 hover:text-red-300">ğŸ—‘ï¸</button>
          </div>
          <div class="text-sm text-gray-300 space-y-1 bg-black/20 p-3 rounded-lg">
             <p>ğŸ‘¤ <strong>Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${o.customer_name}</p>
             <p>ğŸ“ <strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${o.customer_phone}</p>
             <p>ğŸ“ <strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${o.customer_address}</p>
             <p class="text-xs text-gray-500 mt-2 text-left" dir="ltr">${new Date(o.order_date).toLocaleDateString('ar-EG')}</p>
          </div>
        </div>
      `).join('');
    }

    function getSizesForCategory(c) { 
        if(c==='Ø±Ø¬Ø§Ù„ÙŠ') return [40,41,42,43,44,45];
        if(c==='Ø­Ø±ÙŠÙ…ÙŠ') return [37,38,39,40,41];
        if(c==='Ø£Ø·ÙØ§Ù„ÙŠ') return Array.from({length:16},(_,i)=>i+20); // Ù…Ù† 20 Ù„Ù€ 35
        return [];
    }

    function updateSizeSelector() {
      const c = document.getElementById('new-product-category').value;
      selectedSizes = [];
      document.getElementById('size-selector').innerHTML = getSizesForCategory(c).map(s => 
        `<button onclick="toggleNewSize(${s},this)" class="w-10 h-10 bg-[#2a2a2a] rounded-lg text-sm text-white font-bold transition-all hover:bg-[#333] border border-transparent">${s}</button>`
      ).join('');
    }

    function toggleNewSize(s, btn) {
      if(selectedSizes.includes(s)) { 
          selectedSizes = selectedSizes.filter(x=>x!==s); 
          btn.classList.remove('bg-brand', 'border-brand-light');
          btn.classList.add('bg-[#2a2a2a]');
      } else { 
          selectedSizes.push(s); 
          btn.classList.remove('bg-[#2a2a2a]');
          btn.classList.add('bg-brand', 'border-brand-light');
      }
    }
    
    async function addNewProduct() {
      const name = document.getElementById('new-product-name').value;
      const price = document.getElementById('new-product-price').value;
      
      // ØªØ­Ù‚Ù‚ ØµØ§Ø±Ù…
      if(!name || !price) return showToast('âš ï¸ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø±');
      if(uploadedImages.length === 0) return showToast('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
      if(selectedSizes.length === 0) return showToast('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª');
      
      const saveBtn = document.getElementById('save-btn');
      saveBtn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...';
      saveBtn.disabled = true;
      
      await window.dataSdk.create({
        type:'product', is_order:false, name, price, 
        category: document.getElementById('new-product-category').value,
        images: JSON.stringify(uploadedImages), // ØªØ®Ø²ÙŠÙ† Ø§Ù„ØµÙˆØ± ÙƒÙ…ØµÙÙˆÙØ©
        sizes: selectedSizes.join(',')
      });
      
      showToast('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­'); 
      showAdminTab('products');
      
      saveBtn.innerText = 'Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ âœ…';
      saveBtn.disabled = false;
    }

    // --- Ø§Ù„Ø­Ø°Ù ---
    function confirmDel(type, id) {
      document.getElementById('confirm-delete-modal').classList.remove('hidden');
      deleteCallback = async () => {
        const item = (type==='product'?products:orders).find(i=>i.__backendId===id);
        if(item) await window.dataSdk.delete(item);
        document.getElementById('confirm-delete-modal').classList.add('hidden');
      };
    }
    function cancelDelete() { document.getElementById('confirm-delete-modal').classList.add('hidden'); }
    function confirmDelete() { if(deleteCallback) deleteCallback(); }
    
    // --- Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ---
    function showToast(m) { 
        const t = document.getElementById('success-toast'); 
        document.getElementById('toast-message').innerText = m; 
        t.style.transform = 'translate(-50%, 50%)'; 
        setTimeout(()=> t.style.transform = 'translate(-50%, -200%)', 2500); 
    }

    document.getElementById('new-product-category').addEventListener('change', updateSizeSelector);
    
    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    initApp();
  </script>
 </body>
</html>
