<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® - Ù„Ù„Ø£Ø­Ø°ÙŠØ©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: { 
        extend: { 
          colors: { brand: { light: '#F3F4F6', DEFAULT: '#4b5f28', text: '#2d3748', accent: '#708238' } },
          boxShadow: { 'soft': '0 4px 6px -1px rgba(0,0,0,0.05)', 'button': '0 10px 15px -3px rgba(0,0,0,0.05)' }
        } 
      } 
    }
  </script>
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f0f2f5; color: #1a1a1a; background-image: radial-gradient(#e5e7eb 1px, transparent 1px); background-size: 20px 20px; }
    .profile-container { width: 140px; height: 140px; margin: 0 auto; border-radius: 50%; background: white; padding: 5px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); border: 4px solid white; position: relative; overflow: hidden; }
    .profile-img { width: 100%; height: 100%; border-radius: 50%; object-fit: contain; background-color: #fff; }
    .link-btn { display: flex; align-items: center; gap: 1.5rem; width: 100%; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 1rem 1.5rem; border-radius: 1.5rem; margin-bottom: 1rem; border: 1px solid #fff; box-shadow: 0 4px 6px rgba(0,0,0,0.02); transition: 0.3s; cursor: pointer; }
    .link-btn:hover { transform: translateY(-3px); border-color: #4b5f28; }
    .btn-icon-box { width: 50px; height: 50px; background: #f8fafc; border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 1px solid #e2e8f0; flex-shrink: 0; }
    .btn-icon-img { width: 100%; height: 100%; object-fit: cover; }
    .link-btn h3 { font-size: 1.1rem; font-weight: 800; color: #3f4a20; text-transform: uppercase; flex-grow: 1; text-align: right; }
    .modal-overlay { background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
    .verified-badge { display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; background: #4b5f28; color: white; border-radius: 50%; font-size: 12px; margin-right: 5px; }
    .back-logo-wrap { perspective: 600px; }
    .back-logo { transform-style: preserve-3d; transform: perspective(600px) rotateY(0deg) rotateX(0deg); animation: logo-3d-float 3s ease-in-out infinite; transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1), box-shadow 0.4s ease; }
    .back-logo:hover { animation: none; transform: perspective(600px) rotateY(-12deg) rotateX(5deg) translateZ(8px); box-shadow: 0 12px 24px rgba(75, 95, 40, 0.2); }
    @keyframes logo-3d-float { 0%, 100% { transform: perspective(600px) rotateY(0deg) rotateX(0deg) translateZ(0); } 50% { transform: perspective(600px) rotateY(4deg) rotateX(-2deg) translateZ(4px); } }
  </style>
 </head>
 <body class="h-full min-h-screen overflow-auto">

   <div id="home-view" class="max-w-md mx-auto px-6 py-10 min-h-screen flex flex-col items-center">
     <div class="text-center mb-10 w-full relative pt-10">
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-48 h-48 bg-brand-accent/10 rounded-full blur-3xl -z-10"></div>
        <div class="profile-container mb-4">
            <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" class="profile-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2589/2589903.png'">
        </div>
        <h1 class="text-3xl font-black text-brand mb-1 flex items-center justify-center gap-2">
            <span class="verified-badge">âœ“</span> Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®
        </h1>
        <p class="text-gray-500 font-bold text-sm tracking-widest uppercase">CHIC & ELEGANT SHOES</p>
     </div>

     <div class="w-full space-y-4">
       <button onclick="showCategory('Ø±Ø¬Ø§Ù„ÙŠ')" class="link-btn group">
         <div class="btn-icon-box shadow-sm group-hover:scale-110 transition"><img src="men.jpg" class="btn-icon-img" onerror="this.parentElement.innerHTML='ğŸ‘'"></div>
         <h3>MEN COLLECTION</h3><span class="text-gray-400">â†’</span>
       </button>
       <button onclick="showCategory('Ø­Ø±ÙŠÙ…ÙŠ')" class="link-btn group">
         <div class="btn-icon-box shadow-sm group-hover:scale-110 transition"><img src="women.jpg" class="btn-icon-img" onerror="this.parentElement.innerHTML='ğŸ‘ '"></div>
         <h3>WOMEN COLLECTION</h3><span class="text-gray-400">â†’</span>
       </button>
       <button onclick="showCategory('Ø£Ø·ÙØ§Ù„ÙŠ')" class="link-btn group">
         <div class="btn-icon-box shadow-sm group-hover:scale-110 transition"><img src="kids.jpg" class="btn-icon-img" onerror="this.parentElement.innerHTML='ğŸ‘Ÿ'"></div>
         <h3>KIDS COLLECTION</h3><span class="text-gray-400">â†’</span>
       </button>

       <div class="flex gap-3 mt-6 w-full">
           <a href="https://wa.me/201020468021" target="_blank" class="flex-1 bg-white p-4 rounded-xl flex justify-center shadow-sm text-green-600 hover:shadow-md transition">
               <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
           </a>
           <a href="https://www.facebook.com/share/14VSGdA8ufc/" target="_blank" class="flex-1 bg-white p-4 rounded-xl flex justify-center items-center shadow-sm text-blue-600 hover:shadow-md transition">
               <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
           </a>
           <a href="https://www.instagram.com/elshekh_store?igsh=YWVkM2ExY3owc2Vl" target="_blank" class="flex-1 bg-white p-4 rounded-xl flex justify-center items-center shadow-sm text-pink-600 hover:shadow-md transition">
               <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
           </a>
       </div>
     </div>
   </div>

   <div id="products-view" class="hidden max-w-6xl mx-auto px-4 py-6 min-h-screen">
     <div class="bg-white/90 backdrop-blur-md px-4 py-3 rounded-2xl sticky top-4 z-40 flex justify-between items-center mb-8 shadow-sm border border-gray-100">
       <div class="flex items-center gap-3">
           <div class="back-logo-wrap flex-shrink-0">
             <button onclick="goHome()" class="back-logo w-12 h-12 rounded-full bg-white shadow-md flex items-center justify-center overflow-hidden border-2 border-brand/20 hover:border-brand cursor-pointer" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©">
               <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" alt="Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®" class="w-full h-full object-contain p-1" onerror="this.parentElement.innerHTML='â†'">
             </button>
           </div>
           <h3 id="cat-title" class="text-xl font-bold text-brand-dark"></h3>
       </div>
       <button onclick="openCart()" class="relative w-12 h-12 rounded-full bg-brand/10 flex items-center justify-center text-brand hover:bg-brand hover:text-white transition">
         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
         <span id="cart-badge" class="absolute -top-1 -left-1 w-5 h-5 rounded-full bg-red-500 text-white text-xs font-bold flex items-center justify-center hidden">0</span>
       </button>
     </div>
     
     <div id="loading-msg" class="text-center py-20 text-brand hidden font-bold">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
     <div id="grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
     <div id="empty-msg" class="hidden text-center py-20">
         <div class="text-6xl mb-4 opacity-30 grayscale">ğŸ‘Ÿ</div>
         <p class="text-gray-400 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
     </div>
   </div>

   <div id="modal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
     <div class="bg-white w-full max-w-md rounded-[2rem] overflow-hidden shadow-2xl max-h-[95vh] overflow-y-auto relative flex flex-col">
       <button onclick="closeModal()" class="absolute top-4 left-4 bg-white/90 w-10 h-10 rounded-full z-20 text-gray-800 shadow-lg transition font-bold text-xl flex items-center justify-center hover:bg-red-50 hover:text-red-500">âœ•</button>
       
       <div class="bg-gray-50 h-72 flex items-center justify-center relative shrink-0">
         <img id="main-img" class="max-h-full max-w-full object-contain drop-shadow-xl mix-blend-multiply">
         <div id="thumbs" class="absolute bottom-4 flex gap-2 justify-center w-full px-2"></div>
       </div>

       <div class="p-6">
         <h2 id="m-name" class="text-2xl font-bold text-center mb-1 text-gray-800"></h2>
         <p id="m-price" class="text-3xl font-black text-brand text-center mb-6"></p>
         
         <div id="m-colors-wrap" class="mb-4 text-center hidden">
             <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-widest">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†</p>
             <div id="m-colors" class="flex flex-wrap justify-center gap-2"></div>
         </div>
         <div class="mb-6 text-center">
             <p class="text-xs text-gray-400 mb-2 font-bold uppercase tracking-widest">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³</p>
             <div id="m-sizes" class="flex flex-wrap justify-center gap-2"></div>
         </div>

         <button onclick="addToCart()" id="add-cart-btn" class="w-full py-4 rounded-xl font-bold text-lg shadow-xl text-white bg-gradient-to-r from-brand to-brand-accent hover:shadow-2xl transition transform hover:-translate-y-1 flex items-center justify-center gap-2">
           Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø© ğŸ›’
         </button>
       </div>
     </div>
   </div>

   <div id="cart-modal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
     <div class="bg-white w-full max-w-md rounded-[2rem] overflow-hidden shadow-2xl max-h-[95vh] overflow-y-auto relative flex flex-col">
       <div class="p-6 border-b border-gray-100 flex justify-between items-center">
         <h2 class="text-xl font-bold text-gray-800">ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
         <button onclick="closeCart()" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center font-bold text-gray-600 hover:bg-red-50 hover:text-red-500">âœ•</button>
       </div>
       <div id="cart-items" class="p-4 flex-1 overflow-y-auto max-h-64">
         <p id="cart-empty" class="text-center text-gray-400 py-8">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p>
       </div>
       <div class="p-4 border-t border-gray-100 space-y-3">
         <div class="flex justify-between text-lg font-bold">
           <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
           <span id="cart-total" class="text-brand">0 Ø¬.Ù…</span>
         </div>
         <div class="p-4 bg-gray-50 rounded-xl space-y-3">
           <p class="text-sm font-bold text-gray-600">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</p>
           <input id="c-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠ" class="w-full bg-white border border-gray-200 p-3 rounded-xl text-sm font-bold text-gray-700 outline-none focus:border-brand transition">
           <input id="c-phone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="w-full bg-white border border-gray-200 p-3 rounded-xl text-sm font-bold text-gray-700 outline-none focus:border-brand transition">
           <input id="c-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„" class="w-full bg-white border border-gray-200 p-3 rounded-xl text-sm font-bold text-gray-700 outline-none focus:border-brand transition">
         </div>
         <div class="p-3 bg-green-50 border border-green-200 rounded-xl text-center">
           <p class="text-xs text-gray-600 font-bold mb-1">ğŸ’³ Ø§Ù„Ø¯ÙØ¹ ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´: <span class="text-green-600 font-mono">01020468021</span></p>
         </div>
         <button onclick="confirmOrder()" id="confirm-order-btn" class="w-full py-4 rounded-xl font-bold text-lg shadow-xl text-white bg-gradient-to-r from-brand to-brand-accent hover:shadow-2xl transition">
           ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„ âœ…
         </button>
       </div>
     </div>
   </div>

   <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // âœ… ÙƒÙˆØ¯ Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ (ØªÙ… Ø¯Ù…Ø¬Ù‡)
    const firebaseConfig = {
      apiKey: "AIzaSyASO-AN5XaSGn4SaCZ8VlHr6zsFCIxPCzs",
      authDomain: "ahmed-shoes.firebaseapp.com",
      projectId: "ahmed-shoes",
      storageBucket: "ahmed-shoes.firebasestorage.app",
      messagingSenderId: "172928088473",
      appId: "1:172928088473:web:100f543fd097a8d5c33b08",
      measurementId: "G-S50TX0VMKE"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let products = [];
    window.currentProd = null;
    window.currentSize = null;
    window.currentColor = null;
    window.cart = [];

    function updateCartBadge() {
        const badge = document.getElementById('cart-badge');
        const count = window.cart.reduce((s, i) => s + (i.qty || 1), 0);
        badge.innerText = count;
        badge.classList.toggle('hidden', count === 0);
    }

    window.addToCart = function() {
        if(!window.currentSize) return alert('Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³ Ø£ÙˆÙ„Ø§Ù‹');
        const color = window.currentColor || 'Ø§ÙØªØ±Ø§Ø¶ÙŠ';
        const existing = window.cart.find(i => i.productId === window.currentProd.id && i.color === color && i.size === window.currentSize);
        if(existing) { existing.qty = (existing.qty||1) + 1; }
        else {
            window.cart.push({
                productId: window.currentProd.id,
                productName: window.currentProd.name,
                price: parseInt(window.currentProd.price) || 0,
                color, size: window.currentSize,
                image: (window.currentProd.images||[])[0],
                qty: 1
            });
        }
        updateCartBadge();
        saveCart();
        closeModal();
    }

    window.removeFromCart = function(idx) {
        window.cart.splice(idx, 1);
        renderCart();
        updateCartBadge();
    }

    function renderCart() {
        const el = document.getElementById('cart-items');
        const empty = document.getElementById('cart-empty');
        if(!window.cart.length) {
            el.innerHTML = '';
            empty.classList.remove('hidden');
            document.getElementById('cart-total').innerText = '0 Ø¬.Ù…';
            return;
        }
        empty.classList.add('hidden');
        const total = window.cart.reduce((s, i) => s + (i.price * (i.qty||1)), 0);
        document.getElementById('cart-total').innerText = total + ' Ø¬.Ù…';
        el.innerHTML = window.cart.map((item, idx) => `
            <div class="flex gap-3 p-3 bg-gray-50 rounded-xl mb-2">
                <img src="${item.image}" class="w-14 h-14 rounded-lg object-cover shrink-0">
                <div class="flex-1 min-w-0">
                    <p class="font-bold text-sm text-gray-800 truncate">${item.productName}</p>
                    <p class="text-xs text-gray-500">${item.color} | Ù…Ù‚Ø§Ø³ ${item.size} ${(item.qty||1)>1 ? 'Ã— '+item.qty : ''}</p>
                    <p class="text-brand font-bold text-sm">${item.price * (item.qty||1)} Ø¬.Ù…</p>
                </div>
                <button onclick="removeFromCart(${idx})" class="text-red-500 p-2 hover:bg-red-50 rounded-lg self-start">âœ•</button>
            </div>
        `).join('');
    }

    window.openCart = function() {
        renderCart();
        document.getElementById('cart-modal').classList.remove('hidden');
    }

    window.closeCart = function() {
        document.getElementById('cart-modal').classList.add('hidden');
    }

    window.confirmOrder = async function() {
        const name = document.getElementById('c-name').value?.trim();
        const phone = document.getElementById('c-phone').value?.trim();
        const address = document.getElementById('c-address').value?.trim();
        if(!window.cart.length) return alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©');
        if(!name || !phone || !address) return alert('Ø£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„');
        
        const btn = document.getElementById('confirm-order-btn');
        btn.disabled = true;
        btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
        
        try {
            const items = window.cart.map(i => ({
                productName: i.productName,
                price: i.price,
                color: i.color,
                size: i.size,
                qty: i.qty || 1
            }));
            const total = window.cart.reduce((s, i) => s + (i.price * (i.qty||1)), 0);
            const orderData = {
                items,
                total,
                customerName: name,
                customerPhone: phone,
                customerAddress: address,
                timestamp: Date.now()
            };
            await addDoc(collection(db, "orders"), orderData);
            const msg = `ğŸ›’ *Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®*\n\n` + items.map((it,i) => `${i+1}. ${it.productName}\n   Ø§Ù„Ù„ÙˆÙ†: ${it.color} | Ø§Ù„Ù…Ù‚Ø§Ø³: ${it.size} | Ø§Ù„ÙƒÙ…ÙŠØ©: ${it.qty} | ${it.price*it.qty} Ø¬.Ù…`).join('\n\n') + `\n\nğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬.Ù…\nğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}\nğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${phone}\nğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}`;
            window.open('https://wa.me/201020468021?text=' + encodeURIComponent(msg), '_blank');
            alert('âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ!\n\nØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ - Ø§Ø¶ØºØ· Ø¥Ø±Ø³Ø§Ù„ Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø­Ù„ Ø¨Ø§Ù„Ø·Ù„Ø¨ØŒ ÙˆØ³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.');
            window.cart = [];
            updateCartBadge();
            saveCart();
            closeCart();
        } catch (e) {
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message);
        }
        btn.disabled = false;
        btn.innerText = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„ âœ…';
    }

    window.showCategory = async function(cat) {
        document.getElementById('home-view').classList.add('hidden');
        document.getElementById('products-view').classList.remove('hidden');
        document.getElementById('cat-title').innerText = cat;
        updateCartBadge();
        document.getElementById('loading-msg').classList.remove('hidden');
        document.getElementById('grid').innerHTML = '';

        try {
            const q = query(collection(db, "products"), orderBy("timestamp", "desc"));
            const snapshot = await getDocs(q);
            products = [];
            snapshot.forEach(doc => products.push({id: doc.id, ...doc.data()}));

            document.getElementById('loading-msg').classList.add('hidden');
            const items = products.filter(p => p.category === cat);
            
            if(!items.length) { document.getElementById('empty-msg').classList.remove('hidden'); return; }
            document.getElementById('empty-msg').classList.add('hidden');

            document.getElementById('grid').innerHTML = items.map(p => `
                <div onclick="openModal('${p.id}')" class="bg-white rounded-2xl overflow-hidden cursor-pointer shadow-soft hover:shadow-lg transition border border-gray-100">
                    <div class="h-44 bg-gray-50 relative"><img src="${(p.images||[])[0]}" class="w-full h-full object-cover mix-blend-multiply"></div>
                    <div class="p-4"><h4 class="font-bold text-sm truncate">${p.name}</h4><span class="text-brand font-black text-sm">${p.price} Ø¬.Ù…</span></div>
                </div>
            `).join('');
        } catch (error) {
            document.getElementById('loading-msg').innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.";
            console.error("Error loading products:", error);
        }
    }

    window.goHome = function() { document.getElementById('products-view').classList.add('hidden'); document.getElementById('home-view').classList.remove('hidden'); }

    window.openModal = function(id) {
        window.currentProd = products.find(p => p.id === id);
        window.currentSize = null;
        window.currentColor = null;
        document.getElementById('modal').classList.remove('hidden');
        document.getElementById('m-name').innerText = window.currentProd.name;
        document.getElementById('m-price').innerText = window.currentProd.price + ' Ø¬.Ù…';
        document.getElementById('main-img').src = (window.currentProd.images||[])[0];
        document.getElementById('thumbs').innerHTML = (window.currentProd.images||[]).map(src => `<div onclick="document.getElementById('main-img').src='${src}'" class="w-12 h-12 rounded-lg border cursor-pointer overflow-hidden"><img src="${src}" class="w-full h-full object-cover"></div>`).join('');
        const colors = window.currentProd.colors;
        if(colors && colors.length > 1) {
            document.getElementById('m-colors-wrap').classList.remove('hidden');
            document.getElementById('m-colors').innerHTML = colors.map(c => `<button onclick="selectColor('${c.name}', this)" class="px-4 py-2 rounded-lg text-sm font-bold border-2 border-gray-200 hover:border-brand transition">${c.name}</button>`).join('');
            document.getElementById('m-sizes').innerHTML = '<p class="text-gray-400 text-sm">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ† Ø£ÙˆÙ„Ø§Ù‹</p>';
        } else if(colors && colors.length === 1) {
            document.getElementById('m-colors-wrap').classList.add('hidden');
            window.currentColor = colors[0].name;
            renderSizesForColor(colors[0].sizes);
        } else {
            document.getElementById('m-colors-wrap').classList.add('hidden');
            renderSizesForColor(window.currentProd.sizes || []);
        }
    }
    function renderSizesForColor(sizes) {
        document.getElementById('m-sizes').innerHTML = sizes.map(s => `<button onclick="selectSize(${s}, this)" class="w-8 h-8 rounded-lg bg-gray-100 text-xs font-bold text-gray-600 hover:bg-brand hover:text-white transition">${s}</button>`).join('');
    }
    window.selectColor = function(colorName, btn) {
        window.currentColor = colorName;
        window.currentSize = null;
        document.querySelectorAll('#m-colors button').forEach(b => b.classList.remove('bg-brand', 'text-white', 'border-brand'));
        btn.classList.add('bg-brand', 'text-white', 'border-brand');
        const color = window.currentProd.colors.find(c => c.name === colorName);
        renderSizesForColor(color ? color.sizes : []);
    }
    window.selectSize = function(s, btn) {
        window.currentSize = s;
        document.querySelectorAll('#m-sizes button').forEach(b => b.classList.remove('bg-brand', 'text-white'));
        btn.classList.add('bg-brand', 'text-white');
    }

    window.closeModal = function() { document.getElementById('modal').classList.add('hidden'); }
   </script>
 </body>
</html>
