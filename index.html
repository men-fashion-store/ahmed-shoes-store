<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#4b5f28">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png">
  <link rel="manifest" href="manifest.json">
  <title>Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® - Ù„Ù„Ø£Ø­Ø°ÙŠØ©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      theme: { 
        extend: { 
          colors: { brand: { light: '#F3F4F6', DEFAULT: '#4b5f28', text: '#2d3748', accent: '#708238' } },
          boxShadow: { 'soft': '0 4px 6px -1px rgba(0,0,0,0.05)', 'button': '0 10px 15px -3px rgba(0,0,0,0.05)' }
        } 
      } 
    }
  </script>
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f0f2f5; color: #1a1a1a; background-image: radial-gradient(#e5e7eb 1px, transparent 1px); background-size: 20px 20px; }
    /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¹Ù†Ø§ØµØ± ÙˆØ§Ù„Ø²Ø¬Ø§Ø¬ */
    .glass-effect { background: rgba(255,255,255,0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.3); }
    .profile-container { width: 140px; height: 140px; margin: 0 auto; border-radius: 50%; background: white; padding: 5px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); position: relative; overflow: hidden; }
    .profile-img { width: 100%; height: 100%; border-radius: 50%; object-fit: contain; background-color: #fff; }
    .link-btn { display: flex; align-items: center; gap: 1.5rem; width: 100%; background: rgba(255,255,255,0.4); backdrop-filter: blur(12px); padding: 1rem 1.5rem; border-radius: 1.5rem; margin-bottom: 1rem; border: 2px solid rgba(112,130,56,0.5); transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1); cursor: pointer; }
    .link-btn:hover { transform: translateY(-5px); border-color: #708238; background: rgba(255,255,255,0.6); }
    .btn-icon-box { width: 50px; height: 50px; background: rgba(255,255,255,0.5); border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 2px solid rgba(112,130,56,0.5); flex-shrink: 0; }
    .btn-icon-img { width: 100%; height: 100%; object-fit: cover; }
    .link-btn h3 { font-size: 1.1rem; font-weight: 800; color: #3f4a20; text-transform: uppercase; flex-grow: 1; text-align: right; }
    .modal-overlay { background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
    .verified-badge { display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; background: #4b5f28; color: white; border-radius: 50%; font-size: 12px; margin-right: 5px; }
    .glass-btn { background: rgba(255,255,255,0.4); backdrop-filter: blur(12px); border: 2px solid rgba(112,130,56,0.5); transition: all 0.3s ease; }
    .glass-btn:hover { transform: scale(1.05); background: rgba(255,255,255,0.6); }
    
    /* Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
    body.dark { background-color: #1a1a1a; color: #e5e7eb; }
    body.dark .glass-effect, body.dark .link-btn, body.dark .glass-btn { background: rgba(30,30,30,0.6); border-color: #4b5f28; }
    
    .toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); padding: 12px 24px; border-radius: 50px; font-weight: bold; z-index: 9999; animation: toastIn 0.3s ease; box-shadow: 0 5px 15px rgba(0,0,0,0.2); font-size: 0.9rem; white-space: nowrap; }
    .toast.success { background: #4b5f28; color: white; }
    .toast.error { background: #dc2626; color: white; }
    @keyframes toastIn { from { opacity: 0; transform: translateX(-50%) translateY(20px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ø²Ø± Ø§Ù„Ø¹Ø§Ø¦Ù… */
    #cart-modal { align-items: flex-end; z-index: 9999 !important; }
    #cart-modal .modal-content { width: 100%; border-radius: 2rem 2rem 0 0; max-height: 90vh; display: flex; flex-direction: column; animation: slideUp 0.3s ease-out; }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    
    .floating-cart-btn { position: fixed; bottom: 25px; left: 25px; z-index: 9990; display: flex !important; animation: floatBtn 3s ease-in-out infinite; }
    @keyframes floatBtn { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

    /* ØªÙ†Ø³ÙŠÙ‚ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    .auth-input { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #ddd; margin-bottom: 10px; background: #f9f9f9; outline: none; transition: 0.3s; }
    .auth-input:focus { border-color: #4b5f28; background: #fff; }
    .user-avatar { width: 40px; height: 40px; border-radius: 50%; background: #4b5f28; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem; }
  </style>
 </head>
 <body class="h-full min-h-screen overflow-auto transition-colors duration-300">
   <div id="toast-container"></div>

   <button onclick="openCart()" class="floating-cart-btn w-16 h-16 bg-[#4b5f28] text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition duration-300 border-4 border-white/50 backdrop-blur-sm group">
     <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>
     <span id="cart-badge" class="absolute -top-1 -right-1 w-6 h-6 bg-red-600 rounded-full text-white text-xs font-bold flex items-center justify-center border-2 border-white shadow-sm hidden">0</span>
   </button>

   <div class="fixed top-0 left-0 w-full z-40 px-4 py-3 flex justify-between items-center pointer-events-none">
       <button onclick="toggleDark()" class="pointer-events-auto w-10 h-10 rounded-full bg-white/80 backdrop-blur shadow-sm flex items-center justify-center text-gray-600" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ">ğŸŒ™</button>
       
       <div id="user-status" class="pointer-events-auto">
           <button onclick="openAuthModal()" class="px-4 py-2 bg-white/90 backdrop-blur shadow-sm rounded-full text-[#4b5f28] font-bold text-sm">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ ğŸ‘¤</button>
       </div>
   </div>

   <div id="home-view" class="relative max-w-md mx-auto px-6 py-10 min-h-screen flex flex-col items-center pt-20">
     <div class="text-center mb-10 w-full relative">
        <div class="profile-container mb-4">
            <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" class="profile-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2589/2589903.png'">
        </div>
        <h1 class="text-3xl font-black text-brand mb-1 flex items-center justify-center gap-2">
            <span class="verified-badge">âœ“</span> Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®
        </h1>
        <p class="text-gray-500 font-bold text-sm tracking-widest uppercase">CHIC & ELEGANT SHOES</p>
     </div>

     <div class="w-full space-y-4">
       <button onclick="showCategory('Ø±Ø¬Ø§Ù„ÙŠ')" class="link-btn group" data-cat="Ø±Ø¬Ø§Ù„ÙŠ">
         <div class="btn-icon-box shadow-sm group-hover:scale-110 transition"><img src="men.jpg" class="btn-icon-img" onerror="this.parentElement.innerHTML='ğŸ‘'"></div>
         <h3>MEN COLLECTION</h3><span class="text-gray-400">â†’</span>
       </button>
       <button onclick="showCategory('Ø­Ø±ÙŠÙ…ÙŠ')" class="link-btn group" data-cat="Ø­Ø±ÙŠÙ…ÙŠ">
         <div class="btn-icon-box shadow-sm group-hover:scale-110 transition"><img src="women.jpg" class="btn-icon-img" onerror="this.parentElement.innerHTML='ğŸ‘ '"></div>
         <h3>WOMEN COLLECTION</h3><span class="text-gray-400">â†’</span>
       </button>
       <button onclick="showCategory('Ø£Ø·ÙØ§Ù„ÙŠ')" class="link-btn group" data-cat="Ø£Ø·ÙØ§Ù„ÙŠ">
         <div class="btn-icon-box shadow-sm group-hover:scale-110 transition"><img src="kids.jpg" class="btn-icon-img" onerror="this.parentElement.innerHTML='ğŸ‘Ÿ'"></div>
         <h3>KIDS COLLECTION</h3><span class="text-gray-400">â†’</span>
       </button>

       <div class="flex gap-3 mt-6 w-full">
           <a href="https://wa.me/201020468021" target="_blank" class="flex-1 glass-btn p-4 rounded-xl flex justify-center text-green-600">
               <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.008-.57-.008-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
           </a>
           <a href="https://www.facebook.com/share/14VSGdA8ufc/" target="_blank" class="flex-1 glass-btn p-4 rounded-xl flex justify-center text-blue-600">
               <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
           </a>
       </div>
     </div>
   </div>

   <div id="products-view" class="hidden max-w-6xl mx-auto px-4 py-6 min-h-screen pt-20">
     <div class="bg-white/80 backdrop-blur-xl px-4 py-3 rounded-2xl sticky top-20 z-30 flex justify-between items-center mb-4 shadow-sm border border-gray-200">
       <div class="flex items-center gap-3">
           <div class="back-logo-wrap flex-shrink-0">
             <button onclick="goHome()" class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center font-bold text-gray-600">â†</button>
           </div>
           <h3 id="cat-title" class="text-xl font-bold text-brand-dark"></h3>
       </div>
     </div>
     <div class="mb-4">
       <input type="text" id="search-input" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¯ÙŠÙ„..." class="w-full p-3 rounded-xl border border-gray-200 focus:border-brand outline-none transition">
     </div>
     <div id="loading-msg" class="text-center py-20 text-brand hidden font-bold">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
     <div id="grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
   </div>

   <div id="modal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
     <div class="bg-white w-full max-w-md rounded-[2rem] overflow-hidden shadow-2xl max-h-[95vh] overflow-y-auto relative flex flex-col">
       <button onclick="closeModal()" class="absolute top-4 left-4 bg-white/90 w-10 h-10 rounded-full z-20 text-gray-800 shadow-lg font-bold">âœ•</button>
       <div class="bg-gray-50 h-72 flex items-center justify-center relative shrink-0">
         <img id="main-img" class="max-h-full max-w-full object-contain mix-blend-multiply">
       </div>
       <div class="p-6">
         <h2 id="m-name" class="text-2xl font-bold text-center mb-1 text-gray-800"></h2>
         <p id="m-price" class="text-3xl font-black text-brand text-center mb-6"></p>
         <div id="m-colors-wrap" class="mb-4 text-center hidden">
             <p class="text-xs text-gray-400 mb-2 font-bold uppercase">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†</p>
             <div id="m-colors" class="flex flex-wrap justify-center gap-2"></div>
         </div>
         <div class="mb-6 text-center">
             <p class="text-xs text-gray-400 mb-2 font-bold uppercase">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³</p>
             <div id="m-sizes" class="flex flex-wrap justify-center gap-2"></div>
         </div>
         <button onclick="addToCart()" class="w-full py-4 rounded-xl font-bold text-lg text-white bg-brand hover:opacity-90">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
       </div>
     </div>
   </div>

   <div id="auth-modal" class="hidden fixed inset-0 z-[60] modal-overlay flex items-center justify-center p-4">
       <div class="bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl relative">
           <button onclick="closeAuthModal()" class="absolute top-4 left-4 text-gray-400 hover:text-red-500">âœ•</button>
           
           <div id="login-form">
               <h2 class="text-2xl font-bold text-center mb-6 text-[#4b5f28]">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ! ğŸ‘‹</h2>
               <input id="login-email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="auth-input">
               <input id="login-pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="auth-input">
               <button onclick="loginUser()" id="login-btn" class="w-full py-3 rounded-xl bg-[#4b5f28] text-white font-bold mb-3 hover:bg-[#3a4a1f]">Ø¯Ø®ÙˆÙ„</button>
               <p class="text-center text-sm text-gray-500">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <span onclick="toggleAuthMode()" class="text-[#4b5f28] font-bold cursor-pointer hover:underline">Ø§Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</span></p>
           </div>

           <div id="signup-form" class="hidden">
               <h2 class="text-2xl font-bold text-center mb-4 text-[#4b5f28]">Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯ ğŸš€</h2>
               <p class="text-xs text-center text-gray-400 mb-4">Ø³Ø¬Ù„ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙˆØ³ÙŠØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¯Ø§Ø¦Ù…Ø§Ù‹</p>
               <input id="reg-name" type="text" placeholder="Ø§Ù„Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠ" class="auth-input">
               <input id="reg-phone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)" maxlength="11" class="auth-input">
               <input id="reg-address" type="text" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„" class="auth-input">
               <input id="reg-email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="auth-input">
               <input id="reg-pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (6 Ø£Ø±Ù‚Ø§Ù…)" class="auth-input">
               <button onclick="registerUser()" id="reg-btn" class="w-full py-3 rounded-xl bg-[#4b5f28] text-white font-bold mb-3 hover:bg-[#3a4a1f]">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
               <p class="text-center text-sm text-gray-500">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ <span onclick="toggleAuthMode()" class="text-[#4b5f28] font-bold cursor-pointer hover:underline">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„</span></p>
           </div>
       </div>
   </div>

   <div id="cart-modal" class="hidden fixed inset-0 z-50 modal-overlay flex p-0">
     <div class="modal-content bg-white overflow-hidden shadow-2xl relative flex flex-col">
       <div class="p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
         <h2 class="text-xl font-bold text-gray-800">ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
         <div class="flex gap-2">
             <button onclick="clearCart()" class="text-red-500 text-xs font-bold border border-red-200 px-2 py-1 rounded hover:bg-red-50">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
             <button onclick="closeCart()" class="w-10 h-10 rounded-full bg-white shadow-sm flex items-center justify-center font-bold text-gray-600 hover:bg-red-50 hover:text-red-500">âœ•</button>
         </div>
       </div>
       
       <div id="cart-items" class="p-4 flex-1 overflow-y-auto bg-white"></div>
       
       <div class="p-4 border-t border-gray-100 bg-white">
         <div class="p-4 bg-gray-50 rounded-xl space-y-3 mb-3">
           <div class="flex justify-between items-center">
                <p class="text-sm font-bold text-gray-600">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙˆØµÙŠÙ„</p>
                <button onclick="openAuthModal()" id="cart-login-hint" class="text-xs text-[#4b5f28] font-bold hover:underline hidden">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</button>
           </div>
           <input id="c-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠ" class="w-full bg-white border border-gray-200 p-3 rounded-xl text-sm font-bold text-gray-700 outline-none focus:border-brand transition">
           <input id="c-phone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" maxlength="11" class="w-full bg-white border border-gray-200 p-3 rounded-xl text-sm font-bold text-gray-700 outline-none focus:border-brand transition">
           <input id="c-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„" class="w-full bg-white border border-gray-200 p-3 rounded-xl text-sm font-bold text-gray-700 outline-none focus:border-brand transition">
         </div>
         
         <div class="flex justify-between items-center p-3 mb-3">
             <span class="font-bold text-gray-700">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªØ­Ù‚ Ù„Ù„Ø¯ÙØ¹:</span>
             <span id="cart-total-confirm" class="text-xl font-black text-brand">0 Ø¬.Ù…</span>
         </div>
         
         <button onclick="confirmOrder()" id="confirm-order-btn" class="w-full py-4 rounded-xl font-bold text-lg shadow-xl text-white bg-gradient-to-r from-brand to-brand-accent hover:shadow-2xl transition">
           ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„ âœ…
         </button>
       </div>
     </div>
   </div>

   <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, setDoc, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyASO-AN5XaSGn4SaCZ8VlHr6zsFCIxPCzs",
      authDomain: "ahmed-shoes.firebaseapp.com",
      projectId: "ahmed-shoes",
      storageBucket: "ahmed-shoes.firebasestorage.app",
      messagingSenderId: "172928088473",
      appId: "1:172928088473:web:100f543fd097a8d5c33b08",
      measurementId: "G-S50TX0VMKE"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let products = [];
    let currentUserData = null; // Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³Ø¬Ù„
    window.currentProd = null;
    window.currentSize = null;
    window.currentColor = null;
    
    // ØªØ­Ù…ÙŠÙ„ ÙˆØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø³Ù„Ø©
    try { 
        let raw = JSON.parse(localStorage.getItem('cart') || '[]');
        if (!Array.isArray(raw)) {
            window.cart = [];
        } else {
            window.cart = raw.filter(i => i && i.productName).map(i => ({
                ...i,
                qty: parseInt(i.qty) || 1,
                price: parseInt(i.price) || 0
            }));
        }
    } catch(e) { window.cart = []; }

    // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© (Auth System) ---
    
    // Ù…Ø±Ø§Ù‚Ø¨ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù‡Ù„ Ù‡Ùˆ Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£Ù… Ù„Ø§ØŸ)
    onAuthStateChanged(auth, async (user) => {
        const statusDiv = document.getElementById('user-status');
        const loginHint = document.getElementById('cart-login-hint');
        
        if (user) {
            // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
            // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            const docRef = doc(db, "users", user.uid);
            const docSnap = await getDoc(docRef);
            
            if (docSnap.exists()) {
                currentUserData = docSnap.data();
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                statusDiv.innerHTML = `
                    <div class="flex items-center gap-2 bg-white/90 backdrop-blur px-3 py-1 rounded-full shadow-sm cursor-pointer" onclick="if(confirm('ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ØŸ')) logOut()">
                        <div class="user-avatar text-xs w-8 h-8">${currentUserData.name.charAt(0)}</div>
                        <span class="text-xs font-bold text-gray-700 hidden md:block">${currentUserData.name.split(' ')[0]}</span>
                    </div>
                `;
                // Ù…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
                fillCheckoutData();
                if(loginHint) loginHint.classList.add('hidden');
            }
        } else {
            // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„
            currentUserData = null;
            statusDiv.innerHTML = `<button onclick="openAuthModal()" class="px-4 py-2 bg-white/90 backdrop-blur shadow-sm rounded-full text-[#4b5f28] font-bold text-xs hover:bg-gray-50 transition">Ø¯Ø®ÙˆÙ„ / Ø­Ø³Ø§Ø¨</button>`;
            if(loginHint) loginHint.classList.remove('hidden');
        }
    });

    window.fillCheckoutData = function() {
        if(currentUserData) {
            document.getElementById('c-name').value = currentUserData.name || '';
            document.getElementById('c-phone').value = currentUserData.phone || '';
            document.getElementById('c-address').value = currentUserData.address || '';
        }
    }

    window.openAuthModal = function() { document.getElementById('auth-modal').classList.remove('hidden'); }
    window.closeAuthModal = function() { document.getElementById('auth-modal').classList.add('hidden'); }
    window.toggleAuthMode = function() {
        document.getElementById('login-form').classList.toggle('hidden');
        document.getElementById('signup-form').classList.toggle('hidden');
    }

    // ØªØ³Ø¬ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
    window.registerUser = async function() {
        const name = document.getElementById('reg-name').value;
        const phone = document.getElementById('reg-phone').value;
        const address = document.getElementById('reg-address').value;
        const email = document.getElementById('reg-email').value;
        const pass = document.getElementById('reg-pass').value;

        if(!name || !phone || !address || !email || !pass) return toast('Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
        if(phone.length !== 11) return toast('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');

        const btn = document.getElementById('reg-btn');
        btn.disabled = true; btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡...';

        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
            const user = userCredential.user;
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© ÙÙŠ Firestore
            await setDoc(doc(db, "users", user.uid), {
                name, phone, address, email,
                createdAt: Date.now()
            });

            toast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰');
            closeAuthModal();
        } catch (error) {
            toast('Ø®Ø·Ø£: ' + error.message, 'error');
        }
        btn.disabled = false; btn.innerText = 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨';
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    window.loginUser = async function() {
        const email = document.getElementById('login-email').value;
        const pass = document.getElementById('login-pass').value;
        
        if(!email || !pass) return toast('Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
        
        const btn = document.getElementById('login-btn');
        btn.disabled = true; btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...';

        try {
            await signInWithEmailAndPassword(auth, email, pass);
            toast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…');
            closeAuthModal();
        } catch (error) {
            toast('Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø© Ø£Ùˆ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨', 'error');
        }
        btn.disabled = false; btn.innerText = 'Ø¯Ø®ÙˆÙ„';
    }

    window.logOut = function() {
        signOut(auth).then(() => {
            toast('ØªÙ… Ø§Ù„Ø®Ø±ÙˆØ¬');
            document.getElementById('c-name').value = '';
            document.getElementById('c-phone').value = '';
            document.getElementById('c-address').value = '';
        });
    }

    // --- Ø¨Ù‚ÙŠØ© Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ù…Ù†ØªØ¬Ø§Øª) ---

    function toast(msg, type='success') {
        const c = document.getElementById('toast-container');
        const t = document.createElement('div');
        t.className = `toast ${type}`;
        t.textContent = msg;
        c.appendChild(t);
        setTimeout(() => { t.remove(); }, 3000);
    }

    function saveCart() { 
        try { localStorage.setItem('cart', JSON.stringify(window.cart)); } catch(e) {} 
    }

    window.toggleDark = function() {
        document.body.classList.toggle('dark');
        const isDark = document.body.classList.contains('dark');
        try { localStorage.setItem('darkMode', isDark); } catch(e){}
    };
    if(localStorage.getItem('darkMode')==='true') { document.body.classList.add('dark'); }

    window.clearCart = function() {
        if(!confirm('ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©ØŸ')) return;
        window.cart = [];
        saveCart();
        renderCart();
        updateCartBadge();
    }

    window.addToCart = function() {
        if(!window.currentSize) return toast('Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³ Ø£ÙˆÙ„Ø§Ù‹', 'error');
        const color = window.currentColor || 'Ø§ÙØªØ±Ø§Ø¶ÙŠ';
        const existingIdx = window.cart.findIndex(i => i.productId === window.currentProd.id && i.color === color && i.size === window.currentSize);
        if(existingIdx > -1) {
            window.cart[existingIdx].qty += 1;
            toast('ØªÙ… Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙƒÙ…ÙŠØ© âœ“');
        } else {
            window.cart.push({
                productId: window.currentProd.id,
                productName: window.currentProd.name,
                price: parseInt(window.currentProd.price) || 0,
                color, size: window.currentSize,
                image: (window.currentProd.images||[])[0],
                qty: 1
            });
            toast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© âœ“');
        }
        updateCartBadge();
        saveCart();
        document.getElementById('modal').classList.add('hidden');
    }

    window.updateCartQty = function(idx, delta) {
        if (!window.cart[idx]) return;
        let newQty = (parseInt(window.cart[idx].qty) || 0) + delta;
        if (newQty < 1) { window.cart.splice(idx, 1); } else { window.cart[idx].qty = newQty; }
        saveCart();
        renderCart(); 
        updateCartBadge();
    }

    window.removeFromCart = function(idx) {
        window.cart.splice(idx, 1);
        saveCart();
        renderCart();
        updateCartBadge();
    }

    function renderCart() {
        const el = document.getElementById('cart-items');
        const empty = document.getElementById('cart-empty'); // ØªØ£ÙƒØ¯ Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ HTML
        
        if (!Array.isArray(window.cart) || !window.cart.length) {
            el.innerHTML = `<div class="text-center py-12"><div class="text-7xl mb-4 opacity-20">ğŸ›’</div><p class="text-gray-500 font-bold">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p></div>`;
            document.getElementById('cart-total-confirm').innerText = '0 Ø¬.Ù…';
            return;
        }
        
        const total = window.cart.reduce((s, i) => s + ( (parseInt(i.price)||0) * (parseInt(i.qty)||1) ), 0);
        document.getElementById('cart-total-confirm').innerText = total + ' Ø¬.Ù…';

        el.innerHTML = window.cart.map((item, idx) => `
            <div class="cart-item-big relative group rounded-xl mb-3 border border-gray-100 shadow-sm flex gap-3 p-2 items-center">
                <img src="${item.image||''}" class="w-24 h-24 rounded-xl object-cover shadow-sm bg-gray-100 shrink-0">
                <div class="flex-1 min-w-0">
                    <p class="font-black text-lg text-gray-800 truncate">${item.productName}</p>
                    <p class="text-sm text-gray-500 font-bold mb-2">${item.color} | Ù…Ù‚Ø§Ø³ <span class="text-brand">${item.size}</span></p>
                    <div class="flex items-center justify-between">
                        <p class="text-brand font-black text-xl">${(parseInt(item.price)||0) * (parseInt(item.qty)||1)} <span class="text-xs text-gray-400">Ø¬.Ù…</span></p>
                        <div class="flex items-center gap-3 bg-gray-50 rounded-full px-2 py-1 border border-gray-200">
                            <button onclick="updateCartQty(${idx}, -1)" class="cart-qty-btn hover:bg-red-100 text-lg font-bold">âˆ’</button>
                            <span class="text-lg font-black w-6 text-center">${item.qty||1}</span>
                            <button onclick="updateCartQty(${idx}, 1)" class="cart-qty-btn bg-brand text-white hover:bg-brand-accent shadow-md text-lg font-bold">+</button>
                        </div>
                    </div>
                </div>
                <button onclick="removeFromCart(${idx})" class="absolute top-2 left-2 text-gray-300 hover:text-red-500 p-1">âœ•</button>
            </div>
        `).join('');
    }

    window.openCart = function() { renderCart(); document.getElementById('cart-modal').classList.remove('hidden'); fillCheckoutData(); }
    window.closeCart = function() { document.getElementById('cart-modal').classList.add('hidden'); }

    window.confirmOrder = async function() {
        const name = document.getElementById('c-name').value?.trim();
        const phone = document.getElementById('c-phone').value?.trim();
        const address = document.getElementById('c-address').value?.trim();

        if(!window.cart.length) return toast('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©', 'error');
        if(!name || !address) return toast('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù†', 'error');
        if (!phone || !/^\d{11}$/.test(phone)) return toast('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 11 Ø±Ù‚Ù…', 'error');
        
        const btn = document.getElementById('confirm-order-btn');
        btn.disabled = true; btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
        
        try {
            // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ùˆ Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
            if(auth.currentUser) {
                await setDoc(doc(db, "users", auth.currentUser.uid), {
                    name, phone, address
                }, { merge: true });
            }

            const items = window.cart.map(i => ({
                productName: i.productName,
                price: parseInt(i.price),
                color: i.color,
                size: i.size,
                qty: parseInt(i.qty)
            }));
            let total = items.reduce((s, i) => s + (i.price * i.qty), 0);
            
            const orderData = {
                items, total, customerName: name, customerPhone: phone, customerAddress: address,
                userId: auth.currentUser ? auth.currentUser.uid : 'guest',
                timestamp: Date.now()
            };
            const docRef = await addDoc(collection(db, "orders"), orderData);
            const orderId = docRef.id.slice(-6).toUpperCase();
            
            const msg = `ğŸ›’ *Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ #${orderId} - Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®*\n\n` + items.map((it,i) => `${i+1}. ${it.productName}\n   Ø§Ù„Ù„ÙˆÙ†: ${it.color} | Ø§Ù„Ù…Ù‚Ø§Ø³: ${it.size} | Ø§Ù„ÙƒÙ…ÙŠØ©: ${it.qty} | ${it.price*it.qty} Ø¬.Ù…`).join('\n\n') + `\n\nğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬.Ù…\nğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}\nğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${phone}\nğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}`;
            window.open('https://wa.me/201020468021?text=' + encodeURIComponent(msg), '_blank');
            
            window.cart = []; updateCartBadge(); saveCart(); closeCart();
            toast('ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ! ØªÙ… ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨');
        } catch (e) {
            toast('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message, 'error');
        }
        btn.disabled = false; btn.innerText = 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ¥Ø±Ø³Ø§Ù„ âœ…';
    }

    function updateCartBadge() {
        const badge = document.getElementById('cart-badge');
        if(!badge) return;
        const count = window.cart.reduce((s, i) => s + (parseInt(i.qty) || 1), 0);
        badge.innerText = count;
        if(count === 0) badge.classList.add('hidden'); else badge.classList.remove('hidden');
    }
    updateCartBadge();

    // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    function renderProductsGrid(items) {
        const grid = document.getElementById('grid');
        grid.innerHTML = items.map(p => `
                <div onclick="openModal('${p.id}')" class="bg-white rounded-2xl overflow-hidden cursor-pointer shadow-soft hover:shadow-lg transition border border-gray-100">
                    <div class="h-44 bg-gray-50 relative"><img src="${(p.images||[])[0]}" class="w-full h-full object-cover mix-blend-multiply"></div>
                    <div class="p-4"><h4 class="font-bold text-sm truncate">${p.name}</h4><span class="text-brand font-black text-sm">${p.price} Ø¬.Ù…</span></div>
                </div>
            `).join('');
    }

    window.showCategory = async function(cat) {
        document.getElementById('home-view').classList.add('hidden');
        document.getElementById('products-view').classList.remove('hidden');
        document.getElementById('cat-title').innerText = cat;
        document.getElementById('loading-msg').classList.remove('hidden');
        document.getElementById('grid').innerHTML = '';

        try {
            const q = query(collection(db, "products"), orderBy("timestamp", "desc"));
            const snapshot = await getDocs(q);
            products = [];
            snapshot.forEach(doc => products.push({id: doc.id, ...doc.data()}));
            document.getElementById('loading-msg').classList.add('hidden');
            const items = products.filter(p => p.category === cat);
            renderProductsGrid(items);
        } catch (error) {
            document.getElementById('loading-msg').innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.";
        }
    }

    document.getElementById('search-input')?.addEventListener('input', function() {
        const q = this.value.trim().toLowerCase();
        const cat = document.getElementById('cat-title').innerText;
        const base = products.filter(p => p.category === cat);
        const filtered = q ? base.filter(p => (p.name||'').toLowerCase().includes(q)) : base;
        renderProductsGrid(filtered);
    });

    window.goHome = function() { document.getElementById('products-view').classList.add('hidden'); document.getElementById('home-view').classList.remove('hidden'); }

    window.openModal = function(id) {
        window.currentProd = products.find(p => p.id === id);
        window.currentSize = null; window.currentColor = null;
        document.getElementById('modal').classList.remove('hidden');
        document.getElementById('m-name').innerText = window.currentProd.name;
        document.getElementById('m-price').innerText = window.currentProd.price + ' Ø¬.Ù…';
        document.getElementById('main-img').src = (window.currentProd.images||[])[0];
        
        const colors = window.currentProd.colors;
        if(colors && colors.length > 1) {
            document.getElementById('m-colors-wrap').classList.remove('hidden');
            document.getElementById('m-colors').innerHTML = colors.map(c => `<button onclick="selectColor('${c.name}', this)" class="px-4 py-2 rounded-lg text-sm font-bold border-2 border-gray-200 hover:border-brand transition">${c.name}</button>`).join('');
            document.getElementById('m-sizes').innerHTML = '<p class="text-gray-400 text-sm">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ† Ø£ÙˆÙ„Ø§Ù‹</p>';
        } else if(colors && colors.length === 1) {
            document.getElementById('m-colors-wrap').classList.add('hidden');
            window.currentColor = colors[0].name;
            renderSizesForColor(colors[0].sizes);
        } else {
            document.getElementById('m-colors-wrap').classList.add('hidden');
            renderSizesForColor(window.currentProd.sizes || []);
        }
    }
    function renderSizesForColor(sizes) {
        document.getElementById('m-sizes').innerHTML = sizes.map(s => `<button onclick="selectSize(${s}, this)" class="w-8 h-8 rounded-lg bg-gray-100 text-xs font-bold text-gray-600 hover:bg-brand hover:text-white transition">${s}</button>`).join('');
    }
    window.selectColor = function(colorName, btn) {
        window.currentColor = colorName; window.currentSize = null;
        document.querySelectorAll('#m-colors button').forEach(b => b.classList.remove('bg-brand', 'text-white', 'border-brand'));
        btn.classList.add('bg-brand', 'text-white', 'border-brand');
        const color = window.currentProd.colors.find(c => c.name === colorName);
        renderSizesForColor(color ? color.sizes : []);
    }
    window.selectSize = function(s, btn) {
        window.currentSize = s;
        document.querySelectorAll('#m-sizes button').forEach(b => b.classList.remove('bg-brand', 'text-white'));
        btn.classList.add('bg-brand', 'text-white');
    }
    window.closeModal = function() { document.getElementById('modal').classList.add('hidden'); }
   </script>
 </body>
</html>
