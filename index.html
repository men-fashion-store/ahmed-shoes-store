<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® - Ù„Ù„Ø£Ø­Ø°ÙŠØ©</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: { extend: { colors: { brand: { light: '#A4B494', DEFAULT: '#708238', dark: '#4B5726', accent: '#EBEFE8' } } } }
    }
  </script>
  
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #121212; color: #ffffff; }
    
    /* Ø§Ù„Ø®Ù„ÙÙŠØ© */
    .brand-bg {
      background-color: #121212;
      background-image: 
        linear-gradient(rgba(18, 18, 18, 0.94), rgba(18, 18, 18, 0.97)),
        url('Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png');
      background-size: cover; background-position: center; background-attachment: fixed; background-repeat: no-repeat;
    }

    /* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø²Ø¬Ø§Ø¬ ÙˆØ§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
    .glass-effect { background: rgba(30, 30, 30, 0.85); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(112, 130, 56, 0.3); }
    .product-card { background: linear-gradient(145deg, #222 0%, #151515 100%); border: 1px solid #333; transition: 0.3s; }
    .product-card:hover { border-color: #708238; transform: translateY(-5px); box-shadow: 0 10px 20px rgba(112, 130, 56, 0.2); }
    
    /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    .btn-primary { background: linear-gradient(135deg, #708238 0%, #4B5726 100%); border: 1px solid #708238; transition: 0.3s; }
    .btn-primary:hover { filter: brightness(1.1); box-shadow: 0 0 15px rgba(112, 130, 56, 0.5); }
    .btn-disabled { background: #444; cursor: not-allowed; opacity: 0.7; }
    
    /* Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
    .input-field { background: #2d2d2d; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px; width: 100%; outline: none; }
    .input-field:focus { border-color: #708238; }
    
    .modal-overlay { background: rgba(0,0,0,0.95); backdrop-filter: blur(5px); }
  </style>
 </head>
 <body class="h-full brand-bg min-h-screen overflow-auto">

   <header class="glass-effect p-3 sticky top-0 z-50">
     <div class="max-w-6xl mx-auto flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 bg-white/5 rounded-lg flex items-center justify-center border border-white/10 overflow-hidden">
            <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" alt="Logo" class="w-full h-full object-contain" onerror="this.style.display='none'; this.parentElement.innerHTML='ğŸ‘'">
        </div>
        <div>
            <h1 class="text-xl font-bold leading-none">Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®</h1>
            <span class="text-xs text-brand-light font-bold">SHOES STORE</span>
        </div>
      </div>
      <button onclick="toggleAdmin()" class="px-3 py-1 rounded bg-white/5 border border-white/10 text-xs hover:bg-white/10 transition">ğŸ” Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
     </div>
   </header>

   <div id="home-view">
     <section class="h-64 flex flex-col items-center justify-center text-center px-4">
       <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" class="h-28 mb-4 opacity-90 drop-shadow-2xl" onerror="this.style.display='none'">
       <h2 class="text-3xl font-bold mb-4">Ø®Ø·ÙˆØ§ØªÙƒ.. Ø¹Ù†ÙˆØ§Ù† Ø£Ù†Ø§Ù‚ØªÙƒ</h2>
       <button onclick="document.getElementById('cats').scrollIntoView({behavior: 'smooth'})" class="btn-primary text-white px-8 py-3 rounded-full font-bold shadow-lg">ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</button>
     </section>

     <section id="cats" class="max-w-6xl mx-auto px-4 py-8 grid grid-cols-3 gap-3">
       <div onclick="showCategory('Ø±Ø¬Ø§Ù„ÙŠ')" class="product-card p-4 rounded-xl text-center cursor-pointer group">
           <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">ğŸ‘</div><h3 class="font-bold">Ø±Ø¬Ø§Ù„ÙŠ</h3>
       </div>
       <div onclick="showCategory('Ø­Ø±ÙŠÙ…ÙŠ')" class="product-card p-4 rounded-xl text-center cursor-pointer group">
           <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">ğŸ‘ </div><h3 class="font-bold">Ø­Ø±ÙŠÙ…ÙŠ</h3>
       </div>
       <div onclick="showCategory('Ø£Ø·ÙØ§Ù„ÙŠ')" class="product-card p-4 rounded-xl text-center cursor-pointer group">
           <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">ğŸ‘Ÿ</div><h3 class="font-bold">Ø£Ø·ÙØ§Ù„ÙŠ</h3>
       </div>
     </section>
   </div>

   <div id="products-view" class="hidden max-w-6xl mx-auto px-4 py-4 min-h-screen">
     <div class="flex justify-between items-center mb-6 bg-[#121212] p-3 rounded-xl sticky top-20 z-40 border border-gray-800 shadow-xl">
       <h3 id="cat-title" class="text-xl font-bold text-brand"></h3>
       <button onclick="goHome()" class="text-sm text-gray-400 hover:text-white transition">âœ• Ø±Ø¬ÙˆØ¹</button>
     </div>
     
     <div id="loading-msg" class="text-center py-20 text-brand hidden">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>
     <div id="grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
     <div id="empty-msg" class="hidden text-center py-20 text-gray-500">
         <div class="text-6xl mb-4 opacity-30">ğŸ“¦</div>
         <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¶Ø§ÙØ© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù…</p>
     </div>
   </div>

   <div id="modal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
     <div class="bg-[#1e1e1e] w-full max-w-md rounded-2xl overflow-hidden shadow-2xl max-h-[95vh] overflow-y-auto relative flex flex-col">
       <button onclick="closeModal()" class="absolute top-3 left-3 bg-black/60 hover:bg-black/80 w-9 h-9 rounded-full z-20 text-white transition">âœ•</button>
       
       <div class="bg-black h-80 flex items-center justify-center relative shrink-0">
         <img id="main-img" class="max-h-full max-w-full object-contain">
         <div id="thumbs" class="absolute bottom-2 flex gap-2 justify-center w-full px-2"></div>
       </div>

       <div class="p-6">
         <h2 id="m-name" class="text-xl font-bold text-center mb-1"></h2>
         <p id="m-price" class="text-3xl font-bold text-brand text-center mb-6"></p>
         
         <div class="mb-6 text-center">
             <p class="text-xs text-gray-400 mb-2 uppercase tracking-widest">Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</p>
             <div id="m-sizes" class="flex flex-wrap justify-center gap-2"></div>
         </div>

         <div class="space-y-3 pt-6 border-t border-gray-700">
           <input id="c-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠ" class="input-field">
           <input id="c-phone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="input-field">
           <input id="c-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø¨Ø§Ù„ØªÙØµÙŠÙ„" class="input-field">
           <button onclick="sendOrder()" class="btn-primary w-full py-4 rounded-xl font-bold mt-2 text-lg shadow-lg">ğŸ›’ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (ÙˆØ§ØªØ³Ø§Ø¨)</button>
         </div>
       </div>
     </div>
   </div>

   <div id="admin-panel" class="hidden fixed inset-0 z-50 bg-[#121212] overflow-y-auto">
     <div class="p-4 max-w-2xl mx-auto">
       <header class="flex justify-between items-center mb-8 border-b border-gray-800 pb-4 sticky top-0 bg-[#121212] z-10 pt-4">
         <h2 class="text-2xl font-bold text-brand flex items-center gap-2"><span class="bg-brand text-white text-xs px-2 py-1 rounded">ADMIN</span> Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</h2>
         <button onclick="toggleAdmin()" class="text-gray-400 hover:text-white transition">Ø®Ø±ÙˆØ¬</button>
       </header>

       <div class="bg-gray-900 p-4 rounded-xl mb-8 border border-gray-800">
           <h3 class="font-bold text-sm text-gray-400 mb-3">ğŸ’¾ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Backup)</h3>
           <div class="flex gap-3">
               <button onclick="exportData()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-bold text-sm transition flex items-center justify-center gap-2">
                   <span>ğŸ“¥</span> ØªØ­Ù…ÙŠÙ„ Ù†Ø³Ø®Ø©
               </button>
               <button onclick="document.getElementById('import-file').click()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-bold text-sm transition flex items-center justify-center gap-2">
                   <span>ğŸ“¤</span> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø©
               </button>
               <input type="file" id="import-file" accept=".json" class="hidden" onchange="importData(this)">
           </div>
       </div>

       <div class="bg-[#1e1e1e] p-5 rounded-xl mb-8 border border-gray-700 shadow-lg">
         <h3 class="font-bold mb-4 text-lg border-b border-gray-800 pb-2">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h3>
         <div class="space-y-4">
           
           <div>
               <label class="block text-xs text-gray-400 mb-2">ØµÙˆØ± Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ (Ø­ØªÙ‰ 4 ØµÙˆØ±)</label>
               <div class="border-2 border-dashed border-gray-600 bg-black/20 p-6 text-center rounded-xl cursor-pointer hover:border-brand transition group relative" onclick="document.getElementById('file-in').click()">
                 <input type="file" id="file-in" multiple accept="image/*" class="hidden" onchange="handleFiles(this)">
                 <div id="upload-placeholder" class="group-hover:scale-105 transition-transform">
                     <span class="text-3xl block mb-2">ğŸ“·</span>
                     <span class="text-sm text-gray-400 font-bold">Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±</span>
                 </div>
                 <div id="preview" class="grid grid-cols-4 gap-2 mt-2 hidden"></div>
               </div>
               <p id="file-msg" class="text-xs text-brand mt-1 hidden"></p>
           </div>

           <input id="new-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ (Ù…Ø«Ø§Ù„: Ø­Ø°Ø§Ø¡ ÙƒÙ„Ø§Ø³ÙŠÙƒ Ø£Ø³ÙˆØ¯)" class="input-field">
           
           <div class="flex gap-3">
             <div class="flex-1">
                 <input id="new-price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="input-field">
             </div>
             <div class="flex-1">
                 <select id="new-cat" class="input-field appearance-none">
                   <option value="Ø±Ø¬Ø§Ù„ÙŠ">Ø±Ø¬Ø§Ù„ÙŠ</option>
                   <option value="Ø­Ø±ÙŠÙ…ÙŠ">Ø­Ø±ÙŠÙ…ÙŠ</option>
                   <option value="Ø£Ø·ÙØ§Ù„ÙŠ">Ø£Ø·ÙØ§Ù„ÙŠ</option>
                 </select>
             </div>
           </div>
           
           <div>
               <label class="block text-xs text-gray-400 mb-2">Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©:</label>
               <div id="size-options" class="flex flex-wrap gap-2 p-3 bg-black/30 rounded-lg border border-gray-800"></div>
           </div>
           
           <button onclick="addProduct()" id="add-btn" class="btn-primary w-full py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-brand/50 transition">Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ âœ…</button>
         </div>
       </div>

       <h3 class="font-bold mb-4 text-xl flex items-center gap-2">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© <span id="count-badge" class="text-sm bg-brand text-white px-2 py-0.5 rounded-full">0</span></h3>
       <div id="admin-list" class="space-y-3 pb-10"></div>
     </div>
   </div>

   <script>
    // === IndexedDB Setup (Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ù‚ÙˆÙŠ Ù„Ù„ØªØ®Ø²ÙŠÙ†) ===
    const dbName = "AhmedShoesStoreDB_V1";
    const storeName = "products";
    let db;

    // ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function openDB() {
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(dbName, 1);
            request.onupgradeneeded = (event) => {
                db = event.target.result;
                if (!db.objectStoreNames.contains(storeName)) {
                    db.createObjectStore(storeName, { keyPath: "id" });
                }
            };
            request.onsuccess = (event) => {
                db = event.target.result;
                resolve(db);
            };
            request.onerror = (event) => reject("DB Error");
        });
    }

    // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function saveProductToDB(product) {
        return new Promise((resolve, reject) => {
            const tx = db.transaction([storeName], "readwrite");
            tx.objectStore(storeName).put(product);
            tx.oncomplete = () => resolve(true);
            tx.onerror = () => reject(false);
        });
    }

    function getAllProducts() {
        return new Promise((resolve) => {
            if(!db) return resolve([]);
            const tx = db.transaction([storeName], "readonly");
            tx.objectStore(storeName).getAll().onsuccess = (e) => resolve(e.target.result || []);
        });
    }

    function deleteProductFromDB(id) {
        return new Promise((resolve) => {
            const tx = db.transaction([storeName], "readwrite");
            tx.objectStore(storeName).delete(id);
            tx.oncomplete = () => resolve(true);
        });
    }

    // === Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ===
    let products = [];
    let currentProd = null, currentSize = null, newImages = [], newSizes = [];
    const whatsapp = "01000000000"; // Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨

    // === Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ ===
    async function init() {
        await openDB();
        products = await getAllProducts();
        updateSizeOpts();
    }
    init();

    // === Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± (Core Logic) ===
    function handleFiles(input) {
      const files = [...input.files].slice(0, 4);
      const preview = document.getElementById('preview');
      const placeholder = document.getElementById('upload-placeholder');
      const msg = document.getElementById('file-msg');
      
      placeholder.classList.add('hidden');
      preview.classList.remove('hidden');
      preview.innerHTML = '<div class="col-span-4 text-center text-brand animate-pulse">Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ± ÙˆØ¶ØºØ·Ù‡Ø§...</div>';
      msg.classList.remove('hidden');
      msg.innerText = "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±...";
      
      newImages = []; 
      let processedCount = 0;

      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.src = e.target.result;
          img.onload = () => {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Ø¶ØºØ· Ø°ÙƒÙŠ (Smart Compression)
            const maxWidth = 800; 
            let width = img.width;
            let height = img.height;
            
            if (width > maxWidth) {
                height *= maxWidth / width;
                width = maxWidth;
            }
            
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);
            
            // ØªØ­ÙˆÙŠÙ„ Ù„Ù€ JPEG Ø¨Ø¬ÙˆØ¯Ø© 70%
            newImages.push(canvas.toDataURL('image/jpeg', 0.7));
            processedCount++;
            
            if(processedCount === files.length) {
                renderPreview();
                msg.innerText = `âœ… ØªÙ… ØªØ¬Ù‡ÙŠØ² ${files.length} ØµÙˆØ± Ø¨Ù†Ø¬Ø§Ø­`;
                msg.classList.replace('text-brand', 'text-green-500');
            }
          }
        };
        reader.readAsDataURL(file);
      });
    }

    function renderPreview() {
        const preview = document.getElementById('preview');
        preview.innerHTML = '';
        newImages.forEach(img => {
            preview.innerHTML += `<div class="aspect-square rounded-lg bg-cover bg-center border border-gray-600 shadow-sm" style="background-image: url('${img}')"></div>`;
        });
    }

    // === ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø¯Ù…Ù† ===
    async function addProduct() {
      const btn = document.getElementById('add-btn');
      const name = document.getElementById('new-name').value;
      const price = document.getElementById('new-price').value;
      
      if(!name || !price) return alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ ÙˆØ§Ù„Ø³Ø¹Ø±');
      if(newImages.length === 0) return alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ± Ù„Ù„Ù…ÙˆØ¯ÙŠÙ„');
      if(newSizes.length === 0) return alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù‚Ø§Ø³ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
      
      btn.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...";
      btn.classList.add('btn-disabled');
      btn.disabled = true;

      const newItem = {
        id: Date.now(),
        name, price,
        category: document.getElementById('new-cat').value,
        images: newImages,
        sizes: newSizes
      };

      await saveProductToDB(newItem);
      products = await getAllProducts(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      
      alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!');
      
      // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      document.getElementById('new-name').value = '';
      document.getElementById('new-price').value = '';
      document.getElementById('upload-placeholder').classList.remove('hidden');
      document.getElementById('preview').classList.add('hidden');
      document.getElementById('file-msg').classList.add('hidden');
      newImages = []; newSizes = []; updateSizeOpts();
      renderAdminList();
      
      btn.innerText = "Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ âœ…";
      btn.classList.remove('btn-disabled');
      btn.disabled = false;
    }

    async function deleteProduct(id) {
      if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) {
        await deleteProductFromDB(id);
        products = await getAllProducts();
        renderAdminList();
      }
    }

    function renderAdminList() {
      const list = document.getElementById('admin-list');
      document.getElementById('count-badge').innerText = products.length;
      
      if(products.length === 0) {
          list.innerHTML = '<p class="text-center text-gray-500 py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¶Ø§ÙØ©.</p>';
          return;
      }

      list.innerHTML = products.map(p => `
        <div class="bg-[#2a2a2a] p-3 rounded-xl flex justify-between items-center border border-gray-700 shadow-sm hover:border-brand transition">
          <div class="flex gap-4 items-center">
            <img src="${p.images[0]}" class="w-14 h-14 rounded-lg object-cover border border-gray-600">
            <div>
                <div class="font-bold text-white text-base">${p.name}</div>
                <div class="text-xs text-brand font-bold">${p.price} Ø¬.Ù…</div>
                <div class="text-xs text-gray-500">${p.category} | ${p.sizes.length} Ù…Ù‚Ø§Ø³</div>
            </div>
          </div>
          <button onclick="deleteProduct(${p.id})" class="text-red-500 hover:text-white hover:bg-red-600 p-2 rounded-lg transition">ğŸ—‘ï¸ Ø­Ø°Ù</button>
        </div>
      `).join('');
    }

    // === Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ (Backup) ===
    async function exportData() {
        if(products.length === 0) return alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§!');
        const dataStr = JSON.stringify(products);
        const blob = new Blob([dataStr], {type: "application/json"});
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `backup_ahmed_shoes_${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }

    function importData(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = async (e) => {
            try {
                const imported = JSON.parse(e.target.result);
                if (Array.isArray(imported)) {
                    if(confirm(`âš ï¸ Ø³ÙŠØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${imported.length} Ù…Ù†ØªØ¬. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ`)) {
                        for (const p of imported) await saveProductToDB(p);
                        products = await getAllProducts();
                        renderAdminList();
                        alert('âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!');
                    }
                }
            } catch (err) { alert('âŒ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­'); }
        };
        reader.readAsText(file);
    }

    // === ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ===
    function updateSizeOpts() {
      const cat = document.getElementById('new-cat').value;
      // Ù…Ù‚Ø§Ø³Ø§Øª Ø°ÙƒÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©
      let sizes = cat === 'Ø±Ø¬Ø§Ù„ÙŠ' ? [40,41,42,43,44,45] : (cat === 'Ø­Ø±ÙŠÙ…ÙŠ' ? [37,38,39,40,41] : [25,26,27,28,29,30,31,32,33,34,35]);
      newSizes = [];
      document.getElementById('size-options').innerHTML = sizes.map(s => 
        `<button onclick="toggleNewSize(${s}, this)" class="w-10 h-10 rounded-lg bg-[#2a2a2a] text-sm font-bold transition hover:bg-gray-700">${s}</button>`
      ).join('');
    }

    function toggleNewSize(s, btn) {
      if(newSizes.includes(s)) {
        newSizes = newSizes.filter(x => x !== s);
        btn.classList.remove('bg-brand', 'text-white');
      } else {
        newSizes.push(s);
        btn.classList.add('bg-brand', 'text-white');
      }
    }

    document.getElementById('new-cat').addEventListener('change', updateSizeOpts);

    async function showCategory(cat) {
      document.getElementById('home-view').classList.add('hidden');
      const pView = document.getElementById('products-view');
      pView.classList.remove('hidden');
      document.getElementById('cat-title').innerText = cat;
      document.getElementById('loading-msg').classList.remove('hidden');
      document.getElementById('grid').innerHTML = '';

      // Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ Ø£Ø­Ø¯Ø« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      products = await getAllProducts();
      
      const items = products.filter(p => p.category === cat);
      document.getElementById('loading-msg').classList.add('hidden');
      
      if(items.length === 0) {
        document.getElementById('empty-msg').classList.remove('hidden');
        return;
      }
      
      document.getElementById('empty-msg').classList.add('hidden');
      document.getElementById('grid').innerHTML = items.map(p => `
        <div onclick="openModal(${p.id})" class="product-card rounded-xl overflow-hidden cursor-pointer group">
          <div class="h-48 bg-[#1a1a1a] relative overflow-hidden">
            <img src="${p.images[0]}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
            <div class="absolute bottom-0 right-0 bg-brand text-white px-3 py-1 text-sm font-bold rounded-tl-xl shadow-lg">${p.price}</div>
          </div>
          <div class="p-3 text-center">
             <h4 class="font-bold text-sm text-gray-200 truncate">${p.name}</h4>
          </div>
        </div>
      `).join('');
    }

    function goHome() {
      document.getElementById('products-view').classList.add('hidden');
      document.getElementById('home-view').classList.remove('hidden');
    }

    async function toggleAdmin() {
      const p = document.getElementById('admin-panel');
      if(p.classList.contains('hidden')) {
        const pass = prompt('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:');
        if(pass === 'admin123') {
           p.classList.remove('hidden');
           products = await getAllProducts();
           renderAdminList();
        } else alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
      } else p.classList.add('hidden');
    }

    // === Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„ ===
    function openModal(id) {
      currentProd = products.find(p => p.id === id);
      const modal = document.getElementById('modal');
      modal.classList.remove('hidden');
      
      document.getElementById('m-name').innerText = currentProd.name;
      document.getElementById('m-price').innerText = currentProd.price + ' Ø¬Ù†ÙŠÙ‡';
      
      // Ø§Ù„ØµÙˆØ±
      const main = document.getElementById('main-img');
      main.src = currentProd.images[0];
      
      const thumbs = document.getElementById('thumbs');
      thumbs.innerHTML = currentProd.images.map(src => `
        <div onclick="document.getElementById('main-img').src='${src}'" 
             class="w-14 h-14 rounded-lg border border-gray-600 cursor-pointer overflow-hidden bg-black hover:border-brand transition">
             <img src="${src}" class="w-full h-full object-cover opacity-80 hover:opacity-100">
        </div>
      `).join('');

      // Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª
      currentSize = null;
      document.getElementById('m-sizes').innerHTML = currentProd.sizes.map(s => `
        <button onclick="selectSize(${s}, this)" class="w-10 h-10 rounded-lg bg-[#2a2a2a] text-sm font-bold text-white transition hover:bg-gray-700 border border-transparent">${s}</button>
      `).join('');
    }

    function selectSize(s, btn) {
      currentSize = s;
      document.querySelectorAll('#m-sizes button').forEach(b => b.classList.remove('bg-brand', 'scale-110'));
      btn.classList.add('bg-brand', 'scale-110');
    }

    function closeModal() { document.getElementById('modal').classList.add('hidden'); }

    function sendOrder() {
      const name = document.getElementById('c-name').value;
      const addr = document.getElementById('c-address').value;
      const phone = document.getElementById('c-phone').value;
      
      if(!currentSize) return alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù‚Ø§Ø³ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨');
      if(!name || !addr || !phone) return alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù† ÙƒØ§Ù…Ù„Ø©');
      
      const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ÙŠØ¯ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯: \n\nğŸ‘Ÿ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: ${currentProd.name}\nğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³: ${currentSize}\nğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${currentProd.price}\n\nğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${name}\nğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${phone}\nğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${addr}`;
      window.open(`https://wa.me/${whatsapp}?text=${encodeURIComponent(msg)}`, '_blank');
      closeModal();
    }
   </script>
 </body>
</html>
