<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® - Ù„Ù„Ø£Ø­Ø°ÙŠØ©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  <script>tailwind.config = { theme: { extend: { colors: { brand: '#4b5f28' }, animation: { 'float': 'float 3s ease-in-out infinite' }, keyframes: { float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-5px)' } } } } } }</script>
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f8f9fa; -webkit-tap-highlight-color: transparent; }
    .scroll-hide::-webkit-scrollbar { display: none; }
    .heart-btn.active svg { fill: #ef4444; stroke: #ef4444; }
    .st-new { background: #fef3c7; color: #92400e; } .st-processing { background: #dbeafe; color: #1e40af; } .st-shipped { background: #f3e8ff; color: #6b21a8; } .st-completed { background: #dcfce7; color: #166534; }
  </style>
 </head>
 <body class="min-h-screen bg-gray-50 pb-24">
   <div id="toast-container" class="fixed top-5 left-1/2 -translate-x-1/2 z-[9999]"></div>

   <button onclick="openCart()" class="fixed bottom-20 left-4 z-40 w-14 h-14 bg-[#4b5f28] text-white rounded-full shadow-xl flex items-center justify-center animate-float border-2 border-white"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg><span id="cart-badge" class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs font-bold flex items-center justify-center border border-white hidden">0</span></button>

   <div class="fixed bottom-0 w-full bg-white border-t flex justify-around py-3 z-30 text-gray-400 text-xs font-bold shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
       <button onclick="switchView('home')" class="flex flex-col items-center gap-1 text-[#4b5f28] nav-btn" id="nav-home"><span class="text-xl">ğŸ </span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
       <button onclick="checkLoginAndAction('wishlist')" class="flex flex-col items-center gap-1 hover:text-[#4b5f28] nav-btn" id="nav-wishlist"><span class="text-xl">â¤ï¸</span>Ø§Ù„Ù…ÙØ¶Ù„Ø©</button>
       <button onclick="checkLoginAndAction('orders')" class="flex flex-col items-center gap-1 hover:text-[#4b5f28] nav-btn" id="nav-orders"><span class="text-xl">ğŸ“¦</span>Ø·Ù„Ø¨Ø§ØªÙŠ</button>
       <button onclick="openProfileEdit()" class="flex flex-col items-center gap-1 hover:text-[#4b5f28] nav-btn" id="nav-profile"><span class="text-xl">ğŸ‘¤</span>Ø­Ø³Ø§Ø¨ÙŠ</button>
   </div>

   <div id="view-home" class="view-section max-w-md mx-auto">
     <div class="bg-white p-4 pb-2 shadow-sm rounded-b-3xl mb-4">
        <div class="flex justify-between items-center mb-4">
            <div><p class="text-xs text-gray-400 font-bold">Ù…Ø±Ø­Ø¨Ø§Ù‹ ğŸ‘‹</p><h1 class="text-xl font-black text-gray-800" id="header-username">Ø²Ø§Ø¦Ø±</h1></div>
            <img id="header-avatar" src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" class="w-10 h-10 rounded-full border shadow-sm object-cover" onerror="this.src='https://cdn-icons-png.flaticon.com/512/3135/3135715.png'">
        </div>
        <div id="banners-slider" class="flex overflow-x-auto gap-3 snap-x scroll-hide pb-2 h-40"><div class="w-full flex-shrink-0 snap-center bg-gray-100 rounded-xl flex items-center justify-center text-gray-400 text-xs">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±ÙˆØ¶...</div></div>
     </div>

     <div class="px-4 space-y-4 mb-6">
       <div onclick="showCategory('Ø±Ø¬Ø§Ù„ÙŠ')" class="relative h-40 rounded-2xl overflow-hidden cursor-pointer shadow-lg group">
           <img src="men.jpg" class="w-full h-full object-cover transition duration-700 group-hover:scale-110" onerror="this.src='https://placehold.co/400x150?text=Men'">
           <div class="absolute inset-0 bg-black/30 flex items-center justify-center"><h3 class="text-white text-3xl font-black border-b-2 border-white/50 pb-1">Ø±Ø¬Ø§Ù„ÙŠ</h3></div>
       </div>
       <div onclick="showCategory('Ø­Ø±ÙŠÙ…ÙŠ')" class="relative h-40 rounded-2xl overflow-hidden cursor-pointer shadow-lg group">
           <img src="women.jpg" class="w-full h-full object-cover transition duration-700 group-hover:scale-110" onerror="this.src='https://placehold.co/400x150?text=Women'">
           <div class="absolute inset-0 bg-black/30 flex items-center justify-center"><h3 class="text-white text-3xl font-black border-b-2 border-white/50 pb-1">Ø­Ø±ÙŠÙ…ÙŠ</h3></div>
       </div>
       <div onclick="showCategory('Ø£Ø·ÙØ§Ù„ÙŠ')" class="relative h-40 rounded-2xl overflow-hidden cursor-pointer shadow-lg group">
           <img src="kids.jpg" class="w-full h-full object-cover transition duration-700 group-hover:scale-110" onerror="this.src='https://placehold.co/400x150?text=Kids'">
           <div class="absolute inset-0 bg-black/30 flex items-center justify-center"><h3 class="text-white text-3xl font-black border-b-2 border-white/50 pb-1">Ø£Ø·ÙØ§Ù„ÙŠ</h3></div>
       </div>
     </div>

     <div class="px-4 mb-2 flex justify-between items-end"><h3 class="font-bold text-gray-800" id="grid-title">Ø£Ø­Ø¯Ø« Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª</h3></div>
     <div id="products-grid" class="grid grid-cols-2 gap-3 px-4 pb-8"></div>
   </div>

   <div id="view-wishlist" class="view-section hidden max-w-md mx-auto pt-4 px-4">
       <h2 class="text-xl font-black text-[#4b5f28] mb-4">â¤ï¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©</h2>
       <div id="wishlist-grid" class="grid grid-cols-2 gap-3"></div>
       <div id="wishlist-empty" class="hidden text-center py-20 text-gray-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙØ¶Ù„Ø©</div>
   </div>

   <div id="view-orders" class="view-section hidden max-w-md mx-auto pt-4 px-4">
       <h2 class="text-xl font-black text-[#4b5f28] mb-4">ğŸ“¦ Ø·Ù„Ø¨Ø§ØªÙŠ</h2>
       <div id="orders-list" class="space-y-3"></div>
   </div>

   <div id="product-modal" class="hidden fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-end sm:items-center justify-center p-0 sm:p-4">
     <div class="bg-white w-full sm:max-w-sm rounded-t-3xl sm:rounded-3xl overflow-hidden max-h-[90vh] flex flex-col" style="animation: slideUp 0.3s">
       <button onclick="document.getElementById('product-modal').classList.add('hidden')" class="absolute top-4 left-4 z-10 w-8 h-8 bg-white/80 rounded-full font-bold shadow-sm">âœ•</button>
       <div class="h-64 bg-gray-100 p-4"><img id="m-img" class="w-full h-full object-contain mix-blend-multiply"></div>
       <div class="p-6 space-y-4 bg-white flex-1 overflow-y-auto">
         <div class="flex justify-between"><h2 id="m-name" class="text-xl font-bold"></h2><div class="text-right"><span id="m-price" class="text-xl font-black text-[#4b5f28]"></span><br><span id="m-old-price" class="text-sm text-gray-400 line-through hidden"></span></div></div>
         <div id="m-colors-wrap"><p class="text-xs text-gray-400 mb-2">Ø§Ù„Ù„ÙˆÙ†</p><div id="m-colors" class="flex flex-wrap gap-2"></div></div>
         <div id="m-sizes-wrap"><p class="text-xs text-gray-400 mb-2">Ø§Ù„Ù…Ù‚Ø§Ø³</p><div id="m-sizes" class="flex flex-wrap gap-2"></div></div>
         <button onclick="addToCart()" class="w-full py-3.5 bg-[#4b5f28] text-white font-bold rounded-xl shadow-lg mt-2">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© ğŸ›’</button>
       </div>
     </div>
   </div>

   <div id="login-modal" class="hidden fixed inset-0 z-[60] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4">
       <div class="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl relative">
           <button onclick="document.getElementById('login-modal').classList.add('hidden')" class="absolute top-3 left-3 text-gray-400 text-xl">âœ•</button>
           <h3 class="text-xl font-bold text-center mb-6">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
           <form onsubmit="handleLogin(event)" class="space-y-4">
               <input type="tel" id="l-phone" class="w-full p-3 border rounded-xl font-bold text-center text-lg focus:border-[#4b5f28]" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
               <div id="new-user-fields" class="hidden space-y-3">
                   <p class="text-xs text-green-600 text-center">Ø£ÙˆÙ„ Ù…Ø±Ø©! ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</p>
                   <input id="l-name" class="w-full p-2 border rounded-lg text-sm" placeholder="Ø§Ù„Ø§Ø³Ù…">
                   <input id="l-address" class="w-full p-2 border rounded-lg text-sm" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
               </div>
               <button type="submit" id="l-btn" class="w-full py-3 bg-[#4b5f28] text-white font-bold rounded-xl">Ù…ØªØ§Ø¨Ø¹Ø©</button>
           </form>
       </div>
   </div>

   <div id="profile-modal" class="hidden fixed inset-0 z-[60] bg-black/60 backdrop-blur-sm flex items-center justify-center p-4">
       <div class="bg-white w-full max-w-sm rounded-2xl p-6 shadow-2xl">
           <h3 class="font-bold text-lg mb-4 text-center">ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ</h3>
           <div class="space-y-3">
               <div class="flex justify-center mb-4"><img id="edit-avatar-preview" src="" class="w-20 h-20 rounded-full border bg-gray-100 object-cover"></div>
               <input type="text" id="edit-avatar-url" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="w-full p-2 border rounded text-xs text-center" onchange="document.getElementById('edit-avatar-preview').src=this.value">
               <input id="edit-name" class="w-full p-3 border rounded-xl text-sm" placeholder="Ø§Ù„Ø§Ø³Ù…">
               <input id="edit-address" class="w-full p-3 border rounded-xl text-sm" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
               <button onclick="saveProfile()" class="w-full py-3 bg-[#4b5f28] text-white font-bold rounded-xl">Ø­ÙØ¸</button>
               <button onclick="logout()" class="w-full py-2 text-red-500 font-bold text-sm">Ø®Ø±ÙˆØ¬</button>
               <button onclick="document.getElementById('profile-modal').classList.add('hidden')" class="w-full py-2 text-gray-400 text-sm">Ø¥Ù„ØºØ§Ø¡</button>
           </div>
       </div>
   </div>

   <div id="cart-modal" class="hidden fixed inset-0 z-50 bg-black/50 flex justify-end">
     <div class="bg-white w-full max-w-md h-full flex flex-col shadow-2xl" style="animation: slideLeft 0.3s">
        <div class="p-4 border-b flex justify-between items-center bg-gray-50"><h2 class="font-bold text-lg">ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h2><button onclick="closeCart()" class="text-gray-500 font-bold text-xl">âœ•</button></div>
        <div id="cart-items" class="flex-1 overflow-y-auto p-4 space-y-3"></div>
        <div class="p-4 border-t"><div class="flex justify-between font-bold text-lg mb-4"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span><span id="cart-total" class="text-[#4b5f28]">0 Ø¬.Ù…</span></div><button onclick="checkout()" class="w-full py-4 bg-[#4b5f28] text-white font-bold rounded-xl shadow-lg">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ âœ…</button></div>
     </div>
   </div>

   <script src="card.js"></script>
   <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, where, setDoc, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { apiKey: "AIzaSyASO-AN5XaSGn4SaCZ8VlHr6zsFCIxPCzs", authDomain: "ahmed-shoes.firebaseapp.com", projectId: "ahmed-shoes", storageBucket: "ahmed-shoes.firebasestorage.app", messagingSenderId: "172928088473", appId: "1:172928088473:web:100f543fd097a8d5c33b08" };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.currentUser = JSON.parse(localStorage.getItem('userData')) || null;
    window.products = []; window.wishlist = [];

    // --- INIT ---
    async function init() {
        if(window.currentUser) {
            document.getElementById('header-username').innerText = window.currentUser.name;
            if(window.currentUser.avatar) document.getElementById('header-avatar').src = window.currentUser.avatar;
            try { const uSnap = await getDoc(doc(db, "users", window.currentUser.phone)); if(uSnap.exists() && uSnap.data().wishlist) window.wishlist = uSnap.data().wishlist; } catch(e){}
        }
        
        // Products
        const qP = query(collection(db, "products"), orderBy("timestamp", "desc"));
        const snapP = await getDocs(qP);
        window.products = snapP.docs.map(d => ({id: d.id, ...d.data()}));
        renderGrid(window.products);

        // Banners
        const qB = query(collection(db, "banners"), orderBy("timestamp", "desc"));
        const snapB = await getDocs(qB);
        if(!snapB.empty) {
            document.getElementById('banners-slider').innerHTML = snapB.docs.map(d => `<img src="${d.data().image}" class="h-full w-auto rounded-xl object-cover snap-center shadow-sm">`).join('');
        }
    }
    init();

    // --- NAVIGATION ---
    window.switchView = (v) => {
        document.querySelectorAll('.view-section').forEach(e => e.classList.add('hidden'));
        document.getElementById('view-'+v).classList.remove('hidden');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('text-[#4b5f28]'));
        document.getElementById('nav-'+v)?.classList.add('text-[#4b5f28]');
        if(v==='home') renderGrid(window.products);
    };
    window.showCategory = (cat) => {
        document.getElementById('grid-title').innerText = cat;
        renderGrid(window.products.filter(p=>p.category===cat));
        window.scrollTo({top: document.getElementById('grid-title').offsetTop - 200, behavior: 'smooth'});
    };

    // --- GRID RENDER ---
    function renderGrid(items) {
        document.getElementById('products-grid').innerHTML = items.map(p => {
            const isLiked = window.wishlist.includes(p.id);
            const saleHtml = (p.oldPrice && p.oldPrice > p.price) ? `<span class="absolute top-2 left-2 bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded shadow-md z-10">SALE</span>` : '';
            return `<div class="bg-white rounded-xl shadow-sm border overflow-hidden relative group">
                ${saleHtml}
                <button onclick="toggleWish('${p.id}', this)" class="absolute top-2 right-2 w-8 h-8 bg-white/80 rounded-full flex items-center justify-center z-10 shadow-sm heart-btn ${isLiked?'active':''}"><svg class="w-5 h-5 transition stroke-gray-400 ${isLiked?'fill-red-500 stroke-red-500':''}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></button>
                <div onclick="openProd('${p.id}')" class="h-40 bg-gray-50"><img src="${p.images[0]}" class="w-full h-full object-cover mix-blend-multiply"></div>
                <div onclick="openProd('${p.id}')" class="p-3"><h4 class="font-bold text-sm truncate">${p.name}</h4><div class="flex items-center gap-2"><p class="font-black text-[#4b5f28]">${p.price} Ø¬.Ù…</p>${saleHtml?'<p class="text-xs text-gray-400 line-through">'+p.oldPrice+'</p>':''}</div></div>
            </div>`;
        }).join('');
    }

    // --- WISHLIST & ACTIONS ---
    window.toggleWish = async (id, btn) => {
        event.stopPropagation();
        if(!window.currentUser) return toast('Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ù„Ø­ÙØ¸ Ø§Ù„Ù…ÙØ¶Ù„Ø©', 'error');
        if(window.wishlist.includes(id)) window.wishlist = window.wishlist.filter(x=>x!==id); else window.wishlist.push(id);
        btn.classList.toggle('active'); btn.querySelector('svg').classList.toggle('fill-red-500'); btn.querySelector('svg').classList.toggle('stroke-red-500');
        await updateDoc(doc(db, "users", window.currentUser.phone), { wishlist: window.wishlist });
    };
    window.openWishlist = () => {
        const items = window.products.filter(p => window.wishlist.includes(p.id));
        document.getElementById('wishlist-grid').innerHTML = items.length ? items.map(p => `<div class="bg-white rounded-xl p-3 border flex gap-3 items-center"><img src="${p.images[0]}" class="w-16 h-16 rounded object-cover"><div class="flex-1"><h4 class="font-bold text-sm">${p.name}</h4><p class="font-black text-[#4b5f28]">${p.price}</p></div><button onclick="openProd('${p.id}')" class="bg-[#4b5f28] text-white px-3 py-1 rounded text-xs">Ø´Ø±Ø§Ø¡</button></div>`).join('') : '<p class="col-span-2 text-center text-gray-400">Ù…ÙÙŠØ´ Ù…ÙØ¶Ù„Ø©</p>';
    };

    // --- AUTH, PROFILE, ORDERS (Simplified for brevity but fully functional) ---
    window.checkLoginAndAction = (act) => { if(!window.currentUser) { window.pendingAction=act; document.getElementById('login-modal').classList.remove('hidden'); } else { switchView(act); if(act==='orders') loadOrders(); if(act==='wishlist') openWishlist(); } };
    window.handleLogin = async (e) => {
        e.preventDefault(); const ph=document.getElementById('l-phone').value.trim(), btn=document.getElementById('l-btn'), newF=document.getElementById('new-user-fields'); btn.disabled=true;
        try {
            const ref = doc(db, "users", ph); const snap = await getDoc(ref);
            if(snap.exists()) finishLogin(snap.data());
            else {
                if(newF.classList.contains('hidden')) { newF.classList.remove('hidden'); btn.innerText='Ø­ÙØ¸'; btn.disabled=false; }
                else { const u={name:document.getElementById('l-name').value, address:document.getElementById('l-address').value, phone:ph, wishlist:[]}; await setDoc(ref, u); finishLogin(u); }
            }
        } catch(e) { alert('Ø®Ø·Ø£'); btn.disabled=false; }
    };
    function finishLogin(u) { localStorage.setItem('userData', JSON.stringify(u)); window.currentUser=u; window.wishlist=u.wishlist||[]; document.getElementById('header-username').innerText=u.name; if(u.avatar)document.getElementById('header-avatar').src=u.avatar; document.getElementById('login-modal').classList.add('hidden'); if(window.pendingAction){ switchView(window.pendingAction); if(window.pendingAction==='orders')loadOrders(); if(window.pendingAction==='wishlist')openWishlist(); } }
    
    window.openProfileEdit = () => { if(!window.currentUser) return checkLoginAndAction('home'); document.getElementById('profile-modal').classList.remove('hidden'); document.getElementById('edit-name').value=window.currentUser.name; document.getElementById('edit-address').value=window.currentUser.address; };
    window.saveProfile = async () => { const n=document.getElementById('edit-name').value, a=document.getElementById('edit-address').value, i=document.getElementById('edit-avatar-url').value; const up={name:n, address:a}; if(i)up.avatar=i; await updateDoc(doc(db,"users",window.currentUser.phone),up); window.currentUser={...window.currentUser,...up}; localStorage.setItem('userData',JSON.stringify(window.currentUser)); document.getElementById('header-username').innerText=n; if(i)document.getElementById('header-avatar').src=i; document.getElementById('profile-modal').classList.add('hidden'); alert('ØªÙ…'); };
    window.logout = () => { localStorage.removeItem('userData'); location.reload(); };

    async function loadOrders() {
        document.getElementById('orders-list').innerHTML='<p class="text-center py-10">â³</p>';
        const q=query(collection(db,"orders"),where("customerPhone","==",window.currentUser.phone),orderBy("timestamp","desc")); const snap=await getDocs(q);
        if(snap.empty){ document.getElementById('orders-list').innerHTML='<p class="text-center text-gray-400">Ù„Ø§ ÙŠÙˆØ¬Ø¯</p>'; return; }
        const stText={'new':'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©','processing':'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¬Ù‡ÙŠØ²','shipped':'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚','completed':'ØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…','cancelled':'Ù…Ù„ØºÙŠ'};
        const stCls={'new':'st-new','processing':'st-processing','shipped':'st-shipped','completed':'st-completed','cancelled':'st-cancelled'};
        document.getElementById('orders-list').innerHTML=snap.docs.map(d=>{ const o=d.data(), st=o.status||'new'; return `<div class="bg-white p-4 rounded-xl border shadow-sm"><div class="flex justify-between mb-2"><span class="font-bold">#${d.id.slice(0,5)}</span><span class="status-badge ${stCls[st]}">${stText[st]}</span></div><div class="text-sm text-gray-600 mb-2">${o.items.map(i=>i.productName).join(' + ')}</div><div class="flex justify-between border-t pt-2 font-bold"><span>${o.total} Ø¬.Ù…</span><span class="text-xs text-gray-400 font-normal">${new Date(o.timestamp).toLocaleDateString('ar-EG')}</span></div></div>`; }).join('');
    }

    // --- PROD MODAL ---
    window.openProd = (id) => {
        const p = window.products.find(x=>x.id===id); window.currentProd=p; window.selColorVar=null; window.selSizeVar=null;
        document.getElementById('product-modal').classList.remove('hidden'); document.getElementById('m-img').src=p.images[0]; document.getElementById('m-name').innerText=p.name; document.getElementById('m-price').innerText=p.price+' Ø¬.Ù…';
        if(p.oldPrice && p.oldPrice > p.price) { document.getElementById('m-old-price').innerText=p.oldPrice+' Ø¬.Ù…'; document.getElementById('m-old-price').classList.remove('hidden'); } else document.getElementById('m-old-price').classList.add('hidden');
        document.getElementById('m-colors').innerHTML = p.colors.map(c=>`<button onclick="selColor('${c.name}',this)" class="px-3 py-1 border rounded">${c.name}</button>`).join('');
        document.getElementById('m-sizes').innerHTML = '<span class="text-xs text-gray-400">Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ†</span>';
    };
    window.selColor = (n,btn) => { window.selColorVar=n; document.querySelectorAll('#m-colors button').forEach(b=>b.classList.remove('bg-[#4b5f28]','text-white')); btn.classList.add('bg-[#4b5f28]','text-white'); const sizes = window.currentProd.colors.find(c=>c.name===n).sizes; document.getElementById('m-sizes').innerHTML = sizes.map(s=>`<button onclick="selSize('${s}',this)" class="w-8 h-8 bg-gray-100 rounded hover:bg-[#4b5f28] hover:text-white">${s}</button>`).join(''); };
    window.selSize = (s,btn) => { window.selSizeVar=s; document.querySelectorAll('#m-sizes button').forEach(b=>b.classList.remove('bg-[#4b5f28]','text-white')); btn.classList.add('bg-[#4b5f28]','text-white'); };
    
    window.checkout = async () => {
        if(!window.cart?.length) return alert('Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©');
        if(!window.currentUser) return checkLoginAndAction('home');
        const btn=document.querySelector('#cart-modal button:last-child'); btn.disabled=true;
        try { await addDoc(collection(db,"orders"),{items:window.cart, total:window.cart.reduce((s,i)=>s+(i.price*i.qty),0), customerName:window.currentUser.name, customerPhone:window.currentUser.phone, customerAddress:window.currentUser.address, timestamp:Date.now(), status:'new'}); window.cart=[]; saveCart(); renderCart(); updateCartBadge(); closeCart(); alert('ØªÙ… Ø§Ù„Ø·Ù„Ø¨ âœ…'); } catch(e){alert('Ø®Ø·Ø£');} btn.disabled=false;
    };
    window.toast=(m,t)=>{const e=document.createElement('div');e.className=`bg-${t=='error'?'red':'green'}-600 text-white px-6 py-3 rounded-full font-bold shadow-xl mb-2 animate-bounce`;e.innerText=m;document.getElementById('toast-container').appendChild(e);setTimeout(()=>e.remove(),3000)};
   </script>
 </body>
</html>
