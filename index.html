<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® - Ù„Ù„Ø£Ø­Ø°ÙŠØ©</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: { 
        extend: { 
          colors: { 
            brand: { 
              light: '#F3F4F6', 
              DEFAULT: '#4b5f28', // Ø§Ù„Ø²ÙŠØªÙŠ Ø§Ù„ØºØ§Ù…Ù‚
              text: '#2d3748',
              accent: '#708238' 
            } 
          },
          boxShadow: {
            'soft': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
          }
        } 
      } 
    }
  </script>
  
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #f0f2f5; color: #1a1a1a; background-image: radial-gradient(#e5e7eb 1px, transparent 1px); background-size: 20px 20px; }
    .profile-container { width: 140px; height: 140px; margin: 0 auto; border-radius: 50%; background: white; padding: 5px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); border: 4px solid white; position: relative; overflow: hidden; }
    .profile-img { width: 100%; height: 100%; border-radius: 50%; object-fit: contain; background-color: #fff; }
    .link-btn { display: flex; align-items: center; gap: 1.5rem; width: 100%; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); padding: 1rem 1.5rem; border-radius: 1.5rem; margin-bottom: 1rem; border: 1px solid #ffffff; box-shadow: 0 4px 6px rgba(0,0,0,0.02); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
    .link-btn:hover { transform: translateY(-3px); border-color: #4b5f28; }
    .btn-icon-box { width: 50px; height: 50px; background: #f8fafc; border-radius: 50%; display: flex; align-items: center; justify-content: center; overflow: hidden; border: 1px solid #e2e8f0; flex-shrink: 0; }
    .btn-icon-img { width: 100%; height: 100%; object-fit: cover; }
    .link-btn h3 { font-size: 1.1rem; font-weight: 800; color: #3f4a20; flex-grow: 1; text-align: right; }
    .modal-overlay { background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
    .verified-badge { display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; background: #4b5f28; color: white; border-radius: 50%; font-size: 12px; margin-right: 5px; }
    /* Ø³ØªØ§ÙŠÙ„Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† */
    .admin-tab { padding: 10px 20px; border-radius: 10px; font-weight: bold; transition: 0.3s; cursor: pointer; flex: 1; text-align: center; border: 1px solid #333; }
    .admin-tab.active { background-color: #4b5f28; color: white; border-color: #4b5f28; }
    .admin-tab.inactive { background-color: transparent; color: #888; }
  </style>
 </head>
 <body class="h-full min-h-screen overflow-auto">

   <div id="home-view" class="max-w-md mx-auto px-6 py-10 min-h-screen flex flex-col items-center">
     <div class="w-full flex justify-end mb-4">
        <button onclick="toggleAdmin()" class="text-xs text-gray-400 hover:text-brand transition">ğŸ” Admin</button>
     </div>

     <div class="text-center mb-10 w-full relative">
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-48 h-48 bg-brand-accent/10 rounded-full blur-3xl -z-10"></div>
        <div class="profile-container mb-4">
            <img src="Ø§Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ® (3).png" class="profile-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2589/2589903.png'">
        </div>
        <h1 class="text-3xl font-black text-brand mb-1 flex items-center justify-center gap-2">
            <span class="verified-badge">âœ“</span> Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®
        </h1>
        <p class="text-gray-500 font-bold text-sm tracking-widest uppercase">CHIC & ELEGANT SHOES</p>
     </div>

     <div class="w-full space-y-4">
       <button onclick="showCategory('Ø±Ø¬Ø§Ù„ÙŠ')" class="link-btn group">
         <div class="btn-icon-box group-hover:scale-110 transition"><img src="man.png" class="btn-icon-img" onerror="this.parentElement.innerHTML='ğŸ‘'"></div>
         <h3>MEN COLLECTION</h3><span class="text-gray-400">â†’</span>
       </button>
       <button onclick="showCategory('Ø­Ø±ÙŠÙ…ÙŠ')" class="link-btn group">
         <div class="btn-icon-box group-hover:scale-110 transition"><img src="women.png" class="btn-icon-img" onerror="this.parentElement.innerHTML='ğŸ‘ '"></div>
         <h3>WOMEN COLLECTION</h3><span class="text-gray-400">â†’</span>
       </button>
       <button onclick="showCategory('Ø£Ø·ÙØ§Ù„ÙŠ')" class="link-btn group">
         <div class="btn-icon-box group-hover:scale-110 transition"><img src="kids.png" class="btn-icon-img" onerror="this.parentElement.innerHTML='ğŸ‘Ÿ'"></div>
         <h3>KIDS COLLECTION</h3><span class="text-gray-400">â†’</span>
       </button>

       <div class="flex gap-3 mt-6 w-full">
           <a href="https://wa.me/201020468021" class="flex-1 bg-white p-4 rounded-xl flex justify-center shadow-sm text-green-600">Whatsapp</a>
           <a href="https://www.facebook.com/share/14VSGdA8ufc/" class="flex-1 bg-white p-4 rounded-xl flex justify-center shadow-sm text-blue-600">Facebook</a>
           <a href="https://www.instagram.com/elshekh_store?igsh=YWVkM2ExY3owc2Vl" class="flex-1 bg-white p-4 rounded-xl flex justify-center shadow-sm text-pink-600">Instagram</a>
       </div>
     </div>
   </div>

   <div id="products-view" class="hidden max-w-6xl mx-auto px-4 py-6 min-h-screen">
     <div class="bg-white/90 backdrop-blur-md px-4 py-3 rounded-2xl sticky top-4 z-40 flex justify-between items-center mb-8 shadow-sm border border-gray-100">
       <div class="flex items-center gap-2">
           <button onclick="goHome()" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600 hover:bg-brand hover:text-white transition">â†</button>
           <h3 id="cat-title" class="text-xl font-bold text-brand-dark"></h3>
       </div>
     </div>
     <div id="loading-msg" class="text-center py-20 text-brand hidden font-bold">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±...</div>
     <div id="grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
     <div id="empty-msg" class="hidden text-center py-20"><p class="text-gray-400 font-bold">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p></div>
   </div>

   <div id="modal" class="hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4">
     <div class="bg-white w-full max-w-md rounded-[2rem] overflow-hidden shadow-2xl max-h-[95vh] overflow-y-auto relative flex flex-col">
       <button onclick="closeModal()" class="absolute top-4 left-4 bg-white/90 w-10 h-10 rounded-full z-20 text-gray-800 shadow-lg text-xl flex items-center justify-center hover:bg-red-50 hover:text-red-500">âœ•</button>
       <div class="bg-gray-50 h-72 flex items-center justify-center relative shrink-0"><img id="main-img" class="max-h-full max-w-full object-contain mix-blend-multiply"><div id="thumbs" class="absolute bottom-4 flex gap-2 justify-center w-full px-2"></div></div>
       <div class="p-6">
         <h2 id="m-name" class="text-2xl font-bold text-center mb-1 text-gray-800"></h2>
         <p id="m-price" class="text-3xl font-black text-brand text-center mb-6"></p>
         <div class="mb-6 text-center"><p class="text-xs text-gray-400 mb-2 font-bold uppercase">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø§Ø³</p><div id="m-sizes" class="flex flex-wrap justify-center gap-2"></div></div>
         <div class="mb-6 p-4 bg-white border-2 border-dashed border-green-300 rounded-2xl text-center shadow-sm">
             <p class="text-xs text-gray-500 font-bold mb-1">ğŸ’³ Ø§Ù„Ø¯ÙØ¹ ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</p>
             <p class="text-xl font-black text-green-600 font-mono">01020468021</p>
         </div>
         <div class="space-y-3 pt-2">
           <input id="c-name" placeholder="Ø§Ù„Ø§Ø³Ù…" class="w-full bg-gray-50 border p-4 rounded-xl text-sm outline-none focus:border-brand">
           <input id="c-phone" type="tel" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="w-full bg-gray-50 border p-4 rounded-xl text-sm outline-none focus:border-brand">
           <input id="c-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" class="w-full bg-gray-50 border p-4 rounded-xl text-sm outline-none focus:border-brand">
           <button onclick="sendOrder()" id="order-btn" class="w-full py-4 rounded-xl font-bold mt-2 text-lg shadow-xl text-white bg-brand hover:bg-brand-accent transition">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ âœ…</button>
         </div>
       </div>
     </div>
   </div>

   <div id="admin-panel" class="hidden fixed inset-0 z-50 bg-[#1a1a1a] overflow-y-auto text-white">
     <div class="p-4 max-w-2xl mx-auto">
       <header class="flex justify-between items-center mb-8 border-b border-gray-800 pb-4 sticky top-0 bg-[#1a1a1a] z-10 pt-4">
         <h2 class="text-2xl font-bold text-brand">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†)</h2>
         <button onclick="toggleAdmin()" class="text-gray-400 hover:text-white">Ø¥ØºÙ„Ø§Ù‚</button>
       </header>

       <div class="flex gap-2 mb-6">
           <div onclick="switchAdminTab('products')" id="tab-products" class="admin-tab active">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
           <div onclick="switchAdminTab('orders')" id="tab-orders" class="admin-tab inactive">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
       </div>

       <div id="admin-products-section">
           <div class="bg-gray-900 p-6 rounded-xl mb-8 border border-gray-800">
             <h3 class="font-bold mb-4 text-brand-light">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h3>
             <div class="space-y-4">
               <div class="border-2 border-dashed border-gray-700 bg-gray-800/50 p-6 text-center rounded-xl cursor-pointer" onclick="document.getElementById('file-in').click()">
                 <input type="file" id="file-in" multiple accept="image/*" class="hidden" onchange="handleFiles(this)">
                 <span class="text-gray-400 text-sm">Ø§Ø¶ØºØ· Ù„Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±</span>
                 <div id="preview" class="flex gap-2 justify-center mt-2"></div>
                 <p id="img-status" class="text-xs text-yellow-500 mt-1 hidden">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p>
               </div>
               
               <input id="new-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„" class="w-full bg-gray-800 border border-gray-700 p-3 rounded-xl text-white outline-none">
               <div class="flex gap-3">
                 <input id="new-price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="flex-1 bg-gray-800 border border-gray-700 p-3 rounded-xl text-white outline-none">
                 <select id="new-cat" class="flex-1 bg-gray-800 border border-gray-700 p-3 rounded-xl text-white outline-none">
                   <option value="Ø±Ø¬Ø§Ù„ÙŠ">Ø±Ø¬Ø§Ù„ÙŠ</option><option value="Ø­Ø±ÙŠÙ…ÙŠ">Ø­Ø±ÙŠÙ…ÙŠ</option><option value="Ø£Ø·ÙØ§Ù„ÙŠ">Ø£Ø·ÙØ§Ù„ÙŠ</option>
                 </select>
               </div>
               <div id="size-options" class="flex flex-wrap gap-2 p-3 bg-gray-800 rounded-xl"></div>
               <button onclick="addProduct()" id="save-btn" class="w-full py-3 rounded-xl font-bold bg-brand text-white hover:bg-brand-accent transition">Ø­ÙØ¸ ÙˆØ±ÙØ¹ Ù„Ù„Ø³ÙŠØ±ÙØ± â˜ï¸</button>
             </div>
           </div>
           <h3 class="font-bold mb-4 text-gray-400">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h3>
           <div id="admin-list" class="space-y-3 pb-10"></div>
       </div>

       <div id="admin-orders-section" class="hidden">
           <div id="admin-orders-list" class="space-y-3 pb-10"></div>
       </div>
     </div>
   </div>

   <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // âœ…âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ Ø§Ù„ÙƒÙˆÙ†ÙÙŠØ¬Ø±ÙŠØ´Ù† Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§ âœ…âœ…
    const firebaseConfig = {
      apiKey: "AIzaSyASO-AN5XaSGn4SaCZ8VlHr6zsFCIxPCzs",
      authDomain: "ahmed-shoes.firebaseapp.com",
      projectId: "ahmed-shoes",
      storageBucket: "ahmed-shoes.firebasestorage.app",
      messagingSenderId: "172928088473",
      appId: "1:172928088473:web:100f543fd097a8d5c33b08",
      measurementId: "G-S50TX0VMKE"
    };

    // ØªÙ‡ÙŠØ¦Ø© ÙØ§ÙŠØ±Ø¨ÙŠØ³
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù„Ù…ÙŠØ©
    window.newImages = []; 
    window.newSizes = [];
    window.currentProd = null;
    window.currentSize = null;

    // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…
    window.toggleAdmin = function() {
        const p = document.getElementById('admin-panel');
        if(p.classList.contains('hidden')) {
            const pass = prompt('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:');
            if(pass === 'admin123') {
                p.classList.remove('hidden');
                switchAdminTab('products');
                updateSizeOpts();
            } else alert('Ø®Ø·Ø£');
        } else p.classList.add('hidden');
    }

    window.switchAdminTab = function(t) {
        document.getElementById('admin-products-section').classList.toggle('hidden', t !== 'products');
        document.getElementById('admin-orders-section').classList.toggle('hidden', t !== 'orders');
        document.getElementById('tab-products').className = t === 'products' ? 'admin-tab active' : 'admin-tab inactive';
        document.getElementById('tab-orders').className = t === 'orders' ? 'admin-tab active' : 'admin-tab inactive';
        if(t === 'products') loadProductsAdmin();
        if(t === 'orders') loadOrdersAdmin();
    }

    // --- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ---
    window.updateSizeOpts = function() {
        const cat = document.getElementById('new-cat').value;
        const sizes = cat === 'Ø±Ø¬Ø§Ù„ÙŠ' ? [40,41,42,43,44,45] : (cat === 'Ø­Ø±ÙŠÙ…ÙŠ' ? [37,38,39,40,41] : [26,27,28,29,30,31,32,33,34,35]);
        window.newSizes = [];
        document.getElementById('size-options').innerHTML = sizes.map(s => `<button onclick="toggleSize(${s}, this)" class="px-3 py-1 rounded bg-gray-700 text-sm border border-gray-600 hover:border-green-500">${s}</button>`).join('');
    }
    window.toggleSize = function(s, btn) {
        if(window.newSizes.includes(s)) { window.newSizes = window.newSizes.filter(x=>x!==s); btn.style.borderColor='#4b5563'; }
        else { window.newSizes.push(s); btn.style.borderColor='#708238'; }
    }
    document.getElementById('new-cat').addEventListener('change', window.updateSizeOpts);

    window.handleFiles = function(input) {
        window.newImages = [];
        document.getElementById('preview').innerHTML = '';
        document.getElementById('img-status').classList.remove('hidden');
        
        let processed = 0;
        const files = [...input.files].slice(0,4);
        
        files.forEach(f => {
            const r = new FileReader();
            r.onload = e => {
                const img = new Image(); img.src=e.target.result;
                img.onload = () => {
                    const c = document.createElement('canvas'); const ctx=c.getContext('2d');
                    // Ø¶ØºØ· Ù‚ÙˆÙŠ Ù„Ù„ØµÙˆØ±Ø© Ù„ØªÙ†Ø§Ø³Ø¨ ÙØ§ÙŠØ±Ø¨ÙŠØ³
                    const maxWidth = 600;
                    c.width=maxWidth; c.height=img.height*(maxWidth/img.width);
                    ctx.drawImage(img,0,0,c.width,c.height);
                    const d = c.toDataURL('image/jpeg', 0.6);
                    window.newImages.push(d);
                    document.getElementById('preview').innerHTML+=`<img src="${d}" class="w-10 h-10 rounded border border-gray-500">`;
                    processed++;
                    if(processed === files.length) {
                        document.getElementById('img-status').innerText = "âœ… Ø§Ù„ØµÙˆØ± Ø¬Ø§Ù‡Ø²Ø©";
                        document.getElementById('img-status').classList.replace('text-yellow-500', 'text-green-500');
                    }
                }
            }; r.readAsDataURL(f);
        });
    }

    window.addProduct = async function() {
        const btn = document.getElementById('save-btn');
        const name = document.getElementById('new-name').value;
        const price = document.getElementById('new-price').value;
        
        if(!name || !price || !window.newImages.length) return alert('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ Ù„Ù„Ø³ÙŠØ±ÙØ±...";
        btn.disabled = true;

        try {
            await addDoc(collection(db, "products"), {
                name: name,
                price: price,
                category: document.getElementById('new-cat').value,
                images: window.newImages,
                sizes: window.newSizes,
                timestamp: Date.now()
            });
            alert('ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„Ø¢Ù† Ø¹Ù†Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡.');
            // Reset
            document.getElementById('new-name').value = '';
            document.getElementById('preview').innerHTML = '';
            window.newImages = [];
        } catch (e) {
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message);
        }
        btn.innerText = "Ø­ÙØ¸ ÙˆØ±ÙØ¹ Ù„Ù„Ø³ÙŠØ±ÙØ± â˜ï¸";
        btn.disabled = false;
    }

    function loadProductsAdmin() {
        const q = query(collection(db, "products"), orderBy("timestamp", "desc"));
        onSnapshot(q, (snapshot) => {
            const list = document.getElementById('admin-list');
            list.innerHTML = "";
            snapshot.forEach((doc) => {
                const p = doc.data();
                list.innerHTML += `
                    <div class="bg-[#2d2d2d] p-3 rounded flex justify-between items-center border border-gray-600">
                        <div class="flex gap-2 items-center">
                            <img src="${p.images[0]}" class="w-12 h-12 rounded object-cover">
                            <div><div class="font-bold">${p.name}</div><div class="text-xs text-gray-400">${p.price} Ø¬.Ù…</div></div>
                        </div>
                        <button onclick="delProd('${doc.id}')" class="text-red-400 text-sm border border-red-900 p-1 rounded">Ø­Ø°Ù</button>
                    </div>
                `;
            });
        });
    }

    window.delProd = async function(id) {
        if(confirm('Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±ØŸ')) {
            await deleteDoc(doc(db, "products", id));
        }
    }

    // --- Ø§Ù„Ø·Ù„Ø¨Ø§Øª ---
    async function sendOrder() {
        const name = document.getElementById('c-name').value;
        const addr = document.getElementById('c-address').value;
        const phone = document.getElementById('c-phone').value;
        
        if(!window.currentSize || !name || !addr) return alert('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        
        document.getElementById('order-btn').innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
        
        try {
            await addDoc(collection(db, "orders"), {
                productName: window.currentProd.name,
                productPrice: window.currentProd.price,
                size: window.currentSize,
                customerName: name,
                customerPhone: phone,
                customerAddress: addr,
                timestamp: Date.now()
            });
            alert('âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³Ù†ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹.');
            closeModal();
        } catch (e) {
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
        }
        document.getElementById('order-btn').innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ âœ…";
    }

    function loadOrdersAdmin() {
        const q = query(collection(db, "orders"), orderBy("timestamp", "desc"));
        onSnapshot(q, (snapshot) => {
            const list = document.getElementById('admin-orders-list');
            list.innerHTML = "";
            if(snapshot.empty) list.innerHTML = '<p class="text-center text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>';
            snapshot.forEach((doc) => {
                const o = doc.data();
                list.innerHTML += `
                    <div class="bg-[#2d2d2d] p-4 rounded-xl border-r-4 border-[#708238]">
                        <div class="flex justify-between mb-2">
                            <span class="text-xs text-gray-400">${new Date(o.timestamp).toLocaleString('ar-EG')}</span>
                            <button onclick="delOrder('${doc.id}')" class="text-red-400 text-xs">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… (Ø­Ø°Ù)</button>
                        </div>
                        <div class="font-bold text-lg text-white mb-1">${o.productName}</div>
                        <div class="text-[#708238] text-sm mb-3">Ø§Ù„Ø³Ø¹Ø±: ${o.productPrice} | Ù…Ù‚Ø§Ø³: ${o.size}</div>
                        <div class="bg-black/30 p-2 rounded text-sm text-gray-300">
                            <p>ğŸ‘¤ ${o.customerName}</p>
                            <p>ğŸ“ <a href="tel:${o.customerPhone}" class="text-blue-400">${o.customerPhone}</a></p>
                            <p>ğŸ“ ${o.customerAddress}</p>
                        </div>
                    </div>
                `;
            });
        });
    }

    window.delOrder = async function(id) {
        if(confirm('Ù‡Ù„ ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ØŸ Ø³ÙŠØªÙ… Ø­Ø°ÙÙ‡.')) {
            await deleteDoc(doc(db, "orders", id));
        }
    }

    // --- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„ ---
    window.showCategory = async function(cat) {
        document.getElementById('home-view').classList.add('hidden');
        document.getElementById('products-view').classList.remove('hidden');
        document.getElementById('cat-title').innerText = cat;
        document.getElementById('loading-msg').classList.remove('hidden');
        document.getElementById('grid').innerHTML = '';

        const q = query(collection(db, "products"), orderBy("timestamp", "desc"));
        const snapshot = await getDocs(q);
        window.products = [];
        snapshot.forEach(doc => window.products.push({id: doc.id, ...doc.data()}));

        document.getElementById('loading-msg').classList.add('hidden');
        const items = window.products.filter(p => p.category === cat);
        
        if(!items.length) { document.getElementById('empty-msg').classList.remove('hidden'); return; }
        document.getElementById('empty-msg').classList.add('hidden');

        document.getElementById('grid').innerHTML = items.map(p => `
            <div onclick="openModal('${p.id}')" class="bg-white rounded-2xl overflow-hidden cursor-pointer shadow-soft hover:shadow-lg transition border border-gray-100">
                <div class="h-44 bg-gray-50 relative"><img src="${p.images[0]}" class="w-full h-full object-cover mix-blend-multiply"></div>
                <div class="p-4"><h4 class="font-bold text-sm truncate">${p.name}</h4><span class="text-brand font-black text-sm">${p.price} Ø¬.Ù…</span></div>
            </div>
        `).join('');
    }

    window.goHome = function() { document.getElementById('products-view').classList.add('hidden'); document.getElementById('home-view').classList.remove('hidden'); }
    window.openModal = function(id) {
        window.currentProd = window.products.find(p => p.id === id);
        document.getElementById('modal').classList.remove('hidden');
        document.getElementById('m-name').innerText = window.currentProd.name;
        document.getElementById('m-price').innerText = window.currentProd.price + ' Ø¬.Ù…';
        document.getElementById('main-img').src = window.currentProd.images[0];
        document.getElementById('thumbs').innerHTML = window.currentProd.images.map(src => `<div onclick="document.getElementById('main-img').src='${src}'" class="w-12 h-12 rounded-lg border cursor-pointer overflow-hidden"><img src="${src}" class="w-full h-full object-cover"></div>`).join('');
        document.getElementById('m-sizes').innerHTML = window.currentProd.sizes.map(s => `<button onclick="selectSize(${s}, this)" class="w-8 h-8 rounded-lg bg-gray-100 text-xs font-bold text-gray-600 hover:bg-brand hover:text-white transition">${s}</button>`).join('');
    }
    window.selectSize = function(s, btn) { window.currentSize = s; document.querySelectorAll('#m-sizes button').forEach(b => b.classList.remove('bg-brand', 'text-white')); btn.classList.add('bg-brand', 'text-white'); }
    window.closeModal = function() { document.getElementById('modal').classList.add('hidden'); }
   </script>
 </body>
</html>
