<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© | Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <style>body { font-family: 'Cairo', sans-serif; background: #f0f2f5; }</style>
</head>
<body class="bg-gray-100 min-h-screen">
    
    <div class="max-w-4xl mx-auto p-6">
        <header class="flex justify-between items-center mb-8 bg-white p-4 rounded-xl shadow-sm">
            <h1 class="text-2xl font-bold text-[#4b5f28]">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            <a href="index.html" class="text-sm bg-gray-100 px-3 py-1 rounded hover:bg-gray-200">Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø± â†—</a>
        </header>

        <div class="bg-white rounded-2xl shadow-sm p-6 mb-8 border border-gray-100">
            <h2 class="font-bold text-lg mb-4 text-gray-700">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <input id="prod-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" class="p-3 bg-gray-50 rounded-lg border focus:border-[#4b5f28] outline-none">
                <input id="prod-price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="p-3 bg-gray-50 rounded-lg border focus:border-[#4b5f28] outline-none">
            </div>
            
            <div class="mb-4">
                <select id="prod-cat" class="w-full p-3 bg-gray-50 rounded-lg border outline-none">
                    <option value="Ø±Ø¬Ø§Ù„ÙŠ">Ø±Ø¬Ø§Ù„ÙŠ</option>
                    <option value="Ø­Ø±ÙŠÙ…ÙŠ">Ø­Ø±ÙŠÙ…ÙŠ</option>
                    <option value="Ø£Ø·ÙØ§Ù„ÙŠ">Ø£Ø·ÙØ§Ù„ÙŠ</option>
                </select>
            </div>

            <div class="border-2 border-dashed border-gray-300 p-6 rounded-xl text-center cursor-pointer hover:border-[#4b5f28] transition mb-4" onclick="document.getElementById('img-file').click()">
                <input type="file" id="img-file" multiple hidden onchange="handleImgSelect(this)">
                <p class="text-gray-500">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬ ğŸ“¸</p>
            </div>
            <div id="preview-area" class="flex gap-2 mb-4 overflow-x-auto"></div>

            <div class="bg-gray-50 p-4 rounded-xl mb-4">
                <p class="font-bold text-sm mb-2">ğŸ¨ ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ù‚Ø§Ø³Ø§Øª</p>
                <div class="flex gap-2 mb-2">
                    <input id="color-name" placeholder="Ø§Ù„Ù„ÙˆÙ† (Ù…Ø«Ù„Ø§Ù‹: Ø£Ø³ÙˆØ¯)" class="p-2 border rounded text-sm flex-1">
                    <button onclick="startColor()" class="bg-gray-800 text-white px-3 rounded text-sm">Ø¥Ø¶Ø§ÙØ©</button>
                </div>
                <div id="colors-setup-list" class="space-y-2"></div>
            </div>

            <button onclick="uploadProduct()" id="upload-btn" class="w-full bg-[#4b5f28] text-white py-3 rounded-xl font-bold hover:bg-[#3a4a1f] transition shadow-lg">
                Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ğŸš€
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const app = initializeApp({
            apiKey: "AIzaSyASO-AN5XaSGn4SaCZ8VlHr6zsFCIxPCzs",
            authDomain: "ahmed-shoes.firebaseapp.com",
            projectId: "ahmed-shoes",
            storageBucket: "ahmed-shoes.firebasestorage.app",
            messagingSenderId: "172928088473",
            appId: "1:172928088473:web:100f543fd097a8d5c33b08",
        });
        const db = getFirestore(app);

        let tempImages = [];
        let productConfig = []; // [{name: 'Black', sizes: [41,42]}]

        window.handleImgSelect = (input) => {
            const files = [...input.files];
            document.getElementById('preview-area').innerHTML = '';
            tempImages = [];
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    tempImages.push(e.target.result); // Base64 for simplicity
                    document.getElementById('preview-area').innerHTML += 
                        `<img src="${e.target.result}" class="w-16 h-16 object-cover rounded shadow-sm border">`;
                };
                reader.readAsDataURL(file);
            });
        };

        window.startColor = () => {
            const name = document.getElementById('color-name').value;
            if(!name) return;
            productConfig.push({ name, sizes: [] });
            document.getElementById('color-name').value = '';
            renderConfig();
        };

        window.addSizeToColor = (idx) => {
            const size = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù‚Ø§Ø³:");
            if(size) {
                productConfig[idx].sizes.push(size);
                productConfig[idx].sizes.sort((a,b)=>a-b);
                renderConfig();
            }
        };

        function renderConfig() {
            document.getElementById('colors-setup-list').innerHTML = productConfig.map((c, idx) => `
                <div class="flex items-center justify-between bg-white p-2 rounded border">
                    <span class="font-bold text-gray-700">${c.name}</span>
                    <div class="flex flex-wrap gap-1 mx-2">
                        ${c.sizes.map(s => `<span class="bg-gray-100 px-2 rounded text-xs">${s}</span>`).join('')}
                        <button onclick="addSizeToColor(${idx})" class="text-[#4b5f28] text-xs font-bold border border-[#4b5f28] px-1 rounded">+</button>
                    </div>
                    <button onclick="productConfig.splice(${idx},1); renderConfig()" class="text-red-500 font-bold">âœ•</button>
                </div>
            `).join('');
        }
        window.addSizeToColor = window.addSizeToColor; // Expose to global

        window.uploadProduct = async () => {
            const name = document.getElementById('prod-name').value;
            const price = document.getElementById('prod-price').value;
            const cat = document.getElementById('prod-cat').value;
            const btn = document.getElementById('upload-btn');

            if(!name || !price || tempImages.length === 0) return alert('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØµÙˆØ±');

            btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';
            btn.disabled = true;

            try {
                await addDoc(collection(db, "products"), {
                    name, price, category: cat,
                    images: tempImages, // ÙŠÙØ¶Ù„ Ø±ÙØ¹Ù‡Ø§ Storage Ø¨Ø³ Ø§Ù„Ù€ Base64 Ø´ØºØ§Ù„ Ù„Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ØµØºÙŠØ±Ø©
                    colors: productConfig,
                    timestamp: Date.now()
                });
                alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­! âœ…');
                location.reload();
            } catch (e) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message);
                btn.innerText = 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>
