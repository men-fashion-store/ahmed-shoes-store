<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Cairo', sans-serif; background-color: #1a1a1a; color: white; }
    .input-dark { background: #2d2d2d; border: 1px solid #444; color: white; padding: 10px; width: 100%; border-radius: 8px; outline: none; }
    .input-dark:focus { border-color: #708238; }
    .btn-primary { background: #708238; color: white; padding: 10px; border-radius: 8px; font-weight: bold; width: 100%; transition: 0.3s; }
    .btn-primary:hover { background: #556b2f; }
    .tab { padding: 10px; cursor: pointer; border-bottom: 2px solid transparent; flex: 1; text-align: center; color: #888; }
    .tab.active { border-color: #708238; color: #708238; font-weight: bold; }
  </style>
 </head>
 <body class="p-4 max-w-3xl mx-auto">

   <div id="login-screen" class="fixed inset-0 bg-[#1a1a1a] flex items-center justify-center z-50">
       <div class="bg-[#2d2d2d] p-8 rounded-xl text-center w-full max-w-sm">
           <h2 class="text-2xl font-bold mb-4">ğŸ” Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
           <input type="password" id="admin-pass" class="input-dark text-center mb-4" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
           <button onclick="login()" class="btn-primary">Ø¯Ø®ÙˆÙ„</button>
       </div>
   </div>

   <div id="dashboard" class="hidden">
       <header class="flex justify-between items-center mb-6 border-b border-gray-700 pb-4">
           <h1 class="text-2xl font-bold text-[#708238]">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©</h1>
           <button onclick="location.reload()" class="text-red-400 text-sm">Ø®Ø±ÙˆØ¬</button>
       </header>

       <div class="flex mb-6 border-b border-gray-700">
           <div onclick="switchTab('products')" id="tab-products" class="tab active">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
           <div onclick="switchTab('orders')" id="tab-orders" class="tab">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</div>
       </div>

       <div id="sec-products">
           <div class="bg-[#2d2d2d] p-4 rounded-xl mb-6">
               <h3 class="font-bold mb-4">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h3>
               <div class="space-y-3">
                   <div class="border-2 border-dashed border-gray-600 p-4 text-center rounded-xl cursor-pointer" onclick="document.getElementById('file-in').click()">
                        <input type="file" id="file-in" multiple accept="image/*" class="hidden" onchange="handleFiles(this)">
                        <span class="text-gray-400 text-sm">Ø§Ø¶ØºØ· Ù„Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±</span>
                   </div>
                   <div id="preview" class="flex gap-2 justify-center"></div>
                   <p id="img-status" class="text-xs text-center text-yellow-500 hidden">Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±...</p>
                   
                   <input id="new-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„" class="input-dark">
                   <div class="flex gap-2">
                       <input id="new-price" type="number" placeholder="Ø§Ù„Ø³Ø¹Ø±" class="input-dark">
                       <select id="new-cat" class="input-dark">
                           <option value="Ø±Ø¬Ø§Ù„ÙŠ">Ø±Ø¬Ø§Ù„ÙŠ</option>
                           <option value="Ø­Ø±ÙŠÙ…ÙŠ">Ø­Ø±ÙŠÙ…ÙŠ</option>
                           <option value="Ø£Ø·ÙØ§Ù„ÙŠ">Ø£Ø·ÙØ§Ù„ÙŠ</option>
                       </select>
                   </div>
                   <div id="size-options" class="flex flex-wrap gap-2"></div>
                   <button onclick="addProduct()" id="save-btn" class="btn-primary">Ø­ÙØ¸ ÙˆØ±ÙØ¹ Ù„Ù„Ø³ÙŠØ±ÙØ± â˜ï¸</button>
               </div>
           </div>
           <h3 class="mb-2 font-bold text-gray-400">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©:</h3>
           <div id="products-list" class="space-y-2">
               <p class="text-center text-gray-600 py-4">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
           </div>
       </div>

       <div id="sec-orders" class="hidden">
           <div id="orders-list" class="space-y-4">
               <p class="text-center text-gray-600 py-4">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</p>
           </div>
       </div>
   </div>

   <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // âœ… ÙƒÙˆØ¯ Ø§Ù„ÙØ§ÙŠØ±Ø¨ÙŠØ³ (ØªÙ… Ø¯Ù…Ø¬Ù‡)
    const firebaseConfig = {
      apiKey: "AIzaSyASO-AN5XaSGn4SaCZ8VlHr6zsFCIxPCzs",
      authDomain: "ahmed-shoes.firebaseapp.com",
      projectId: "ahmed-shoes",
      storageBucket: "ahmed-shoes.firebasestorage.app",
      messagingSenderId: "172928088473",
      appId: "1:172928088473:web:100f543fd097a8d5c33b08",
      measurementId: "G-S50TX0VMKE"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.newImages = []; 
    window.newSizes = [];

    window.login = function() {
        if(document.getElementById('admin-pass').value === 'admin123') {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            loadProducts();
            loadOrders();
            updateSizeOpts();
        } else alert('Ø®Ø·Ø£');
    }

    window.switchTab = function(t) {
        document.getElementById('sec-products').classList.toggle('hidden', t !== 'products');
        document.getElementById('sec-orders').classList.toggle('hidden', t !== 'orders');
        document.getElementById('tab-products').className = t === 'products' ? 'tab active' : 'tab';
        document.getElementById('tab-orders').className = t === 'orders' ? 'tab active' : 'tab';
    }

    window.updateSizeOpts = function() {
        const cat = document.getElementById('new-cat').value;
        const sizes = cat === 'Ø±Ø¬Ø§Ù„ÙŠ' ? [40,41,42,43,44,45] : (cat === 'Ø­Ø±ÙŠÙ…ÙŠ' ? [37,38,39,40,41] : [26,27,28,29,30,31,32,33,34,35]);
        window.newSizes = [];
        document.getElementById('size-options').innerHTML = sizes.map(s => `<button onclick="toggleSize(${s}, this)" class="px-3 py-1 rounded bg-gray-700 text-sm border border-gray-600 hover:border-green-500">${s}</button>`).join('');
    }
    window.toggleSize = function(s, btn) {
        if(window.newSizes.includes(s)) { window.newSizes = window.newSizes.filter(x=>x!==s); btn.style.borderColor='#4b5563'; }
        else { window.newSizes.push(s); btn.style.borderColor='#708238'; }
    }
    document.getElementById('new-cat').addEventListener('change', window.updateSizeOpts);

    window.handleFiles = function(input) {
        window.newImages = [];
        document.getElementById('preview').innerHTML = '';
        document.getElementById('img-status').classList.remove('hidden');
        
        let processed = 0;
        const files = [...input.files].slice(0,4);
        
        files.forEach(f => {
            const r = new FileReader();
            r.onload = e => {
                const img = new Image(); img.src=e.target.result;
                img.onload = () => {
                    const c = document.createElement('canvas'); const ctx=c.getContext('2d');
                    const maxWidth = 600;
                    c.width=maxWidth; c.height=img.height*(maxWidth/img.width);
                    ctx.drawImage(img,0,0,c.width,c.height);
                    const d = c.toDataURL('image/jpeg', 0.6);
                    window.newImages.push(d);
                    document.getElementById('preview').innerHTML+=`<img src="${d}" class="w-10 h-10 rounded border border-gray-500">`;
                    processed++;
                    if(processed === files.length) {
                        document.getElementById('img-status').innerText = "âœ… Ø§Ù„ØµÙˆØ± Ø¬Ø§Ù‡Ø²Ø©";
                        document.getElementById('img-status').classList.replace('text-yellow-500', 'text-green-500');
                    }
                }
            }; r.readAsDataURL(f);
        });
    }

    window.addProduct = async function() {
        const btn = document.getElementById('save-btn');
        const name = document.getElementById('new-name').value;
        const price = document.getElementById('new-price').value;
        
        if(!name || !price || !window.newImages.length) return alert('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹ Ù„Ù„Ø³ÙŠØ±ÙØ±...";
        btn.disabled = true;

        try {
            await addDoc(collection(db, "products"), {
                name: name,
                price: price,
                category: document.getElementById('new-cat').value,
                images: window.newImages,
                sizes: window.newSizes,
                timestamp: Date.now()
            });
            alert('ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­!');
            document.getElementById('new-name').value = '';
            document.getElementById('preview').innerHTML = '';
            window.newImages = [];
        } catch (e) {
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message);
        }
        btn.innerText = "Ø­ÙØ¸ ÙˆØ±ÙØ¹ Ù„Ù„Ø³ÙŠØ±ÙØ± â˜ï¸";
        btn.disabled = false;
    }

    function loadProducts() {
        const q = query(collection(db, "products"), orderBy("timestamp", "desc"));
        onSnapshot(q, (snapshot) => {
            const list = document.getElementById('products-list');
            list.innerHTML = "";
            if(snapshot.empty) list.innerHTML = '<p class="text-center text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p>';
            snapshot.forEach((doc) => {
                const p = doc.data();
                list.innerHTML += `
                    <div class="bg-[#2d2d2d] p-3 rounded flex justify-between items-center border border-gray-600">
                        <div class="flex gap-2 items-center">
                            <img src="${p.images[0]}" class="w-12 h-12 rounded object-cover">
                            <div><div class="font-bold">${p.name}</div><div class="text-xs text-gray-400">${p.price} Ø¬.Ù…</div></div>
                        </div>
                        <button onclick="delProd('${doc.id}')" class="text-red-400 text-sm border border-red-900 p-1 rounded">Ø­Ø°Ù</button>
                    </div>
                `;
            });
        });
    }

    window.delProd = async function(id) {
        if(confirm('Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±ØŸ')) {
            await deleteDoc(doc(db, "products", id));
        }
    }

    function loadOrders() {
        const q = query(collection(db, "orders"), orderBy("timestamp", "desc"));
        onSnapshot(q, (snapshot) => {
            const list = document.getElementById('orders-list');
            list.innerHTML = "";
            if(snapshot.empty) list.innerHTML = '<p class="text-center text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>';
            snapshot.forEach((doc) => {
                const o = doc.data();
                list.innerHTML += `
                    <div class="bg-[#2d2d2d] p-4 rounded-xl border-r-4 border-[#708238]">
                        <div class="flex justify-between mb-2">
                            <span class="text-xs text-gray-400">${new Date(o.timestamp).toLocaleString('ar-EG')}</span>
                            <button onclick="delOrder('${doc.id}')" class="text-red-400 text-xs">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… (Ø­Ø°Ù)</button>
                        </div>
                        <div class="font-bold text-lg text-white mb-1">${o.productName}</div>
                        <div class="text-[#708238] text-sm mb-3">Ø§Ù„Ø³Ø¹Ø±: ${o.productPrice} | Ù…Ù‚Ø§Ø³: ${o.size}</div>
                        <div class="bg-black/30 p-2 rounded text-sm text-gray-300">
                            <p>ğŸ‘¤ ${o.customerName}</p>
                            <p>ğŸ“ <a href="tel:${o.customerPhone}" class="text-blue-400">${o.customerPhone}</a></p>
                            <p>ğŸ“ ${o.customerAddress}</p>
                        </div>
                    </div>
                `;
            });
        });
    }

    window.delOrder = async function(id) {
        if(confirm('Ù‡Ù„ ØªÙ… ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨ØŸ Ø³ÙŠØªÙ… Ø­Ø°ÙÙ‡.')) {
            await deleteDoc(doc(db, "orders", id));
        }
    }
   </script>
 </body>
</html>
