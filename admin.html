<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f3f4f6; }
        .tab { cursor: pointer; padding: 12px; border-bottom: 3px solid transparent; font-weight: bold; color: #888; transition: 0.3s; }
        .tab.active { border-color: #4b5f28; color: #4b5f28; background: #e8f5e9; }
        .size-checkbox:checked + div { background-color: #4b5f28; color: white; border-color: #4b5f28; transform: scale(1.05); }
        .color-btn.active { ring: 4px solid #c5a059; transform: scale(1.1); }
        .loader { border-top-color: #4b5f28; animation: spinner 1s linear infinite; }
        @keyframes spinner { 100% { transform: rotate(360deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100 min-h-screen pb-20">

    <div id="dashboard" class="max-w-6xl mx-auto p-4">
        <header class="flex flex-wrap justify-between items-center mb-6 bg-white p-4 rounded-2xl shadow-sm">
            <div>
                <h1 class="text-2xl font-black text-[#4b5f28]">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… âš™ï¸</h1>
                <p class="text-xs text-gray-500 font-bold">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª</p>
            </div>
            <div class="flex gap-2">
                <a href="index.html" target="_blank" class="px-4 py-2 bg-gray-100 rounded-lg font-bold text-sm hover:bg-gray-200">Ø§Ù„Ù…ØªØ¬Ø± ğŸ‘ï¸</a>
                <button onclick="location.reload()" class="px-4 py-2 bg-red-50 text-red-500 rounded-lg font-bold text-sm hover:bg-red-100">ØªØ­Ø¯ÙŠØ«</button>
            </div>
        </header>

        <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="bg-white p-4 rounded-xl shadow-sm border-b-4 border-orange-500 text-center"><p class="text-2xl font-black text-orange-500" id="stat-orders">0</p><p class="text-xs font-bold text-gray-400">Ø·Ù„Ø¨Ø§Øª Ù†Ø´Ø·Ø©</p></div>
            <div class="bg-white p-4 rounded-xl shadow-sm border-b-4 border-[#4b5f28] text-center"><p class="text-2xl font-black text-[#4b5f28]" id="stat-products">0</p><p class="text-xs font-bold text-gray-400">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p></div>
            <div class="bg-white p-4 rounded-xl shadow-sm border-b-4 border-gray-500 text-center"><p class="text-2xl font-black text-gray-500" id="stat-archive">0</p><p class="text-xs font-bold text-gray-400">Ø§Ù„Ø£Ø±Ø´ÙŠÙ</p></div>
        </div>

        <div class="flex border-b border-gray-200 mb-6 bg-white rounded-t-xl overflow-hidden">
            <button onclick="window.switchTab('orders')" id="tab-orders" class="tab active flex-1">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
            <button onclick="window.switchTab('archive')" id="tab-archive" class="tab flex-1">ğŸ—„ï¸ Ø§Ù„Ø£Ø±Ø´ÙŠÙ (Ø§Ù„Ù…Ù†ØªÙ‡ÙŠ)</button>
            <button onclick="window.switchTab('products')" id="tab-products" class="tab flex-1">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
            <button onclick="window.switchTab('banners')" id="tab-banners" class="tab flex-1">ğŸ–¼ï¸ Ø§Ù„Ø¹Ø±ÙˆØ¶</button>
        </div>

        <div id="sec-orders">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-xl text-gray-800">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h3>
                <span id="orders-badge" class="bg-red-100 text-red-600 px-3 py-1 rounded-full text-xs font-bold">0 Ø·Ù„Ø¨</span>
            </div>
            <div id="orders-list" class="space-y-4">
                <p class="text-center text-gray-500 py-10">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
            </div>
        </div>

        <div id="sec-archive" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="font-bold text-xl text-gray-600">Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©</h3>
            </div>
            <div id="archive-list" class="space-y-4 opacity-75">
                <p class="text-center text-gray-500 py-10">Ø§Ù„Ø£Ø±Ø´ÙŠÙ ÙØ§Ø±Øº</p>
            </div>
        </div>

        <div id="sec-products" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div class="lg:col-span-2 space-y-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="font-bold text-gray-800 mb-4">1. Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬</h3>
                        <div class="flex gap-4 mb-4">
                            <input id="prod-name" class="w-full p-3 border rounded-xl" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„">
                            <input id="prod-price" type="number" class="w-full p-3 border rounded-xl" placeholder="Ø§Ù„Ø³Ø¹Ø±">
                        </div>
                        <input id="prod-old-price" type="number" class="w-full p-3 border rounded-xl bg-red-50 border-red-100 text-red-500 mb-4" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù‚Ø¯ÙŠÙ… (Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø®ØµÙ…)">
                        <select id="prod-cat" onchange="window.updateSizeGrid()" class="w-full p-3 border rounded-xl bg-gray-50 cursor-pointer">
                            <option value="Ø±Ø¬Ø§Ù„ÙŠ">Ø±Ø¬Ø§Ù„ÙŠ (41-49)</option>
                            <option value="Ø­Ø±ÙŠÙ…ÙŠ">Ø­Ø±ÙŠÙ…ÙŠ (37-41)</option>
                            <option value="Ø£Ø·ÙØ§Ù„ÙŠ">Ø£Ø·ÙØ§Ù„ÙŠ (17-32)</option>
                        </select>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="font-bold text-gray-800 mb-4">2. Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ù‚Ø§Ø³Ø§Øª</h3>
                        <div class="flex flex-wrap gap-2 mb-4" id="color-palette">
                            <button onclick="window.activateColor('Ø£Ø³ÙˆØ¯')" class="color-btn w-8 h-8 rounded-full bg-black shadow-md"></button>
                            <button onclick="window.activateColor('Ø£Ø¨ÙŠØ¶')" class="color-btn w-8 h-8 rounded-full bg-white border border-gray-300 shadow-md"></button>
                            <button onclick="window.activateColor('ÙƒØ­Ù„ÙŠ')" class="color-btn w-8 h-8 rounded-full bg-blue-900 shadow-md"></button>
                            <button onclick="window.activateColor('Ø¨Ù†ÙŠ')" class="color-btn w-8 h-8 rounded-full bg-amber-900 shadow-md"></button>
                            <button onclick="window.activateColor('Ø¨ÙŠØ¬')" class="color-btn w-8 h-8 rounded-full bg-[#f5f5dc] border border-gray-300 shadow-md"></button>
                            <div class="flex items-center gap-1 border-r pr-2"><input id="custom-color" class="w-16 p-1 text-xs border rounded" placeholder="Ù„ÙˆÙ†.."><button onclick="window.addCustomColor()" class="bg-[#4b5f28] text-white w-6 h-6 rounded text-xs">+</button></div>
                        </div>
                        <div id="size-section" class="hidden bg-gray-50 p-4 rounded-xl">
                            <div class="flex justify-between mb-2"><span class="font-bold text-sm">Ù…Ù‚Ø§Ø³Ø§Øª <span id="active-color-name" class="text-[#4b5f28]"></span></span><button onclick="window.selectAllSizes()" class="text-xs text-blue-500 underline">Ø§Ù„ÙƒÙ„</button></div>
                            <div id="sizes-grid" class="grid grid-cols-6 gap-2"></div>
                        </div>
                        <div id="stock-summary" class="mt-2 text-xs text-gray-500 flex flex-wrap gap-2"></div>
                    </div>
                </div>

                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h3 class="font-bold text-gray-800 mb-4">3. Ø§Ù„ØµÙˆØ±</h3>
                        <div class="border-2 border-dashed border-[#4b5f28] bg-green-50 p-6 rounded-xl text-center cursor-pointer hover:bg-green-100" onclick="document.getElementById('img-file').click()">
                            <input type="file" id="img-file" hidden multiple onchange="window.handleImg(this)">
                            <span class="text-[#4b5f28] font-bold">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ ØµÙˆØ±</span>
                        </div>
                        <div id="preview-area" class="grid grid-cols-3 gap-2 mt-4"></div>
                    </div>
                    <button onclick="window.uploadProduct()" id="upload-btn" class="w-full bg-[#4b5f28] text-white py-4 rounded-xl font-bold shadow-lg hover:shadow-xl transition">Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ ğŸš€</button>
                </div>
            </div>
            <h3 class="font-bold text-xl mb-4">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
            <div id="products-list" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>

        <div id="sec-banners" class="hidden">
            <div class="bg-white p-6 rounded-2xl shadow-sm mb-6 flex items-center gap-4">
                <div class="border-2 border-dashed border-blue-400 bg-blue-50 p-4 rounded-xl cursor-pointer flex-1 text-center hover:bg-blue-100" onclick="document.getElementById('banner-file').click()">
                    <input type="file" id="banner-file" hidden onchange="window.uploadBanner(this)"><span class="text-blue-600 font-bold">â• Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯ (Slider)</span>
                </div>
            </div>
            <div id="banners-list" class="space-y-3"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
        const firebaseConfig = { apiKey: "AIzaSyASO-AN5XaSGn4SaCZ8VlHr6zsFCIxPCzs", authDomain: "ahmed-shoes.firebaseapp.com", projectId: "ahmed-shoes", storageBucket: "ahmed-shoes.firebasestorage.app", messagingSenderId: "172928088473", appId: "1:172928088473:web:100f543fd097a8d5c33b08" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Ù…ØªØºÙŠØ±Ø§Øª
        window.tempImages = []; window.stockData = {}; window.activeColor = null; 
        window.allOrders = []; window.archivedOrders = [];
        const RANGES = { 'Ø±Ø¬Ø§Ù„ÙŠ': {min: 41, max: 49}, 'Ø­Ø±ÙŠÙ…ÙŠ': {min: 37, max: 41}, 'Ø£Ø·ÙØ§Ù„ÙŠ': {min: 17, max: 32} };

        // ØªØ´ØºÙŠÙ„ Ù…Ø¨Ø§Ø´Ø±
        loadData();

        window.switchTab = (t) => {
            ['orders','archive','products','banners'].forEach(x => { document.getElementById('sec-'+x).classList.add('hidden'); document.getElementById('tab-'+x).classList.remove('active'); });
            document.getElementById('sec-'+t).classList.remove('hidden'); document.getElementById('tab-'+t).classList.add('active');
        };

        function loadData() {
            // Orders (Active & Archive)
            onSnapshot(query(collection(db, "orders"), orderBy("timestamp", "desc")), (snap) => {
                const rawOrders = snap.docs.map(d => ({id: d.id, ...d.data()}));
                
                // âš¡ Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ø³Ø­Ø±ÙŠØ©:
                // Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©: Ø¬Ø¯ÙŠØ¯ (new)ØŒ ØªØ¬Ù‡ÙŠØ² (processing)ØŒ Ø´Ø­Ù† (shipped)
                window.allOrders = rawOrders.filter(o => !['completed', 'cancelled'].includes(o.status));
                
                // Ø§Ù„Ø£Ø±Ø´ÙŠÙ: ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ… (completed)ØŒ Ù…Ù„ØºÙŠ (cancelled)
                window.archivedOrders = rawOrders.filter(o => ['completed', 'cancelled'].includes(o.status));

                document.getElementById('stat-orders').innerText = window.allOrders.length;
                document.getElementById('orders-badge').innerText = window.allOrders.length + ' Ø·Ù„Ø¨';
                document.getElementById('stat-archive').innerText = window.archivedOrders.length;
                
                renderOrders(window.allOrders, 'orders-list', false);
                renderOrders(window.archivedOrders, 'archive-list', true);
            });

            // Products
            onSnapshot(query(collection(db, "products"), orderBy("timestamp", "desc")), (snap) => {
                document.getElementById('stat-products').innerText = snap.size;
                document.getElementById('products-list').innerHTML = snap.docs.map(d => {
                    const p = d.data();
                    return `<div class="bg-white p-3 rounded-xl border flex items-center gap-3"><img src="${(p.images||[])[0]}" class="w-12 h-12 rounded object-cover"><div class="flex-1"><h4 class="font-bold text-sm">${p.name}</h4><p class="text-xs text-gray-500">${p.price} Ø¬.Ù…</p></div><button onclick="window.delDoc('products','${d.id}')" class="text-red-500 text-xs font-bold border border-red-200 px-2 py-1 rounded hover:bg-red-50">Ø­Ø°Ù</button></div>`;
                }).join('');
            });

            // Banners
            onSnapshot(query(collection(db, "banners"), orderBy("timestamp", "desc")), (snap) => {
                document.getElementById('stat-banners').innerText = snap.size;
                document.getElementById('banners-list').innerHTML = snap.docs.map(d => `<div class="relative h-24 rounded-lg overflow-hidden border"><img src="${d.data().image}" class="w-full h-full object-cover"><button onclick="window.delDoc('banners','${d.id}')" class="absolute top-1 left-1 bg-red-500 text-white w-6 h-6 rounded-full flex items-center justify-center text-xs shadow-md">âœ•</button></div>`).join('');
            });
        }

        function renderOrders(orders, containerId, isArchive) {
            const list = document.getElementById(containerId);
            if(!orders.length) { list.innerHTML = '<p class="text-center text-gray-400 py-10">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>'; return; }
            
            const statusText = { 'new': 'â³ Ù…Ø±Ø§Ø¬Ø¹Ø©', 'processing': 'âš™ï¸ ØªØ¬Ù‡ÙŠØ²', 'shipped': 'ğŸšš ØªÙˆØµÙŠÙ„', 'completed': 'âœ… Ø§Ø³ØªÙ„Ø§Ù…', 'cancelled': 'âŒ Ù…Ù„ØºÙŠ' };
            const statusColor = { 'new': 'text-yellow-600 bg-yellow-50', 'processing': 'text-blue-600 bg-blue-50', 'shipped': 'text-purple-600 bg-purple-50', 'completed': 'text-green-600 bg-green-50', 'cancelled': 'text-red-600 bg-red-50' };

            list.innerHTML = orders.map(o => {
                const st = o.status || 'new';
                const itemsHtml = (o.items && o.items.length) ? o.items.map(i => `<div>- ${i.productName} (${i.color}/${i.size}) x${i.qty}</div>`).join('') : `<div>- ${o.productName || 'Ù…Ù†ØªØ¬'}</div>`;
                
                // Ù„Ùˆ ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙØŒ Ù…Ø´ Ù…Ø­ØªØ§Ø¬ÙŠÙ† Ù†ØºÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©ØŒ Ø¨Ø³ Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                const controls = isArchive ? 
                    `<button onclick="window.delDoc('orders','${o.id}')" class="w-full py-2 bg-red-100 text-red-600 font-bold rounded text-sm hover:bg-red-200">Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„ ğŸ—‘ï¸</button>` :
                    `<div class="flex gap-2 items-center bg-gray-50 p-2 rounded">
                        <select onchange="window.updateStatus('${o.id}', this.value)" class="p-1 rounded text-sm flex-1 border outline-none bg-white cursor-pointer font-bold">
                            <option value="new" ${st=='new'?'selected':''}>â³ Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                            <option value="processing" ${st=='processing'?'selected':''}>âš™ï¸ ØªØ¬Ù‡ÙŠØ²</option>
                            <option value="shipped" ${st=='shipped'?'selected':''}>ğŸšš ØªÙˆØµÙŠÙ„</option>
                            <option value="completed" ${st=='completed'?'selected':''}>âœ… ØªØ³Ù„ÙŠÙ… (Ø£Ø±Ø´ÙØ©)</option>
                            <option value="cancelled" ${st=='cancelled'?'selected':''}>âŒ Ø¥Ù„ØºØ§Ø¡ (Ø£Ø±Ø´ÙØ©)</option>
                        </select>
                        <a href="https://wa.me/20${o.customerPhone}?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ ${o.customerName.split(' ')[0]}ØŒ Ø¨Ø®ØµÙˆØµ Ø·Ù„Ø¨Ùƒ.." target="_blank" class="bg-green-500 text-white px-3 py-1 rounded text-xs font-bold hover:bg-green-600">ÙˆØ§ØªØ³Ø§Ø¨</a>
                    </div>`;

                return `<div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 text-right">
                    <div class="flex justify-between border-b pb-2 mb-2">
                        <span class="font-bold">#${o.id.slice(0,5)}</span>
                        <span class="px-2 py-1 rounded text-xs font-bold ${statusColor[st]}">${statusText[st]}</span>
                    </div>
                    <div class="text-sm space-y-1 mb-3">
                        <p class="font-bold text-gray-700">ğŸ‘¤ ${o.customerName}</p>
                        <p class="text-blue-600 font-bold cursor-pointer" onclick="window.open('tel:${o.customerPhone}')">ğŸ“ ${o.customerPhone}</p>
                        <p class="text-gray-500">ğŸ“ ${o.customerAddress}</p>
                        <div class="bg-gray-50 p-2 rounded mt-2 text-gray-600 text-xs font-bold border">${itemsHtml}</div>
                        <div class="flex justify-between pt-2">
                            <span class="text-gray-400 text-xs">${new Date(o.timestamp).toLocaleDateString('ar-EG')}</span>
                            <span class="text-[#4b5f28] font-black text-lg">${o.total} Ø¬.Ù…</span>
                        </div>
                    </div>
                    ${controls}
                </div>`;
            }).join('');
        }

        window.updateStatus = async (id, st) => { await updateDoc(doc(db, "orders", id), {status: st}); };
        window.delDoc = async (c, id) => { if(confirm('Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ')) await deleteDoc(doc(db, c, id)); };

        const compress = (f) => new Promise(res => { const r = new FileReader(); r.readAsDataURL(f); r.onload = e => { const i = new Image(); i.src=e.target.result; i.onload=()=>{ const c=document.createElement('canvas'); const s=800/i.width; c.width=800; c.height=i.height*s; c.getContext('2d').drawImage(i,0,0,c.width,c.height); res(c.toDataURL('image/jpeg',0.6)); } } });
        window.handleImg = async (inp) => { document.getElementById('preview-area').innerHTML = '<p class="text-xs text-center col-span-3 text-green-600">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p>'; window.tempImages = []; for(const f of inp.files) { const c = await compress(f); window.tempImages.push(c); } document.getElementById('preview-area').innerHTML = window.tempImages.map(src => `<img src="${src}" class="w-full h-16 object-cover rounded border">`).join(''); };
        window.uploadBanner = async (inp) => { if(!inp.files[0]) return; const img = await compress(inp.files[0]); await addDoc(collection(db, "banners"), { image: img, timestamp: Date.now() }); alert('ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø¨Ù†Ø± âœ…'); };

        window.activateColor = (n) => { window.activeColor = n; document.getElementById('size-section').classList.remove('hidden'); document.getElementById('active-color-name').innerText = n; document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active')); event.target.classList.add('active'); if(!window.stockData[n]) window.stockData[n] = []; window.renderGrid(); };
        window.addCustomColor = () => { const n = document.getElementById('custom-color').value; if(n){ window.activateColor(n); document.getElementById('custom-color').value=''; } };
        window.renderGrid = () => { const r = RANGES[document.getElementById('prod-cat').value]; const g = document.getElementById('sizes-grid'); g.innerHTML = ''; for(let i=r.min; i<=r.max; i++) { g.innerHTML += `<label class="cursor-pointer select-none"><input type="checkbox" class="size-checkbox hidden" value="${i}" ${window.stockData[window.activeColor].includes(i)?'checked':''} onchange="window.toggleSize(${i})"><div class="w-full aspect-square flex items-center justify-center rounded bg-gray-100 border text-gray-500 font-bold text-sm hover:bg-gray-200 transition">${i}</div></label>`; } };
        window.updateSizeGrid = () => { if(window.activeColor) window.renderGrid(); };
        window.toggleSize = (s) => { const a = window.stockData[window.activeColor]; if(a.includes(s)) a.splice(a.indexOf(s), 1); else a.push(s); if(!a.length) delete window.stockData[window.activeColor]; window.renderSummary(); };
        window.selectAllSizes = () => { document.querySelectorAll('.size-checkbox').forEach(input => { if(!input.checked) { input.checked = true; input.onchange(); } }); }
        window.renderSummary = () => { document.getElementById('stock-summary').innerHTML = Object.entries(window.stockData).map(([k,v]) => `<span class="bg-white border px-1 rounded"><b>${k}:</b> ${v.join(',')}</span>`).join(' '); }

        window.uploadProduct = async () => {
            const name = document.getElementById('prod-name').value; const price = document.getElementById('prod-price').value; const oldPrice = document.getElementById('prod-old-price').value; const cat = document.getElementById('prod-cat').value; const btn = document.getElementById('upload-btn');
            if(!name || !price || !window.tempImages.length || !Object.keys(window.stockData).length) return alert('âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©!');
            btn.disabled = true; btn.innerText = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';
            try { await addDoc(collection(db, "products"), { name, price: Number(price), oldPrice: oldPrice?Number(oldPrice):null, category: cat, images: window.tempImages, colors: Object.entries(window.stockData).map(([k, v]) => ({ name: k, sizes: v })), timestamp: Date.now() }); alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­! âœ…'); location.reload(); } catch (e) { alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message); btn.disabled = false; btn.innerText = 'Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ ğŸš€'; }
        };
    </script>
</body>
</html>
