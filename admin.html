<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø°ÙƒÙŠØ© | Ø£Ø­Ù…Ø¯ Ø§Ù„Ø´ÙŠØ®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f3f4f6; }
        
        /* Custom Checkbox Style for Sizes */
        .size-checkbox:checked + div {
            background-color: #4b5f28;
            color: white;
            border-color: #4b5f28;
            transform: scale(1.05);
            box-shadow: 0 4px 6px rgba(75, 95, 40, 0.3);
        }
        
        /* Color Button Selection */
        .color-btn.active {
            ring: 4px solid #c5a059;
            transform: scale(1.1);
        }

        /* Loader */
        .loader { border-top-color: #4b5f28; -webkit-animation: spinner 1.5s linear infinite; animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-6 max-w-5xl mx-auto">

    <header class="flex justify-between items-center mb-8 bg-white p-4 rounded-2xl shadow-sm">
        <h1 class="text-2xl font-black text-[#4b5f28]">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… âš™ï¸</h1>
        <div class="flex gap-2">
            <a href="index.html" target="_blank" class="px-4 py-2 bg-gray-100 rounded-xl font-bold text-sm hover:bg-gray-200">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…ØªØ¬Ø± ğŸ‘ï¸</a>
        </div>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <div class="lg:col-span-2 space-y-6">
            
            <div class="bg-white p-6 rounded-2xl shadow-sm">
                <h3 class="font-bold text-gray-800 mb-4 border-b pb-2">1. ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs font-bold text-gray-500">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„</label>
                        <input id="prod-name" class="w-full bg-gray-50 border p-3 rounded-xl font-bold focus:border-[#4b5f28] outline-none" placeholder="Ù…Ø«Ø§Ù„: Ù†Ø§ÙŠÙƒ Ø§ÙŠØ± Ø¬ÙˆØ±Ø¯Ù†">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500">Ø§Ù„Ø³Ø¹Ø±</label>
                        <input id="prod-price" type="number" class="w-full bg-gray-50 border p-3 rounded-xl font-bold focus:border-[#4b5f28] outline-none" placeholder="00">
                    </div>
                </div>
                <div class="mt-4">
                    <label class="text-xs font-bold text-gray-500">Ø§Ù„Ù‚Ø³Ù… (ÙŠØ­Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)</label>
                    <select id="prod-cat" onchange="updateSizeGrid()" class="w-full bg-green-50 border border-green-200 text-[#4b5f28] p-3 rounded-xl font-bold focus:outline-none cursor-pointer">
                        <option value="Ø±Ø¬Ø§Ù„ÙŠ">Ø±Ø¬Ø§Ù„ÙŠ (41 - 49)</option>
                        <option value="Ø­Ø±ÙŠÙ…ÙŠ">Ø­Ø±ÙŠÙ…ÙŠ (37 - 41)</option>
                        <option value="Ø£Ø·ÙØ§Ù„ÙŠ">Ø£Ø·ÙØ§Ù„ÙŠ (17 - 32)</option>
                    </select>
                </div>
            </div>

            <div class="bg-white p-6 rounded-2xl shadow-sm border-2 border-[#4b5f28]/10">
                <h3 class="font-bold text-gray-800 mb-4 border-b pb-2 flex justify-between">
                    <span>2. Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ù‚Ø§Ø³Ø§Øª</span>
                    <span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded">Ø§Ø¶ØºØ· Ø§Ù„Ù„ÙˆÙ† Ø«Ù… Ø§Ø®ØªØ± Ù…Ù‚Ø§Ø³Ø§ØªÙ‡</span>
                </h3>

                <div class="mb-6">
                    <p class="text-xs font-bold text-gray-400 mb-2">Ø£ÙˆÙ„Ø§Ù‹: Ø§Ø®ØªØ± Ù„ÙˆÙ† Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ù‚Ø§Ø³Ø§ØªÙ‡</p>
                    <div class="flex flex-wrap gap-3" id="color-palette">
                        <button onclick="activateColor('Ø£Ø³ÙˆØ¯', '#000000')" class="color-btn w-10 h-10 rounded-full bg-black shadow-md transition hover:scale-105" title="Ø£Ø³ÙˆØ¯"></button>
                        <button onclick="activateColor('Ø£Ø¨ÙŠØ¶', '#ffffff')" class="color-btn w-10 h-10 rounded-full bg-white border border-gray-300 shadow-md transition hover:scale-105" title="Ø£Ø¨ÙŠØ¶"></button>
                        <button onclick="activateColor('ÙƒØ­Ù„ÙŠ', '#1e3a8a')" class="color-btn w-10 h-10 rounded-full bg-blue-900 shadow-md transition hover:scale-105" title="ÙƒØ­Ù„ÙŠ"></button>
                        <button onclick="activateColor('Ø¨Ù†ÙŠ', '#78350f')" class="color-btn w-10 h-10 rounded-full bg-amber-900 shadow-md transition hover:scale-105" title="Ø¨Ù†ÙŠ"></button>
                        <button onclick="activateColor('Ø¨ÙŠØ¬', '#f5f5dc')" class="color-btn w-10 h-10 rounded-full bg-[#f5f5dc] border border-gray-300 shadow-md transition hover:scale-105" title="Ø¨ÙŠØ¬"></button>
                        <button onclick="activateColor('Ø±Ù…Ø§Ø¯ÙŠ', '#6b7280')" class="color-btn w-10 h-10 rounded-full bg-gray-500 shadow-md transition hover:scale-105" title="Ø±Ù…Ø§Ø¯ÙŠ"></button>
                        <button onclick="activateColor('Ù‡Ø§ÙØ§Ù†', '#d97706')" class="color-btn w-10 h-10 rounded-full bg-amber-600 shadow-md transition hover:scale-105" title="Ù‡Ø§ÙØ§Ù†"></button>
                        
                        <div class="flex items-center gap-1 mr-2 border-r pr-2">
                            <input id="custom-color-name" placeholder="Ù„ÙˆÙ† Ø¢Ø®Ø±.." class="w-20 text-xs p-2 border rounded-lg bg-gray-50">
                            <button onclick="addCustomColor()" class="bg-[#4b5f28] text-white w-8 h-8 rounded-lg text-lg font-bold">+</button>
                        </div>
                    </div>
                </div>

                <div id="size-section" class="hidden">
                    <div class="flex justify-between items-center mb-3">
                        <p class="font-bold text-gray-800">
                            Ù…Ù‚Ø§Ø³Ø§Øª Ø§Ù„Ù„ÙˆÙ†: <span id="active-color-name" class="text-[#4b5f28] text-lg">...</span>
                        </p>
                        <button onclick="selectAllSizes()" class="text-xs text-blue-500 underline">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„</button>
                    </div>
                    
                    <div id="sizes-grid" class="grid grid-cols-6 gap-2">
                        </div>
                </div>
                
                <div id="no-color-msg" class="text-center py-8 bg-gray-50 rounded-xl border border-dashed border-gray-300">
                    <p class="text-gray-400">ğŸ‘ˆ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ Ù„ÙˆÙ† ÙÙˆÙ‚ Ø¹Ø´Ø§Ù† ØªÙØªØ­ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª</p>
                </div>
            </div>

            <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                <h4 class="font-bold text-gray-700 mb-2 text-sm">Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† (Ù‡ÙŠØ¸Ù‡Ø± Ù„Ù„Ø¹Ù…ÙŠÙ„ ÙƒØ¯Ø§):</h4>
                <div id="stock-summary" class="flex flex-wrap gap-2 text-sm text-gray-500">
                    Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¯Ø®Ù„Ø© Ø¨Ø¹Ø¯..
                </div>
            </div>
        </div>

        <div class="space-y-6">
            <div class="bg-white p-6 rounded-2xl shadow-sm">
                <h3 class="font-bold text-gray-800 mb-4 border-b pb-2">3. ØµÙˆØ± Ø§Ù„Ù…Ù†ØªØ¬</h3>
                <div class="border-2 border-dashed border-[#4b5f28] bg-green-50 rounded-xl p-6 text-center cursor-pointer hover:bg-green-100 transition" onclick="document.getElementById('img-file').click()">
                    <input type="file" id="img-file" multiple hidden onchange="handleImgSelect(this)">
                    <p class="text-3xl mb-2">ğŸ“¸</p>
                    <p class="text-sm font-bold text-[#4b5f28]">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±</p>
                    <p class="text-[10px] text-gray-500">ÙŠÙØ¶Ù„ ØµÙˆØ± Ù…Ø±Ø¨Ø¹Ø© Ø£Ùˆ Ø·ÙˆÙ„ÙŠØ©</p>
                </div>
                <div id="preview-area" class="grid grid-cols-3 gap-2 mt-4"></div>
            </div>

            <button onclick="uploadProduct()" id="upload-btn" class="w-full bg-[#4b5f28] text-white py-4 rounded-xl font-bold text-xl shadow-xl hover:shadow-2xl hover:-translate-y-1 transition flex justify-center items-center gap-2">
                <span>Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ ğŸš€</span>
            </button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase Setup
        const app = initializeApp({
            apiKey: "AIzaSyASO-AN5XaSGn4SaCZ8VlHr6zsFCIxPCzs",
            authDomain: "ahmed-shoes.firebaseapp.com",
            projectId: "ahmed-shoes",
            storageBucket: "ahmed-shoes.firebasestorage.app",
            messagingSenderId: "172928088473",
            appId: "1:172928088473:web:100f543fd097a8d5c33b08",
        });
        const db = getFirestore(app);

        // State
        window.tempImages = [];
        window.stockData = {}; // { 'Ø£Ø³ÙˆØ¯': [41, 42], 'Ø£Ø¨ÙŠØ¶': [40] }
        window.activeColor = null;

        // Configuration (Ranges)
        const RANGES = {
            'Ø±Ø¬Ø§Ù„ÙŠ': {min: 41, max: 49},
            'Ø­Ø±ÙŠÙ…ÙŠ': {min: 37, max: 41},
            'Ø£Ø·ÙØ§Ù„ÙŠ': {min: 17, max: 32}
        };

        // --- Logic: 1. Images ---
        window.handleImgSelect = (input) => {
            const files = [...input.files];
            document.getElementById('preview-area').innerHTML = '';
            window.tempImages = [];
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    // Resize/Compress Logic could go here, keeping it simple
                    window.tempImages.push(e.target.result);
                    document.getElementById('preview-area').innerHTML += 
                        `<div class="relative group">
                            <img src="${e.target.result}" class="w-full h-20 object-cover rounded-lg border">
                         </div>`;
                };
                reader.readAsDataURL(file);
            });
        };

        // --- Logic: 2. Colors & Sizes ---
        
        // When a color circle is clicked
        window.activateColor = (colorName, hex) => {
            window.activeColor = colorName;
            
            // UI Update
            document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
            // Try to find the button we clicked (approximation)
            event.target.classList.add('active'); 
            
            document.getElementById('no-color-msg').classList.add('hidden');
            document.getElementById('size-section').classList.remove('hidden');
            document.getElementById('active-color-name').innerText = colorName;
            
            // Init stock array for this color if not exists
            if(!window.stockData[colorName]) window.stockData[colorName] = [];
            
            renderSizeGrid();
        };

        window.addCustomColor = () => {
            const name = document.getElementById('custom-color-name').value.trim();
            if(!name) return;
            // Create a temporary button visually
            const btn = document.createElement('button');
            btn.className = "color-btn w-10 h-10 rounded-full bg-gray-200 border border-gray-400 font-bold text-[10px] flex items-center justify-center shadow-md";
            btn.innerText = name.substring(0,2);
            btn.onclick = (e) => window.activateColor(name, '#ccc');
            document.getElementById('color-palette').insertBefore(btn, document.getElementById('color-palette').lastElementChild);
            document.getElementById('custom-color-name').value = '';
            window.activateColor(name, '#ccc');
        };

        // Render the squares
        window.renderSizeGrid = () => {
            const cat = document.getElementById('prod-cat').value;
            const range = RANGES[cat];
            const grid = document.getElementById('sizes-grid');
            grid.innerHTML = '';
            
            const currentSelected = window.stockData[window.activeColor] || [];

            for(let i = range.min; i <= range.max; i++) {
                const isChecked = currentSelected.includes(i) ? 'checked' : '';
                
                grid.innerHTML += `
                    <label class="cursor-pointer select-none">
                        <input type="checkbox" class="size-checkbox hidden" value="${i}" ${isChecked} onchange="toggleSize(${i})">
                        <div class="w-full aspect-square flex items-center justify-center rounded-xl bg-gray-100 border-2 border-transparent font-bold text-gray-500 transition-all hover:bg-gray-200">
                            ${i}
                        </div>
                    </label>
                `;
            }
        };

        // When category changes, reset or update grid
        window.updateSizeGrid = () => {
            if(window.activeColor) renderSizeGrid();
        };

        // Toggle a single size
        window.toggleSize = (size) => {
            if(!window.activeColor) return;
            const arr = window.stockData[window.activeColor];
            
            if(arr.includes(size)) {
                // Remove
                const idx = arr.indexOf(size);
                arr.splice(idx, 1);
            } else {
                // Add
                arr.push(size);
                arr.sort((a,b) => a-b);
            }
            
            // Clean up empty colors
            if(arr.length === 0) delete window.stockData[window.activeColor];
            
            updateSummary();
        };
        
        window.selectAllSizes = () => {
             const inputs = document.querySelectorAll('.size-checkbox');
             inputs.forEach(input => {
                 if(!input.checked) {
                     input.checked = true;
                     input.onchange(); // Trigger the logic
                 }
             });
        }

        // Show summary at bottom
        function updateSummary() {
            const div = document.getElementById('stock-summary');
            const entries = Object.entries(window.stockData);
            
            if(entries.length === 0) {
                div.innerHTML = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¯Ø®Ù„Ø© Ø¨Ø¹Ø¯..';
                return;
            }
            
            div.innerHTML = entries.map(([color, sizes]) => {
                if(sizes.length === 0) return '';
                return `<span class="bg-white border px-2 py-1 rounded-lg">
                    <b class="text-[#4b5f28]">${color}:</b> ${sizes.join(', ')}
                </span>`;
            }).join('');
        }

        // --- Logic: 3. Upload ---
        window.uploadProduct = async () => {
            const name = document.getElementById('prod-name').value;
            const price = document.getElementById('prod-price').value;
            const cat = document.getElementById('prod-cat').value;
            const btn = document.getElementById('upload-btn');
            
            // Validation
            if(!name || !price) return alert('Ù†Ø§Ù‚Øµ Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø³Ø¹Ø±!');
            if(window.tempImages.length === 0) return alert('Ù„Ø§Ø²Ù… ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ø§Ù„Ø£Ù‚Ù„!');
            const hasStock = Object.keys(window.stockData).length > 0;
            if(!hasStock) return alert('Ù„Ø§Ø²Ù… ØªØ®ØªØ§Ø± Ù„ÙˆÙ† ÙˆÙ…Ù‚Ø§Ø³ ÙˆØ§Ø­Ø¯ Ø¹Ø§Ù„Ø£Ù‚Ù„!');

            // Transform stockData to array format for Frontend compatibility
            // Frontend expects: colors: [{name: 'Red', sizes: [41, 42]}]
            const colorsArray = Object.entries(window.stockData).map(([k, v]) => ({
                name: k,
                sizes: v
            }));

            btn.disabled = true;
            btn.innerHTML = '<div class="loader w-6 h-6 rounded-full border-2 border-white"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';

            try {
                await addDoc(collection(db, "products"), {
                    name, 
                    price: Number(price), 
                    category: cat,
                    images: window.tempImages,
                    colors: colorsArray,
                    timestamp: Date.now()
                });
                
                alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­! âœ…');
                location.reload(); // Reset form
            } catch (e) {
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£: ' + e.message);
                btn.disabled = false;
                btn.innerText = 'Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬ ğŸš€';
            }
        };
    </script>
</body>
</html>
